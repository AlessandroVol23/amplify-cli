{"version":3,"sources":["enable.js"],"names":["fs","require","messages","subcommand","category","options","module","exports","name","alias","run","context","amplify","servicesMetadata","JSON","parse","readFileSync","__dirname","existingAuth","getProjectDetails","amplifyMeta","auth","Object","keys","length","print","warning","authExists","serviceSelectionPrompt","then","result","service","providerPlugin","providerName","providerController","error","addResource","resourceName","updateamplifyMetaAfterResourceAdd","success","info","catch","err","stack"],"mappings":"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","file":"enable.js","sourcesContent":["const fs = require('fs');\nconst { messages } = require('../../provider-utils/awscloudformation/assets/string-maps');\n\nconst subcommand = 'enable';\nconst category = 'auth';\nlet options;\n\nmodule.exports = {\n  name: subcommand,\n  alias: ['add'],\n  run: async (context) => {\n    const { amplify } = context;\n    const servicesMetadata = JSON.parse(fs.readFileSync(`${__dirname}/../../provider-utils/supported-services.json`));\n\n    const existingAuth = amplify.getProjectDetails().amplifyMeta.auth || {};\n\n    if (Object.keys(existingAuth).length > 0) {\n      return context.print.warning(messages.authExists);\n    }\n\n    return amplify.serviceSelectionPrompt(context, category, servicesMetadata)\n      .then((result) => {\n        options = {\n          service: result.service,\n          providerPlugin: result.providerName,\n        };\n        const providerController = require(`../../provider-utils/${result.providerName}/index`);\n        if (!providerController) {\n          context.print.error('Provider not configured for this category');\n          return;\n        }\n        return providerController.addResource(context, category, result.service);\n      })\n      .then((resourceName) => {\n        amplify.updateamplifyMetaAfterResourceAdd(category, resourceName, options);\n        const { print } = context;\n        print.success(`Successfully added resource ${resourceName} locally`);\n        print.info('');\n        print.success('Some next steps:');\n        print.info('\"amplify push\" will build all your local backend resources and provision it in the cloud');\n        print.info('\"amplify publish\" will build all your local backend and frontend resources (if you have hosting category added) and provision it in the cloud');\n        print.info('');\n      })\n      .catch((err) => {\n        context.print.info(err.stack);\n        context.print.error('There was an error adding the auth resource');\n      });\n  },\n};\n"]}