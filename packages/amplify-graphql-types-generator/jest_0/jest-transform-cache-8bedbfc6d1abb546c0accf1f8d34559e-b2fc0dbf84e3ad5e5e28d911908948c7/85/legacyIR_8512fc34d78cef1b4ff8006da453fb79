ed78e390f134766afdf92c8717a70ca4
'use strict';require('ts-jest').install("/c/Users/Sandro/repo/amplify-cli/packages/amplify-graphql-types-generator/src/compiler/legacyIR.ts", "\"use strict\";\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\n            t[p[i]] = s[p[i]];\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst _1 = require(\"./\");\nconst collectFragmentsReferenced_1 = require(\"./visitors/collectFragmentsReferenced\");\nconst generateOperationId_1 = require(\"./visitors/generateOperationId\");\nconst typeCase_1 = require(\"./visitors/typeCase\");\nconst collectAndMergeFields_1 = require(\"./visitors/collectAndMergeFields\");\nrequire(\"../utilities/array\");\nfunction compileToLegacyIR(schema, document, options = { mergeInFieldsFromFragmentSpreads: true }) {\n    const context = _1.compileToIR(schema, document, options);\n    const transformer = new LegacyIRTransformer(context, options);\n    return transformer.transformIR();\n}\nexports.compileToLegacyIR = compileToLegacyIR;\nclass LegacyIRTransformer {\n    constructor(context, options = { mergeInFieldsFromFragmentSpreads: true }) {\n        this.context = context;\n        this.options = options;\n    }\n    transformIR() {\n        const operations = Object.create({});\n        for (const [operationName, operation] of Object.entries(this.context.operations)) {\n            const { filePath, operationType, rootType, variables, source, selectionSet } = operation;\n            const fragmentsReferenced = collectFragmentsReferenced_1.collectFragmentsReferenced(selectionSet, this.context.fragments);\n            const { sourceWithFragments, operationId } = generateOperationId_1.generateOperationId(operation, this.context.fragments, fragmentsReferenced);\n            operations[operationName] = Object.assign({ filePath,\n                operationName,\n                operationType,\n                rootType,\n                variables,\n                source }, this.transformSelectionSetToLegacyIR(selectionSet), { fragmentsReferenced: Array.from(fragmentsReferenced), sourceWithFragments,\n                operationId });\n        }\n        const fragments = Object.create({});\n        for (const [fragmentName, fragment] of Object.entries(this.context.fragments)) {\n            const { selectionSet, type } = fragment, fragmentWithoutSelectionSet = __rest(fragment, [\"selectionSet\", \"type\"]);\n            fragments[fragmentName] = Object.assign({ typeCondition: type, possibleTypes: selectionSet.possibleTypes }, fragmentWithoutSelectionSet, this.transformSelectionSetToLegacyIR(selectionSet));\n        }\n        const legacyContext = {\n            schema: this.context.schema,\n            operations,\n            fragments,\n            typesUsed: this.context.typesUsed,\n            options: this.options\n        };\n        return legacyContext;\n    }\n    transformSelectionSetToLegacyIR(selectionSet) {\n        const typeCase = typeCase_1.typeCaseForSelectionSet(selectionSet, this.options.mergeInFieldsFromFragmentSpreads);\n        const fields = this.transformFieldsToLegacyIR(collectAndMergeFields_1.collectAndMergeFields(typeCase.default, false));\n        const inlineFragments = typeCase.variants.flatMap(variant => {\n            const fields = this.transformFieldsToLegacyIR(collectAndMergeFields_1.collectAndMergeFields(variant, false));\n            if (selectionSet.possibleTypes.every(type => variant.possibleTypes.includes(type)) &&\n                fields.length < 1)\n                return undefined;\n            const fragmentSpreads = this.collectFragmentSpreads(selectionSet, variant.possibleTypes).map((fragmentSpread) => fragmentSpread.fragmentName);\n            return variant.possibleTypes.map(possibleType => {\n                return {\n                    typeCondition: possibleType,\n                    possibleTypes: [possibleType],\n                    fields,\n                    fragmentSpreads\n                };\n            });\n        });\n        for (const inlineFragment of inlineFragments) {\n            inlineFragments[inlineFragment.typeCondition.name] = inlineFragment;\n        }\n        const fragmentSpreads = this.collectFragmentSpreads(selectionSet).map((fragmentSpread) => fragmentSpread.fragmentName);\n        return {\n            fields,\n            fragmentSpreads,\n            inlineFragments\n        };\n    }\n    transformFieldsToLegacyIR(fields) {\n        return fields.map(field => {\n            const { args, type, isConditional, description, isDeprecated, deprecationReason, selectionSet } = field;\n            const conditions = field.conditions && field.conditions.length > 0\n                ? field.conditions.map(({ kind, variableName, inverted }) => {\n                    return {\n                        kind,\n                        variableName,\n                        inverted\n                    };\n                })\n                : undefined;\n            return Object.assign({ responseName: field.alias || field.name, fieldName: field.name, type,\n                args,\n                isConditional,\n                conditions,\n                description,\n                isDeprecated,\n                deprecationReason }, selectionSet ? this.transformSelectionSetToLegacyIR(selectionSet) : {});\n        });\n    }\n    collectFragmentSpreads(selectionSet, possibleTypes = selectionSet.possibleTypes) {\n        const fragmentSpreads = [];\n        for (const selection of selectionSet.selections) {\n            switch (selection.kind) {\n                case 'FragmentSpread':\n                    fragmentSpreads.push(selection);\n                    break;\n                case 'TypeCondition':\n                    if (possibleTypes.every(type => selection.selectionSet.possibleTypes.includes(type))) {\n                        fragmentSpreads.push(...this.collectFragmentSpreads(selection.selectionSet, possibleTypes));\n                    }\n                    break;\n                case 'BooleanCondition':\n                    fragmentSpreads.push(...this.collectFragmentSpreads(selection.selectionSet, possibleTypes));\n                    break;\n            }\n        }\n        return Array.from(new Set(fragmentSpreads));\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGVnYWN5SVIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJsZWdhY3lJUi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUVBLHlCQUF1RjtBQUV2RixzRkFBbUY7QUFDbkYsd0VBQXFFO0FBQ3JFLGtEQUE4RDtBQUM5RCw0RUFBeUU7QUFFekUsOEJBQTRCO0FBaUY1QiwyQkFDRSxNQUFxQixFQUNyQixRQUFzQixFQUN0QixVQUEyQixFQUFFLGdDQUFnQyxFQUFFLElBQUksRUFBRTtJQUVyRSxNQUFNLE9BQU8sR0FBRyxjQUFXLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUN2RCxNQUFNLFdBQVcsR0FBRyxJQUFJLG1CQUFtQixDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztJQUM5RCxPQUFPLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztBQUNuQyxDQUFDO0FBUkQsOENBUUM7QUFFRDtJQUNFLFlBQ1MsT0FBd0IsRUFDeEIsVUFBMkIsRUFBRSxnQ0FBZ0MsRUFBRSxJQUFJLEVBQUU7UUFEckUsWUFBTyxHQUFQLE9BQU8sQ0FBaUI7UUFDeEIsWUFBTyxHQUFQLE9BQU8sQ0FBOEQ7SUFDM0UsQ0FBQztJQUVKLFdBQVc7UUFDVCxNQUFNLFVBQVUsR0FBaUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUVuRixLQUFLLE1BQU0sQ0FBQyxhQUFhLEVBQUUsU0FBUyxDQUFDLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxFQUFFO1lBQ2hGLE1BQU0sRUFBRSxRQUFRLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxHQUFHLFNBQVMsQ0FBQztZQUN6RixNQUFNLG1CQUFtQixHQUFHLHVEQUEwQixDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FB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LENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FDM0QsQ0FBQztRQUNuQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxzQkFBc0IsQ0FDcEIsWUFBMEIsRUFDMUIsZ0JBQXFDLFlBQVksQ0FBQyxhQUFhO1FBRS9ELE1BQU0sZUFBZSxHQUFxQixFQUFFLENBQUM7UUFFN0MsS0FBSyxNQUFNLFNBQVMsSUFBSSxZQUFZLENBQUMsVUFBVSxFQUFFO1lBQy9DLFFBQVEsU0FBUyxDQUFDLElBQUksRUFBRTtnQkFDdEIsS0FBSyxnQkFBZ0I7b0JBQ25CLGVBQWUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7b0JBQ2hDLE1BQU07Z0JBQ1IsS0FBSyxlQUFlO29CQUNsQixJQUFJLGFBQWEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRTt3QkFDcEYsZUFBZSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxTQUFTLENBQUMsWUFBWSxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUM7cUJBQzdGO29CQUNELE1BQU07Z0JBQ1IsS0FBSyxrQkFBa0I7b0JBQ3JCLGVBQWUsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsc0JBQXNCLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDO29CQUM1RixNQUFNO2FBQ1Q7U0FDRjtRQUdELE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDO0lBQzlDLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdyYXBoUUxTY2hlbWEsIEdyYXBoUUxUeXBlLCBHcmFwaFFMT2JqZWN0VHlwZSwgR3JhcGhRTENvbXBvc2l0ZVR5cGUsIERvY3VtZW50Tm9kZSB9IGZyb20gJ2dyYXBocWwnO1xuXG5pbXBvcnQgeyBjb21waWxlVG9JUiwgQ29tcGlsZXJDb250ZXh0LCBTZWxlY3Rpb25TZXQsIEZpZWxkLCBGcmFnbWVudFNwcmVhZCB9IGZyb20gJy4vJztcblxuaW1wb3J0IHsgY29sbGVjdEZyYWdtZW50c1JlZmVyZW5jZWQgfSBmcm9tICcuL3Zpc2l0b3JzL2NvbGxlY3RGcmFnbWVudHNSZWZlcmVuY2VkJztcbmltcG9ydCB7IGdlbmVyYXRlT3BlcmF0aW9uSWQgfSBmcm9tICcuL3Zpc2l0b3JzL2dlbmVyYXRlT3BlcmF0aW9uSWQnO1xuaW1wb3J0IHsgdHlwZUNhc2VGb3JTZWxlY3Rpb25TZXQgfSBmcm9tICcuL3Zpc2l0b3JzL3R5cGVDYXNlJztcbmltcG9ydCB7IGNvbGxlY3RBbmRNZXJnZUZpZWxkcyB9IGZyb20gJy4vdmlzaXRvcnMvY29sbGVjdEFuZE1lcmdlRmllbGRzJztcblxuaW1wb3J0ICcuLi91dGlsaXRpZXMvYXJyYXknO1xuaW1wb3J0IE1heWJlIGZyb20gJ2dyYXBocWwvdHN1dGlscy9NYXliZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tcGlsZXJPcHRpb25zIHtcbiAgYWRkVHlwZW5hbWU/OiBib29sZWFuO1xuICBtZXJnZUluRmllbGRzRnJvbUZyYWdtZW50U3ByZWFkcz86IGJvb2xlYW47XG4gIHBhc3N0aHJvdWdoQ3VzdG9tU2NhbGFycz86IGJvb2xlYW47XG4gIGN1c3RvbVNjYWxhcnNQcmVmaXg/OiBzdHJpbmc7XG4gIG5hbWVzcGFjZT86IHN0cmluZztcbiAgZ2VuZXJhdGVPcGVyYXRpb25JZHM/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIExlZ2FjeUNvbXBpbGVyQ29udGV4dCB7XG4gIHNjaGVtYTogR3JhcGhRTFNjaGVtYTtcbiAgb3BlcmF0aW9uczogeyBbb3BlcmF0aW9uTmFtZTogc3RyaW5nXTogTGVnYWN5T3BlcmF0aW9uIH07XG4gIGZyYWdtZW50czogeyBbZnJhZ21lbnROYW1lOiBzdHJpbmddOiBMZWdhY3lGcmFnbWVudCB9O1xuICB0eXBlc1VzZWQ6IEdyYXBoUUxUeXBlW107XG4gIG9wdGlvbnM6IENvbXBpbGVyT3B0aW9ucztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBMZWdhY3lPcGVyYXRpb24ge1xuICBmaWxlUGF0aD86IHN0cmluZztcbiAgb3BlcmF0aW9uTmFtZTogc3RyaW5nO1xuICBvcGVyYXRpb25JZD86IHN0cmluZztcbiAgb3BlcmF0aW9uVHlwZTogc3RyaW5nO1xuICByb290VHlwZTogR3JhcGhRTE9iamVjdFR5cGU7XG4gIHZhcmlhYmxlczoge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICB0eXBlOiBHcmFwaFFMVHlwZTtcbiAgfVtdO1xuICBzb3VyY2U6IHN0cmluZztcbiAgc291cmNlV2l0aEZyYWdtZW50cz86IHN0cmluZztcbiAgZmllbGRzOiBMZWdhY3lGaWVsZFtdO1xuICBmcmFnbWVudFNwcmVhZHM/OiBzdHJpbmdbXTtcbiAgaW5saW5lRnJhZ21lbnRzPzogTGVnYWN5SW5saW5lRnJhZ21lbnRbXTtcbiAgZnJhZ21lbnRzUmVmZXJlbmNlZDogc3RyaW5nW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGVnYWN5RnJhZ21lbnQge1xuICBmaWxlUGF0aD86IHN0cmluZztcbiAgZnJhZ21lbnROYW1lOiBzdHJpbmc7XG4gIHNvdXJjZTogc3RyaW5nO1xuICB0eXBlQ29uZGl0aW9uOiBHcmFwaFFMQ29tcG9zaXRlVHlwZTtcbiAgcG9zc2libGVUeXBlczogR3JhcGhRTE9iamVjdFR5cGVbXTtcbiAgZmllbGRzOiBMZWdhY3lGaWVsZFtdO1xuICBmcmFnbWVudFNwcmVhZHM6IHN0cmluZ1tdO1xuICBpbmxpbmVGcmFnbWVudHM6IExlZ2FjeUlubGluZUZyYWdtZW50W107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGVnYWN5SW5saW5lRnJhZ21lbnQge1xuICB0eXBlQ29uZGl0aW9uOiBHcmFwaFFMT2JqZWN0VHlwZTtcbiAgcG9zc2libGVUeXBlczogR3JhcGhRTE9iamVjdFR5cGVbXTtcbiAgZmllbGRzOiBMZWdhY3lGaWVsZFtdO1xuICBmcmFnbWVudFNwcmVhZHM6IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIExlZ2FjeUZpZWxkIHtcbiAgcmVzcG9uc2VOYW1lOiBzdHJpbmc7XG4gIGZpZWxkTmFtZTogc3RyaW5nO1xuICBhcmdzPzogQXJndW1lbnRbXTtcbiAgdHlwZTogR3JhcGhRTFR5cGU7XG4gIGRlc2NyaXB0aW9uPzogTWF5YmU8c3RyaW5nPjtcbiAgaXNDb25kaXRpb25hbD86IGJvb2xlYW47XG4gIGNvbmRpdGlvbnM/OiBCb29sZWFuQ29uZGl0aW9uW107XG4gIGlzRGVwcmVjYXRlZD86IGJvb2xlYW47XG4gIGRlcHJlY2F0aW9uUmVhc29uPzogc3RyaW5nO1xuICBmaWVsZHM/OiBMZWdhY3lGaWVsZFtdO1xuICBmcmFnbWVudFNwcmVhZHM/OiBzdHJpbmdbXTtcbiAgaW5saW5lRnJhZ21lbnRzPzogTGVnYWN5SW5saW5lRnJhZ21lbnRbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCb29sZWFuQ29uZGl0aW9uIHtcbiAgdmFyaWFibGVOYW1lOiBzdHJpbmc7XG4gIGludmVydGVkOiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFyZ3VtZW50IHtcbiAgbmFtZTogc3RyaW5nO1xuICB2YWx1ZTogYW55O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29tcGlsZVRvTGVnYWN5SVIoXG4gIHNjaGVtYTogR3JhcGhRTFNjaGVtYSxcbiAgZG9jdW1lbnQ6IERvY3VtZW50Tm9kZSxcbiAgb3B0aW9uczogQ29tcGlsZXJPcHRpb25zID0geyBtZXJnZUluRmllbGRzRnJvbUZyYWdtZW50U3ByZWFkczogdHJ1ZSB9XG4pOiBMZWdhY3lDb21waWxlckNvbnRleHQge1xuICBjb25zdCBjb250ZXh0ID0gY29tcGlsZVRvSVIoc2NoZW1hLCBkb2N1bWVudCwgb3B0aW9ucyk7XG4gIGNvbnN0IHRyYW5zZm9ybWVyID0gbmV3IExlZ2FjeUlSVHJhbnNmb3JtZXIoY29udGV4dCwgb3B0aW9ucyk7XG4gIHJldHVybiB0cmFuc2Zvcm1lci50cmFuc2Zvcm1JUigpO1xufVxuXG5jbGFzcyBMZWdhY3lJUlRyYW5zZm9ybWVyIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGNvbnRleHQ6IENvbXBpbGVyQ29udGV4dCxcbiAgICBwdWJsaWMgb3B0aW9uczogQ29tcGlsZXJPcHRpb25zID0geyBtZXJnZUluRmllbGRzRnJvbUZyYWdtZW50U3ByZWFkczogdHJ1ZSB9XG4gICkge31cblxuICB0cmFuc2Zvcm1JUigpOiBMZWdhY3lDb21waWxlckNvbnRleHQge1xuICAgIGNvbnN0IG9wZXJhdGlvbnM6IHsgW29wZXJhdGlvbk5hbWU6IHN0cmluZ106IExlZ2FjeU9wZXJhdGlvbiB9ID0gT2JqZWN0LmNyZWF0ZSh7fSk7XG5cbiAgICBmb3IgKGNvbnN0IFtvcGVyYXRpb25OYW1lLCBvcGVyYXRpb25dIG9mIE9iamVjdC5lbnRyaWVzKHRoaXMuY29udGV4dC5vcGVyYXRpb25zKSkge1xuICAgICAgY29uc3QgeyBmaWxlUGF0aCwgb3BlcmF0aW9uVHlwZSwgcm9vdFR5cGUsIHZhcmlhYmxlcywgc291cmNlLCBzZWxlY3Rpb25TZXQgfSA9IG9wZXJhdGlvbjtcbiAgICAgIGNvbnN0IGZyYWdtZW50c1JlZmVyZW5jZWQgPSBjb2xsZWN0RnJhZ21lbnRzUmVmZXJlbmNlZChzZWxlY3Rpb25TZXQsIHRoaXMuY29udGV4dC5mcmFnbWVudHMpO1xuXG4gICAgICBjb25zdCB7IHNvdXJjZVdpdGhGcmFnbWVudHMsIG9wZXJhdGlvbklkIH0gPSBnZW5lcmF0ZU9wZXJhdGlvbklkKFxuICAgICAgICBvcGVyYXRpb24sXG4gICAgICAgIHRoaXMuY29udGV4dC5mcmFnbWVudHMsXG4gICAgICAgIGZyYWdtZW50c1JlZmVyZW5jZWRcbiAgICAgICk7XG5cbiAgICAgIG9wZXJhdGlvbnNbb3BlcmF0aW9uTmFtZV0gPSB7XG4gICAgICAgIGZpbGVQYXRoLFxuICAgICAgICBvcGVyYXRpb25OYW1lLFxuICAgICAgICBvcGVyYXRpb25UeXBlLFxuICAgICAgICByb290VHlwZSxcbiAgICAgICAgdmFyaWFibGVzLFxuICAgICAgICBzb3VyY2UsXG4gICAgICAgIC4uLnRoaXMudHJhbnNmb3JtU2VsZWN0aW9uU2V0VG9MZWdhY3lJUihzZWxlY3Rpb25TZXQpLFxuICAgICAgICBmcmFnbWVudHNSZWZlcmVuY2VkOiBBcnJheS5mcm9tKGZyYWdtZW50c1JlZmVyZW5jZWQpLFxuICAgICAgICBzb3VyY2VXaXRoRnJhZ21lbnRzLFxuICAgICAgICBvcGVyYXRpb25JZFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBmcmFnbWVudHM6IHsgW2ZyYWdtZW50TmFtZTogc3RyaW5nXTogTGVnYWN5RnJhZ21lbnQgfSA9IE9iamVjdC5jcmVhdGUoe30pO1xuXG4gICAgZm9yIChjb25zdCBbZnJhZ21lbnROYW1lLCBmcmFnbWVudF0gb2YgT2JqZWN0LmVudHJpZXModGhpcy5jb250ZXh0LmZyYWdtZW50cykpIHtcbiAgICAgIGNvbnN0IHsgc2VsZWN0aW9uU2V0LCB0eXBlLCAuLi5mcmFnbWVudFdpdGhvdXRTZWxlY3Rpb25TZXQgfSA9IGZyYWdtZW50O1xuICAgICAgZnJhZ21lbnRzW2ZyYWdtZW50TmFtZV0gPSB7XG4gICAgICAgIHR5cGVDb25kaXRpb246IHR5cGUsXG4gICAgICAgIHBvc3NpYmxlVHlwZXM6IHNlbGVjdGlvblNldC5wb3NzaWJsZVR5cGVzLFxuICAgICAgICAuLi5mcmFnbWVudFdpdGhvdXRTZWxlY3Rpb25TZXQsXG4gICAgICAgIC4uLnRoaXMudHJhbnNmb3JtU2VsZWN0aW9uU2V0VG9MZWdhY3lJUihzZWxlY3Rpb25TZXQpXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IGxlZ2FjeUNvbnRleHQ6IExlZ2FjeUNvbXBpbGVyQ29udGV4dCA9IHtcbiAgICAgIHNjaGVtYTogdGhpcy5jb250ZXh0LnNjaGVtYSxcbiAgICAgIG9wZXJhdGlvbnMsXG4gICAgICBmcmFnbWVudHMsXG4gICAgICB0eXBlc1VzZWQ6IHRoaXMuY29udGV4dC50eXBlc1VzZWQsXG4gICAgICBvcHRpb25zOiB0aGlzLm9wdGlvbnNcbiAgICB9O1xuXG4gICAgcmV0dXJuIGxlZ2FjeUNvbnRleHQ7XG4gIH1cblxuICB0cmFuc2Zvcm1TZWxlY3Rpb25TZXRUb0xlZ2FjeUlSKHNlbGVjdGlvblNldDogU2VsZWN0aW9uU2V0KSB7XG4gICAgY29uc3QgdHlwZUNhc2UgPSB0eXBlQ2FzZUZvclNlbGVjdGlvblNldChzZWxlY3Rpb25TZXQsIHRoaXMub3B0aW9ucy5tZXJnZUluRmllbGRzRnJvbUZyYWdtZW50U3ByZWFkcyk7XG5cbiAgICBjb25zdCBmaWVsZHM6IExlZ2FjeUZpZWxkW10gPSB0aGlzLnRyYW5zZm9ybUZpZWxkc1RvTGVnYWN5SVIoY29sbGVjdEFuZE1lcmdlRmllbGRzKHR5cGVDYXNlLmRlZmF1bHQsIGZhbHNlKSk7XG5cbiAgICBjb25zdCBpbmxpbmVGcmFnbWVudHM6IExlZ2FjeUlubGluZUZyYWdtZW50W10gPSB0eXBlQ2FzZS52YXJpYW50cy5mbGF0TWFwKHZhcmlhbnQgPT4ge1xuICAgICAgY29uc3QgZmllbGRzID0gdGhpcy50cmFuc2Zvcm1GaWVsZHNUb0xlZ2FjeUlSKGNvbGxlY3RBbmRNZXJnZUZpZWxkcyh2YXJpYW50LCBmYWxzZSkpO1xuXG4gICAgICBpZiAoXG4gICAgICAgIC8vIEZpbHRlciBvdXQgcmVjb3JkcyB0aGF0IHJlcHJlc2VudCB0aGUgc2FtZSBwb3NzaWJsZSB0eXBlcyBhcyB0aGUgZGVmYXVsdCByZWNvcmQuXG4gICAgICAgIHNlbGVjdGlvblNldC5wb3NzaWJsZVR5cGVzLmV2ZXJ5KHR5cGUgPT4gdmFyaWFudC5wb3NzaWJsZVR5cGVzLmluY2x1ZGVzKHR5cGUpKSAmJlxuICAgICAgICAvLyBGaWx0ZXIgb3V0IGVtcHR5IHJlY29yZHMgZm9yIGNvbnNpc3RlbmN5IHdpdGggbGVnYWN5IGNvbXBpbGVyLlxuICAgICAgICBmaWVsZHMubGVuZ3RoIDwgMVxuICAgICAgKVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuXG4gICAgICBjb25zdCBmcmFnbWVudFNwcmVhZHM6IHN0cmluZ1tdID0gdGhpcy5jb2xsZWN0RnJhZ21lbnRTcHJlYWRzKHNlbGVjdGlvblNldCwgdmFyaWFudC5wb3NzaWJsZVR5cGVzKS5tYXAoXG4gICAgICAgIChmcmFnbWVudFNwcmVhZDogRnJhZ21lbnRTcHJlYWQpID0+IGZyYWdtZW50U3ByZWFkLmZyYWdtZW50TmFtZVxuICAgICAgKTtcbiAgICAgIHJldHVybiB2YXJpYW50LnBvc3NpYmxlVHlwZXMubWFwKHBvc3NpYmxlVHlwZSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdHlwZUNvbmRpdGlvbjogcG9zc2libGVUeXBlLFxuICAgICAgICAgIHBvc3NpYmxlVHlwZXM6IFtwb3NzaWJsZVR5cGVdLFxuICAgICAgICAgIGZpZWxkcyxcbiAgICAgICAgICBmcmFnbWVudFNwcmVhZHNcbiAgICAgICAgfSBhcyBMZWdhY3lJbmxpbmVGcmFnbWVudDtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZm9yIChjb25zdCBpbmxpbmVGcmFnbWVudCBvZiBpbmxpbmVGcmFnbWVudHMpIHtcbiAgICAgIGlubGluZUZyYWdtZW50c1tpbmxpbmVGcmFnbWVudC50eXBlQ29uZGl0aW9uLm5hbWUgYXMgYW55XSA9IGlubGluZUZyYWdtZW50O1xuICAgIH1cblxuICAgIGNvbnN0IGZyYWdtZW50U3ByZWFkczogc3RyaW5nW10gPSB0aGlzLmNvbGxlY3RGcmFnbWVudFNwcmVhZHMoc2VsZWN0aW9uU2V0KS5tYXAoXG4gICAgICAoZnJhZ21lbnRTcHJlYWQ6IEZyYWdtZW50U3ByZWFkKSA9PiBmcmFnbWVudFNwcmVhZC5mcmFnbWVudE5hbWVcbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGZpZWxkcyxcbiAgICAgIGZyYWdtZW50U3ByZWFkcyxcbiAgICAgIGlubGluZUZyYWdtZW50c1xuICAgIH07XG4gIH1cblxuICB0cmFuc2Zvcm1GaWVsZHNUb0xlZ2FjeUlSKGZpZWxkczogRmllbGRbXSkge1xuICAgIHJldHVybiBmaWVsZHMubWFwKGZpZWxkID0+IHtcbiAgICAgIGNvbnN0IHsgYXJncywgdHlwZSwgaXNDb25kaXRpb25hbCwgZGVzY3JpcHRpb24sIGlzRGVwcmVjYXRlZCwgZGVwcmVjYXRpb25SZWFzb24sIHNlbGVjdGlvblNldCB9ID0gZmllbGQ7XG4gICAgICBjb25zdCBjb25kaXRpb25zID1cbiAgICAgICAgZmllbGQuY29uZGl0aW9ucyAmJiBmaWVsZC5jb25kaXRpb25zLmxlbmd0aCA+IDBcbiAgICAgICAgICA/IGZpZWxkLmNvbmRpdGlvbnMubWFwKCh7IGtpbmQsIHZhcmlhYmxlTmFtZSwgaW52ZXJ0ZWQgfSkgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGtpbmQsXG4gICAgICAgICAgICAgICAgdmFyaWFibGVOYW1lLFxuICAgICAgICAgICAgICAgIGludmVydGVkXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmVzcG9uc2VOYW1lOiBmaWVsZC5hbGlhcyB8fCBmaWVsZC5uYW1lLFxuICAgICAgICBmaWVsZE5hbWU6IGZpZWxkLm5hbWUsXG4gICAgICAgIHR5cGUsXG4gICAgICAgIGFyZ3MsXG4gICAgICAgIGlzQ29uZGl0aW9uYWwsXG4gICAgICAgIGNvbmRpdGlvbnMsXG4gICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICBpc0RlcHJlY2F0ZWQsXG4gICAgICAgIGRlcHJlY2F0aW9uUmVhc29uLFxuICAgICAgICAuLi5zZWxlY3Rpb25TZXQgPyB0aGlzLnRyYW5zZm9ybVNlbGVjdGlvblNldFRvTGVnYWN5SVIoc2VsZWN0aW9uU2V0KSA6IHt9XG4gICAgICB9IGFzIExlZ2FjeUZpZWxkO1xuICAgIH0pO1xuICB9XG5cbiAgY29sbGVjdEZyYWdtZW50U3ByZWFkcyhcbiAgICBzZWxlY3Rpb25TZXQ6IFNlbGVjdGlvblNldCxcbiAgICBwb3NzaWJsZVR5cGVzOiBHcmFwaFFMT2JqZWN0VHlwZVtdID0gc2VsZWN0aW9uU2V0LnBvc3NpYmxlVHlwZXNcbiAgKTogRnJhZ21lbnRTcHJlYWRbXSB7XG4gICAgY29uc3QgZnJhZ21lbnRTcHJlYWRzOiBGcmFnbWVudFNwcmVhZFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHNlbGVjdGlvbiBvZiBzZWxlY3Rpb25TZXQuc2VsZWN0aW9ucykge1xuICAgICAgc3dpdGNoIChzZWxlY3Rpb24ua2luZCkge1xuICAgICAgICBjYXNlICdGcmFnbWVudFNwcmVhZCc6XG4gICAgICAgICAgZnJhZ21lbnRTcHJlYWRzLnB1c2goc2VsZWN0aW9uKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnVHlwZUNvbmRpdGlvbic6XG4gICAgICAgICAgaWYgKHBvc3NpYmxlVHlwZXMuZXZlcnkodHlwZSA9PiBzZWxlY3Rpb24uc2VsZWN0aW9uU2V0LnBvc3NpYmxlVHlwZXMuaW5jbHVkZXModHlwZSkpKSB7XG4gICAgICAgICAgICBmcmFnbWVudFNwcmVhZHMucHVzaCguLi50aGlzLmNvbGxlY3RGcmFnbWVudFNwcmVhZHMoc2VsZWN0aW9uLnNlbGVjdGlvblNldCwgcG9zc2libGVUeXBlcykpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnQm9vbGVhbkNvbmRpdGlvbic6XG4gICAgICAgICAgZnJhZ21lbnRTcHJlYWRzLnB1c2goLi4udGhpcy5jb2xsZWN0RnJhZ21lbnRTcHJlYWRzKHNlbGVjdGlvbi5zZWxlY3Rpb25TZXQsIHBvc3NpYmxlVHlwZXMpKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBVbmlxdWUgdGhlIGZyYWdtZW50IHNwcmVhZHMgYmVmb3JlIHJldHVybmluZyB0aGVtLlxuICAgIHJldHVybiBBcnJheS5mcm9tKG5ldyBTZXQoZnJhZ21lbnRTcHJlYWRzKSk7XG4gIH1cbn1cbiJdfQ==");"use strict";
var __rest = this && this.__rest || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
    t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
    for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
    t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
const _1 = require("./");
const collectFragmentsReferenced_1 = require("./visitors/collectFragmentsReferenced");
const generateOperationId_1 = require("./visitors/generateOperationId");
const typeCase_1 = require("./visitors/typeCase");
const collectAndMergeFields_1 = require("./visitors/collectAndMergeFields");
require("../utilities/array");
function compileToLegacyIR(schema, document, options = { mergeInFieldsFromFragmentSpreads: true }) {
    const context = _1.compileToIR(schema, document, options);
    const transformer = new LegacyIRTransformer(context, options);
    return transformer.transformIR();
}
exports.compileToLegacyIR = compileToLegacyIR;
class LegacyIRTransformer {
    constructor(context, options = { mergeInFieldsFromFragmentSpreads: true }) {
        this.context = context;
        this.options = options;
    }
    transformIR() {
        const operations = Object.create({});
        for (const [operationName, operation] of Object.entries(this.context.operations)) {
            const { filePath, operationType, rootType, variables, source, selectionSet } = operation;
            const fragmentsReferenced = collectFragmentsReferenced_1.collectFragmentsReferenced(selectionSet, this.context.fragments);
            const { sourceWithFragments, operationId } = generateOperationId_1.generateOperationId(operation, this.context.fragments, fragmentsReferenced);
            operations[operationName] = Object.assign({ filePath,
                operationName,
                operationType,
                rootType,
                variables,
                source }, this.transformSelectionSetToLegacyIR(selectionSet), { fragmentsReferenced: Array.from(fragmentsReferenced), sourceWithFragments,
                operationId });
        }
        const fragments = Object.create({});
        for (const [fragmentName, fragment] of Object.entries(this.context.fragments)) {
            const { selectionSet, type } = fragment,fragmentWithoutSelectionSet = __rest(fragment, ["selectionSet", "type"]);
            fragments[fragmentName] = Object.assign({ typeCondition: type, possibleTypes: selectionSet.possibleTypes }, fragmentWithoutSelectionSet, this.transformSelectionSetToLegacyIR(selectionSet));
        }
        const legacyContext = {
            schema: this.context.schema,
            operations,
            fragments,
            typesUsed: this.context.typesUsed,
            options: this.options };

        return legacyContext;
    }
    transformSelectionSetToLegacyIR(selectionSet) {
        const typeCase = typeCase_1.typeCaseForSelectionSet(selectionSet, this.options.mergeInFieldsFromFragmentSpreads);
        const fields = this.transformFieldsToLegacyIR(collectAndMergeFields_1.collectAndMergeFields(typeCase.default, false));
        const inlineFragments = typeCase.variants.flatMap(variant => {
            const fields = this.transformFieldsToLegacyIR(collectAndMergeFields_1.collectAndMergeFields(variant, false));
            if (selectionSet.possibleTypes.every(type => variant.possibleTypes.includes(type)) &&
            fields.length < 1)
            return undefined;
            const fragmentSpreads = this.collectFragmentSpreads(selectionSet, variant.possibleTypes).map(fragmentSpread => fragmentSpread.fragmentName);
            return variant.possibleTypes.map(possibleType => {
                return {
                    typeCondition: possibleType,
                    possibleTypes: [possibleType],
                    fields,
                    fragmentSpreads };

            });
        });
        for (const inlineFragment of inlineFragments) {
            inlineFragments[inlineFragment.typeCondition.name] = inlineFragment;
        }
        const fragmentSpreads = this.collectFragmentSpreads(selectionSet).map(fragmentSpread => fragmentSpread.fragmentName);
        return {
            fields,
            fragmentSpreads,
            inlineFragments };

    }
    transformFieldsToLegacyIR(fields) {
        return fields.map(field => {
            const { args, type, isConditional, description, isDeprecated, deprecationReason, selectionSet } = field;
            const conditions = field.conditions && field.conditions.length > 0 ?
            field.conditions.map(({ kind, variableName, inverted }) => {
                return {
                    kind,
                    variableName,
                    inverted };

            }) :
            undefined;
            return Object.assign({ responseName: field.alias || field.name, fieldName: field.name, type,
                args,
                isConditional,
                conditions,
                description,
                isDeprecated,
                deprecationReason }, selectionSet ? this.transformSelectionSetToLegacyIR(selectionSet) : {});
        });
    }
    collectFragmentSpreads(selectionSet, possibleTypes = selectionSet.possibleTypes) {
        const fragmentSpreads = [];
        for (const selection of selectionSet.selections) {
            switch (selection.kind) {
                case 'FragmentSpread':
                    fragmentSpreads.push(selection);
                    break;
                case 'TypeCondition':
                    if (possibleTypes.every(type => selection.selectionSet.possibleTypes.includes(type))) {
                        fragmentSpreads.push(...this.collectFragmentSpreads(selection.selectionSet, possibleTypes));
                    }
                    break;
                case 'BooleanCondition':
                    fragmentSpreads.push(...this.collectFragmentSpreads(selection.selectionSet, possibleTypes));
                    break;}

        }
        return Array.from(new Set(fragmentSpreads));
    }}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LGVBQUw7QUFDRSx3QkFBSSxjQUFjLEtBQWQsQ0FBb0IsUUFBUSxVQUFVLFlBQVYsQ0FBdUIsYUFBdkIsQ0FBcUMsUUFBckMsQ0FBOEMsSUFBOUMsQ0FBNUIsQ0FBSixFQUFzRjtBQUNwRix3Q0FBZ0IsSUFBaEIsQ0FBcUIsR0FBRyxLQUFLLHNCQUFMLENBQTRCLFVBQVUsWUFBdEMsRUFBb0QsYUFBcEQsQ0FBeEI7QUFDRDtBQUNEO0FBQ0YscUJBQUssa0JBQUw7QUFDRSxvQ0FBZ0IsSUFBaEIsQ0FBcUIsR0FBRyxLQUFLLHNCQUFMLENBQTRCLFVBQVUsWUFBdEMsRUFBb0QsYUFBcEQsQ0FBeEI7QUFDQSwwQkFYSjs7QUFhRDtBQUdELGVBQU8sTUFBTSxJQUFOLENBQVcsSUFBSSxHQUFKLENBQVEsZUFBUixDQUFYLENBQVA7QUFDRCxLQXhKSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdyYXBoUUxTY2hlbWEsIEdyYXBoUUxUeXBlLCBHcmFwaFFMT2JqZWN0VHlwZSwgR3JhcGhRTENvbXBvc2l0ZVR5cGUsIERvY3VtZW50Tm9kZSB9IGZyb20gJ2dyYXBocWwnO1xuXG5pbXBvcnQgeyBjb21waWxlVG9JUiwgQ29tcGlsZXJDb250ZXh0LCBTZWxlY3Rpb25TZXQsIEZpZWxkLCBGcmFnbWVudFNwcmVhZCB9IGZyb20gJy4vJztcblxuaW1wb3J0IHsgY29sbGVjdEZyYWdtZW50c1JlZmVyZW5jZWQgfSBmcm9tICcuL3Zpc2l0b3JzL2NvbGxlY3RGcmFnbWVudHNSZWZlcmVuY2VkJztcbmltcG9ydCB7IGdlbmVyYXRlT3BlcmF0aW9uSWQgfSBmcm9tICcuL3Zpc2l0b3JzL2dlbmVyYXRlT3BlcmF0aW9uSWQnO1xuaW1wb3J0IHsgdHlwZUNhc2VGb3JTZWxlY3Rpb25TZXQgfSBmcm9tICcuL3Zpc2l0b3JzL3R5cGVDYXNlJztcbmltcG9ydCB7IGNvbGxlY3RBbmRNZXJnZUZpZWxkcyB9IGZyb20gJy4vdmlzaXRvcnMvY29sbGVjdEFuZE1lcmdlRmllbGRzJztcblxuaW1wb3J0ICcuLi91dGlsaXRpZXMvYXJyYXknO1xuaW1wb3J0IE1heWJlIGZyb20gJ2dyYXBocWwvdHN1dGlscy9NYXliZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tcGlsZXJPcHRpb25zIHtcbiAgYWRkVHlwZW5hbWU/OiBib29sZWFuO1xuICBtZXJnZUluRmllbGRzRnJvbUZyYWdtZW50U3ByZWFkcz86IGJvb2xlYW47XG4gIHBhc3N0aHJvdWdoQ3VzdG9tU2NhbGFycz86IGJvb2xlYW47XG4gIGN1c3RvbVNjYWxhcnNQcmVmaXg/OiBzdHJpbmc7XG4gIG5hbWVzcGFjZT86IHN0cmluZztcbiAgZ2VuZXJhdGVPcGVyYXRpb25JZHM/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIExlZ2FjeUNvbXBpbGVyQ29udGV4dCB7XG4gIHNjaGVtYTogR3JhcGhRTFNjaGVtYTtcbiAgb3BlcmF0aW9uczogeyBbb3BlcmF0aW9uTmFtZTogc3RyaW5nXTogTGVnYWN5T3BlcmF0aW9uIH07XG4gIGZyYWdtZW50czogeyBbZnJhZ21lbnROYW1lOiBzdHJpbmddOiBMZWdhY3lGcmFnbWVudCB9O1xuICB0eXBlc1VzZWQ6IEdyYXBoUUxUeXBlW107XG4gIG9wdGlvbnM6IENvbXBpbGVyT3B0aW9ucztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBMZWdhY3lPcGVyYXRpb24ge1xuICBmaWxlUGF0aD86IHN0cmluZztcbiAgb3BlcmF0aW9uTmFtZTogc3RyaW5nO1xuICBvcGVyYXRpb25JZD86IHN0cmluZztcbiAgb3BlcmF0aW9uVHlwZTogc3RyaW5nO1xuICByb290VHlwZTogR3JhcGhRTE9iamVjdFR5cGU7XG4gIHZhcmlhYmxlczoge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICB0eXBlOiBHcmFwaFFMVHlwZTtcbiAgfVtdO1xuICBzb3VyY2U6IHN0cmluZztcbiAgc291cmNlV2l0aEZyYWdtZW50cz86IHN0cmluZztcbiAgZmllbGRzOiBMZWdhY3lGaWVsZFtdO1xuICBmcmFnbWVudFNwcmVhZHM/OiBzdHJpbmdbXTtcbiAgaW5saW5lRnJhZ21lbnRzPzogTGVnYWN5SW5saW5lRnJhZ21lbnRbXTtcbiAgZnJhZ21lbnRzUmVmZXJlbmNlZDogc3RyaW5nW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGVnYWN5RnJhZ21lbnQge1xuICBmaWxlUGF0aD86IHN0cmluZztcbiAgZnJhZ21lbnROYW1lOiBzdHJpbmc7XG4gIHNvdXJjZTogc3RyaW5nO1xuICB0eXBlQ29uZGl0aW9uOiBHcmFwaFFMQ29tcG9zaXRlVHlwZTtcbiAgcG9zc2libGVUeXBlczogR3JhcGhRTE9iamVjdFR5cGVbXTtcbiAgZmllbGRzOiBMZWdhY3lGaWVsZFtdO1xuICBmcmFnbWVudFNwcmVhZHM6IHN0cmluZ1tdO1xuICBpbmxpbmVGcmFnbWVudHM6IExlZ2FjeUlubGluZUZyYWdtZW50W107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGVnYWN5SW5saW5lRnJhZ21lbnQge1xuICB0eXBlQ29uZGl0aW9uOiBHcmFwaFFMT2JqZWN0VHlwZTtcbiAgcG9zc2libGVUeXBlczogR3JhcGhRTE9iamVjdFR5cGVbXTtcbiAgZmllbGRzOiBMZWdhY3lGaWVsZFtdO1xuICBmcmFnbWVudFNwcmVhZHM6IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIExlZ2FjeUZpZWxkIHtcbiAgcmVzcG9uc2VOYW1lOiBzdHJpbmc7XG4gIGZpZWxkTmFtZTogc3RyaW5nO1xuICBhcmdzPzogQXJndW1lbnRbXTtcbiAgdHlwZTogR3JhcGhRTFR5cGU7XG4gIGRlc2NyaXB0aW9uPzogTWF5YmU8c3RyaW5nPjtcbiAgaXNDb25kaXRpb25hbD86IGJvb2xlYW47XG4gIGNvbmRpdGlvbnM/OiBCb29sZWFuQ29uZGl0aW9uW107XG4gIGlzRGVwcmVjYXRlZD86IGJvb2xlYW47XG4gIGRlcHJlY2F0aW9uUmVhc29uPzogc3RyaW5nO1xuICBmaWVsZHM/OiBMZWdhY3lGaWVsZFtdO1xuICBmcmFnbWVudFNwcmVhZHM/OiBzdHJpbmdbXTtcbiAgaW5saW5lRnJhZ21lbnRzPzogTGVnYWN5SW5saW5lRnJhZ21lbnRbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCb29sZWFuQ29uZGl0aW9uIHtcbiAgdmFyaWFibGVOYW1lOiBzdHJpbmc7XG4gIGludmVydGVkOiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFyZ3VtZW50IHtcbiAgbmFtZTogc3RyaW5nO1xuICB2YWx1ZTogYW55O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29tcGlsZVRvTGVnYWN5SVIoXG4gIHNjaGVtYTogR3JhcGhRTFNjaGVtYSxcbiAgZG9jdW1lbnQ6IERvY3VtZW50Tm9kZSxcbiAgb3B0aW9uczogQ29tcGlsZXJPcHRpb25zID0geyBtZXJnZUluRmllbGRzRnJvbUZyYWdtZW50U3ByZWFkczogdHJ1ZSB9XG4pOiBMZWdhY3lDb21waWxlckNvbnRleHQge1xuICBjb25zdCBjb250ZXh0ID0gY29tcGlsZVRvSVIoc2NoZW1hLCBkb2N1bWVudCwgb3B0aW9ucyk7XG4gIGNvbnN0IHRyYW5zZm9ybWVyID0gbmV3IExlZ2FjeUlSVHJhbnNmb3JtZXIoY29udGV4dCwgb3B0aW9ucyk7XG4gIHJldHVybiB0cmFuc2Zvcm1lci50cmFuc2Zvcm1JUigpO1xufVxuXG5jbGFzcyBMZWdhY3lJUlRyYW5zZm9ybWVyIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGNvbnRleHQ6IENvbXBpbGVyQ29udGV4dCxcbiAgICBwdWJsaWMgb3B0aW9uczogQ29tcGlsZXJPcHRpb25zID0geyBtZXJnZUluRmllbGRzRnJvbUZyYWdtZW50U3ByZWFkczogdHJ1ZSB9XG4gICkge31cblxuICB0cmFuc2Zvcm1JUigpOiBMZWdhY3lDb21waWxlckNvbnRleHQge1xuICAgIGNvbnN0IG9wZXJhdGlvbnM6IHsgW29wZXJhdGlvbk5hbWU6IHN0cmluZ106IExlZ2FjeU9wZXJhdGlvbiB9ID0gT2JqZWN0LmNyZWF0ZSh7fSk7XG5cbiAgICBmb3IgKGNvbnN0IFtvcGVyYXRpb25OYW1lLCBvcGVyYXRpb25dIG9mIE9iamVjdC5lbnRyaWVzKHRoaXMuY29udGV4dC5vcGVyYXRpb25zKSkge1xuICAgICAgY29uc3QgeyBmaWxlUGF0aCwgb3BlcmF0aW9uVHlwZSwgcm9vdFR5cGUsIHZhcmlhYmxlcywgc291cmNlLCBzZWxlY3Rpb25TZXQgfSA9IG9wZXJhdGlvbjtcbiAgICAgIGNvbnN0IGZyYWdtZW50c1JlZmVyZW5jZWQgPSBjb2xsZWN0RnJhZ21lbnRzUmVmZXJlbmNlZChzZWxlY3Rpb25TZXQsIHRoaXMuY29udGV4dC5mcmFnbWVudHMpO1xuXG4gICAgICBjb25zdCB7IHNvdXJjZVdpdGhGcmFnbWVudHMsIG9wZXJhdGlvbklkIH0gPSBnZW5lcmF0ZU9wZXJhdGlvbklkKFxuICAgICAgICBvcGVyYXRpb24sXG4gICAgICAgIHRoaXMuY29udGV4dC5mcmFnbWVudHMsXG4gICAgICAgIGZyYWdtZW50c1JlZmVyZW5jZWRcbiAgICAgICk7XG5cbiAgICAgIG9wZXJhdGlvbnNbb3BlcmF0aW9uTmFtZV0gPSB7XG4gICAgICAgIGZpbGVQYXRoLFxuICAgICAgICBvcGVyYXRpb25OYW1lLFxuICAgICAgICBvcGVyYXRpb25UeXBlLFxuICAgICAgICByb290VHlwZSxcbiAgICAgICAgdmFyaWFibGVzLFxuICAgICAgICBzb3VyY2UsXG4gICAgICAgIC4uLnRoaXMudHJhbnNmb3JtU2VsZWN0aW9uU2V0VG9MZWdhY3lJUihzZWxlY3Rpb25TZXQpLFxuICAgICAgICBmcmFnbWVudHNSZWZlcmVuY2VkOiBBcnJheS5mcm9tKGZyYWdtZW50c1JlZmVyZW5jZWQpLFxuICAgICAgICBzb3VyY2VXaXRoRnJhZ21lbnRzLFxuICAgICAgICBvcGVyYXRpb25JZFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBmcmFnbWVudHM6IHsgW2ZyYWdtZW50TmFtZTogc3RyaW5nXTogTGVnYWN5RnJhZ21lbnQgfSA9IE9iamVjdC5jcmVhdGUoe30pO1xuXG4gICAgZm9yIChjb25zdCBbZnJhZ21lbnROYW1lLCBmcmFnbWVudF0gb2YgT2JqZWN0LmVudHJpZXModGhpcy5jb250ZXh0LmZyYWdtZW50cykpIHtcbiAgICAgIGNvbnN0IHsgc2VsZWN0aW9uU2V0LCB0eXBlLCAuLi5mcmFnbWVudFdpdGhvdXRTZWxlY3Rpb25TZXQgfSA9IGZyYWdtZW50O1xuICAgICAgZnJhZ21lbnRzW2ZyYWdtZW50TmFtZV0gPSB7XG4gICAgICAgIHR5cGVDb25kaXRpb246IHR5cGUsXG4gICAgICAgIHBvc3NpYmxlVHlwZXM6IHNlbGVjdGlvblNldC5wb3NzaWJsZVR5cGVzLFxuICAgICAgICAuLi5mcmFnbWVudFdpdGhvdXRTZWxlY3Rpb25TZXQsXG4gICAgICAgIC4uLnRoaXMudHJhbnNmb3JtU2VsZWN0aW9uU2V0VG9MZWdhY3lJUihzZWxlY3Rpb25TZXQpXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IGxlZ2FjeUNvbnRleHQ6IExlZ2FjeUNvbXBpbGVyQ29udGV4dCA9IHtcbiAgICAgIHNjaGVtYTogdGhpcy5jb250ZXh0LnNjaGVtYSxcbiAgICAgIG9wZXJhdGlvbnMsXG4gICAgICBmcmFnbWVudHMsXG4gICAgICB0eXBlc1VzZWQ6IHRoaXMuY29udGV4dC50eXBlc1VzZWQsXG4gICAgICBvcHRpb25zOiB0aGlzLm9wdGlvbnNcbiAgICB9O1xuXG4gICAgcmV0dXJuIGxlZ2FjeUNvbnRleHQ7XG4gIH1cblxuICB0cmFuc2Zvcm1TZWxlY3Rpb25TZXRUb0xlZ2FjeUlSKHNlbGVjdGlvblNldDogU2VsZWN0aW9uU2V0KSB7XG4gICAgY29uc3QgdHlwZUNhc2UgPSB0eXBlQ2FzZUZvclNlbGVjdGlvblNldChzZWxlY3Rpb25TZXQsIHRoaXMub3B0aW9ucy5tZXJnZUluRmllbGRzRnJvbUZyYWdtZW50U3ByZWFkcyk7XG5cbiAgICBjb25zdCBmaWVsZHM6IExlZ2FjeUZpZWxkW10gPSB0aGlzLnRyYW5zZm9ybUZpZWxkc1RvTGVnYWN5SVIoY29sbGVjdEFuZE1lcmdlRmllbGRzKHR5cGVDYXNlLmRlZmF1bHQsIGZhbHNlKSk7XG5cbiAgICBjb25zdCBpbmxpbmVGcmFnbWVudHM6IExlZ2FjeUlubGluZUZyYWdtZW50W10gPSB0eXBlQ2FzZS52YXJpYW50cy5mbGF0TWFwKHZhcmlhbnQgPT4ge1xuICAgICAgY29uc3QgZmllbGRzID0gdGhpcy50cmFuc2Zvcm1GaWVsZHNUb0xlZ2FjeUlSKGNvbGxlY3RBbmRNZXJnZUZpZWxkcyh2YXJpYW50LCBmYWxzZSkpO1xuXG4gICAgICBpZiAoXG4gICAgICAgIC8vIEZpbHRlciBvdXQgcmVjb3JkcyB0aGF0IHJlcHJlc2VudCB0aGUgc2FtZSBwb3NzaWJsZSB0eXBlcyBhcyB0aGUgZGVmYXVsdCByZWNvcmQuXG4gICAgICAgIHNlbGVjdGlvblNldC5wb3NzaWJsZVR5cGVzLmV2ZXJ5KHR5cGUgPT4gdmFyaWFudC5wb3NzaWJsZVR5cGVzLmluY2x1ZGVzKHR5cGUpKSAmJlxuICAgICAgICAvLyBGaWx0ZXIgb3V0IGVtcHR5IHJlY29yZHMgZm9yIGNvbnNpc3RlbmN5IHdpdGggbGVnYWN5IGNvbXBpbGVyLlxuICAgICAgICBmaWVsZHMubGVuZ3RoIDwgMVxuICAgICAgKVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuXG4gICAgICBjb25zdCBmcmFnbWVudFNwcmVhZHM6IHN0cmluZ1tdID0gdGhpcy5jb2xsZWN0RnJhZ21lbnRTcHJlYWRzKHNlbGVjdGlvblNldCwgdmFyaWFudC5wb3NzaWJsZVR5cGVzKS5tYXAoXG4gICAgICAgIChmcmFnbWVudFNwcmVhZDogRnJhZ21lbnRTcHJlYWQpID0+IGZyYWdtZW50U3ByZWFkLmZyYWdtZW50TmFtZVxuICAgICAgKTtcbiAgICAgIHJldHVybiB2YXJpYW50LnBvc3NpYmxlVHlwZXMubWFwKHBvc3NpYmxlVHlwZSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdHlwZUNvbmRpdGlvbjogcG9zc2libGVUeXBlLFxuICAgICAgICAgIHBvc3NpYmxlVHlwZXM6IFtwb3NzaWJsZVR5cGVdLFxuICAgICAgICAgIGZpZWxkcyxcbiAgICAgICAgICBmcmFnbWVudFNwcmVhZHNcbiAgICAgICAgfSBhcyBMZWdhY3lJbmxpbmVGcmFnbWVudDtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZm9yIChjb25zdCBpbmxpbmVGcmFnbWVudCBvZiBpbmxpbmVGcmFnbWVudHMpIHtcbiAgICAgIGlubGluZUZyYWdtZW50c1tpbmxpbmVGcmFnbWVudC50eXBlQ29uZGl0aW9uLm5hbWUgYXMgYW55XSA9IGlubGluZUZyYWdtZW50O1xuICAgIH1cblxuICAgIGNvbnN0IGZyYWdtZW50U3ByZWFkczogc3RyaW5nW10gPSB0aGlzLmNvbGxlY3RGcmFnbWVudFNwcmVhZHMoc2VsZWN0aW9uU2V0KS5tYXAoXG4gICAgICAoZnJhZ21lbnRTcHJlYWQ6IEZyYWdtZW50U3ByZWFkKSA9PiBmcmFnbWVudFNwcmVhZC5mcmFnbWVudE5hbWVcbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGZpZWxkcyxcbiAgICAgIGZyYWdtZW50U3ByZWFkcyxcbiAgICAgIGlubGluZUZyYWdtZW50c1xuICAgIH07XG4gIH1cblxuICB0cmFuc2Zvcm1GaWVsZHNUb0xlZ2FjeUlSKGZpZWxkczogRmllbGRbXSkge1xuICAgIHJldHVybiBmaWVsZHMubWFwKGZpZWxkID0+IHtcbiAgICAgIGNvbnN0IHsgYXJncywgdHlwZSwgaXNDb25kaXRpb25hbCwgZGVzY3JpcHRpb24sIGlzRGVwcmVjYXRlZCwgZGVwcmVjYXRpb25SZWFzb24sIHNlbGVjdGlvblNldCB9ID0gZmllbGQ7XG4gICAgICBjb25zdCBjb25kaXRpb25zID1cbiAgICAgICAgZmllbGQuY29uZGl0aW9ucyAmJiBmaWVsZC5jb25kaXRpb25zLmxlbmd0aCA+IDBcbiAgICAgICAgICA/IGZpZWxkLmNvbmRpdGlvbnMubWFwKCh7IGtpbmQsIHZhcmlhYmxlTmFtZSwgaW52ZXJ0ZWQgfSkgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGtpbmQsXG4gICAgICAgICAgICAgICAgdmFyaWFibGVOYW1lLFxuICAgICAgICAgICAgICAgIGludmVydGVkXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmVzcG9uc2VOYW1lOiBmaWVsZC5hbGlhcyB8fCBmaWVsZC5uYW1lLFxuICAgICAgICBmaWVsZE5hbWU6IGZpZWxkLm5hbWUsXG4gICAgICAgIHR5cGUsXG4gICAgICAgIGFyZ3MsXG4gICAgICAgIGlzQ29uZGl0aW9uYWwsXG4gICAgICAgIGNvbmRpdGlvbnMsXG4gICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICBpc0RlcHJlY2F0ZWQsXG4gICAgICAgIGRlcHJlY2F0aW9uUmVhc29uLFxuICAgICAgICAuLi5zZWxlY3Rpb25TZXQgPyB0aGlzLnRyYW5zZm9ybVNlbGVjdGlvblNldFRvTGVnYWN5SVIoc2VsZWN0aW9uU2V0KSA6IHt9XG4gICAgICB9IGFzIExlZ2FjeUZpZWxkO1xuICAgIH0pO1xuICB9XG5cbiAgY29sbGVjdEZyYWdtZW50U3ByZWFkcyhcbiAgICBzZWxlY3Rpb25TZXQ6IFNlbGVjdGlvblNldCxcbiAgICBwb3NzaWJsZVR5cGVzOiBHcmFwaFFMT2JqZWN0VHlwZVtdID0gc2VsZWN0aW9uU2V0LnBvc3NpYmxlVHlwZXNcbiAgKTogRnJhZ21lbnRTcHJlYWRbXSB7XG4gICAgY29uc3QgZnJhZ21lbnRTcHJlYWRzOiBGcmFnbWVudFNwcmVhZFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHNlbGVjdGlvbiBvZiBzZWxlY3Rpb25TZXQuc2VsZWN0aW9ucykge1xuICAgICAgc3dpdGNoIChzZWxlY3Rpb24ua2luZCkge1xuICAgICAgICBjYXNlICdGcmFnbWVudFNwcmVhZCc6XG4gICAgICAgICAgZnJhZ21lbnRTcHJlYWRzLnB1c2goc2VsZWN0aW9uKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnVHlwZUNvbmRpdGlvbic6XG4gICAgICAgICAgaWYgKHBvc3NpYmxlVHlwZXMuZXZlcnkodHlwZSA9PiBzZWxlY3Rpb24uc2VsZWN0aW9uU2V0LnBvc3NpYmxlVHlwZXMuaW5jbHVkZXModHlwZSkpKSB7XG4gICAgICAgICAgICBmcmFnbWVudFNwcmVhZHMucHVzaCguLi50aGlzLmNvbGxlY3RGcmFnbWVudFNwcmVhZHMoc2VsZWN0aW9uLnNlbGVjdGlvblNldCwgcG9zc2libGVUeXBlcykpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnQm9vbGVhbkNvbmRpdGlvbic6XG4gICAgICAgICAgZnJhZ21lbnRTcHJlYWRzLnB1c2goLi4udGhpcy5jb2xsZWN0RnJhZ21lbnRTcHJlYWRzKHNlbGVjdGlvbi5zZWxlY3Rpb25TZXQsIHBvc3NpYmxlVHlwZXMpKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBVbmlxdWUgdGhlIGZyYWdtZW50IHNwcmVhZHMgYmVmb3JlIHJldHVybmluZyB0aGVtLlxuICAgIHJldHVybiBBcnJheS5mcm9tKG5ldyBTZXQoZnJhZ21lbnRTcHJlYWRzKSk7XG4gIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=