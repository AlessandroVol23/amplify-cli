2aa925cfd0293e860199813ccd90a2a6
'use strict';require('ts-jest').install("/c/Users/Sandro/repo/amplify-cli/packages/amplify-graphql-types-generator/src/typescript/codeGeneration.ts", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst graphql_1 = require(\"graphql\");\nconst printing_1 = require(\"../utilities/printing\");\nconst CodeGenerator_1 = require(\"../utilities/CodeGenerator\");\nconst language_1 = require(\"./language\");\nconst types_1 = require(\"./types\");\nfunction generateSource(context) {\n    const generator = new CodeGenerator_1.default(context);\n    generator.printOnNewline('/* tslint:disable */');\n    generator.printOnNewline('//  This file was automatically generated and should not be edited.');\n    context.typesUsed.forEach(type => typeDeclarationForGraphQLType(generator, type));\n    Object.values(context.operations).forEach(operation => {\n        interfaceVariablesDeclarationForOperation(generator, operation);\n        interfaceDeclarationForOperation(generator, operation);\n    });\n    Object.values(context.fragments).forEach(operation => interfaceDeclarationForFragment(generator, operation));\n    generator.printNewline();\n    return generator.output;\n}\nexports.generateSource = generateSource;\nfunction typeDeclarationForGraphQLType(generator, type) {\n    if (type instanceof graphql_1.GraphQLEnumType) {\n        enumerationDeclaration(generator, type);\n    }\n    else if (type instanceof graphql_1.GraphQLInputObjectType) {\n        structDeclarationForInputObjectType(generator, type);\n    }\n}\nexports.typeDeclarationForGraphQLType = typeDeclarationForGraphQLType;\nfunction enumerationDeclaration(generator, type) {\n    const { name, description } = type;\n    const values = type.getValues();\n    generator.printNewlineIfNeeded();\n    if (description) {\n        description.split('\\n')\n            .forEach(line => {\n            generator.printOnNewline(`// ${line.trim()}`);\n        });\n    }\n    generator.printOnNewline(`export enum ${name} {`);\n    values.forEach((value) => {\n        if (!value.description || value.description.indexOf('\\n') === -1) {\n            generator.printOnNewline(`  ${value.value} = \"${value.value}\",${printing_1.wrap(' // ', value.description || '')}`);\n        }\n        else {\n            if (value.description) {\n                value.description.split('\\n')\n                    .forEach(line => {\n                    generator.printOnNewline(`  // ${line.trim()}`);\n                });\n            }\n            generator.printOnNewline(`  ${value.value} = \"${value.value}\",`);\n        }\n    });\n    generator.printOnNewline(`}`);\n    generator.printNewline();\n}\nfunction structDeclarationForInputObjectType(generator, type) {\n    const interfaceName = type.name;\n    language_1.interfaceDeclaration(generator, {\n        interfaceName,\n    }, () => {\n        const properties = propertiesFromFields(generator.context, Object.values(type.getFields()));\n        propertyDeclarations(generator, properties, true);\n    });\n}\nfunction interfaceNameFromOperation({ operationName, operationType }) {\n    switch (operationType) {\n        case 'query':\n            return `${operationName}Query`;\n            break;\n        case 'mutation':\n            return `${operationName}Mutation`;\n            break;\n        case 'subscription':\n            return `${operationName}Subscription`;\n            break;\n        default:\n            throw new graphql_1.GraphQLError(`Unsupported operation type \"${operationType}\"`);\n    }\n}\nexports.interfaceNameFromOperation = interfaceNameFromOperation;\nfunction interfaceVariablesDeclarationForOperation(generator, { operationName, operationType, variables }) {\n    if (!variables || variables.length < 1) {\n        return;\n    }\n    const interfaceName = `${interfaceNameFromOperation({ operationName, operationType })}Variables`;\n    language_1.interfaceDeclaration(generator, {\n        interfaceName,\n    }, () => {\n        const properties = propertiesFromFields(generator.context, variables);\n        propertyDeclarations(generator, properties, true);\n    });\n}\nexports.interfaceVariablesDeclarationForOperation = interfaceVariablesDeclarationForOperation;\nfunction getObjectTypeName(type) {\n    if (graphql_1.isListType(type)) {\n        return getObjectTypeName(type.ofType);\n    }\n    if (graphql_1.isNonNullType(type)) {\n        return getObjectTypeName(type.ofType);\n    }\n    if (type instanceof graphql_1.GraphQLObjectType) {\n        return `\"${type.name}\"`;\n    }\n    if (type instanceof graphql_1.GraphQLUnionType) {\n        return type.getTypes().map(type => getObjectTypeName(type)).join(\" | \");\n    }\n    return `\"${type.name}\"`;\n}\nfunction updateTypeNameField(rootField) {\n    const fields = rootField.fields && rootField.fields.map(field => {\n        if (field.fieldName === '__typename') {\n            const objectTypeName = getObjectTypeName(rootField.type);\n            return Object.assign({}, field, { typeName: objectTypeName, type: { name: objectTypeName } });\n        }\n        if (field.fields) {\n            return updateTypeNameField(field);\n        }\n        return field;\n    });\n    return Object.assign({}, rootField, { fields });\n}\nexports.updateTypeNameField = updateTypeNameField;\nfunction interfaceDeclarationForOperation(generator, { operationName, operationType, fields }) {\n    const interfaceName = interfaceNameFromOperation({ operationName, operationType });\n    fields = fields.map(field => updateTypeNameField(field));\n    const properties = propertiesFromFields(generator.context, fields);\n    language_1.interfaceDeclaration(generator, {\n        interfaceName,\n    }, () => {\n        propertyDeclarations(generator, properties);\n    });\n}\nexports.interfaceDeclarationForOperation = interfaceDeclarationForOperation;\nfunction interfaceDeclarationForFragment(generator, fragment) {\n    const { fragmentName, typeCondition, fields, inlineFragments } = fragment;\n    const interfaceName = `${fragmentName}Fragment`;\n    language_1.interfaceDeclaration(generator, {\n        interfaceName,\n        noBrackets: graphql_1.isAbstractType(typeCondition)\n    }, () => {\n        if (graphql_1.isAbstractType(typeCondition)) {\n            const propertySets = fragment.possibleTypes\n                .map(type => {\n                const inlineFragment = inlineFragments.find(inlineFragment => {\n                    return inlineFragment.typeCondition.toString() == type.toString();\n                });\n                if (inlineFragment) {\n                    const fields = inlineFragment.fields.map(field => {\n                        if (field.fieldName === '__typename') {\n                            return Object.assign({}, field, { typeName: `\"${inlineFragment.typeCondition}\"`, type: { name: `\"${inlineFragment.typeCondition}\"` } });\n                        }\n                        else {\n                            return field;\n                        }\n                    });\n                    return propertiesFromFields(generator.context, fields);\n                }\n                else {\n                    const fragmentFields = fields.map(field => {\n                        if (field.fieldName === '__typename') {\n                            return Object.assign({}, field, { typeName: `\"${type}\"`, type: { name: `\"${type}\"` } });\n                        }\n                        else {\n                            return field;\n                        }\n                    });\n                    return propertiesFromFields(generator.context, fragmentFields);\n                }\n            });\n            language_1.propertySetsDeclaration(generator, fragment, propertySets, true);\n        }\n        else {\n            const fragmentFields = fields.map(field => {\n                if (field.fieldName === '__typename') {\n                    return Object.assign({}, field, { typeName: `\"${fragment.typeCondition}\"`, type: { name: `\"${fragment.typeCondition}\"` } });\n                }\n                else {\n                    return field;\n                }\n            });\n            const properties = propertiesFromFields(generator.context, fragmentFields);\n            propertyDeclarations(generator, properties);\n        }\n    });\n}\nexports.interfaceDeclarationForFragment = interfaceDeclarationForFragment;\nfunction propertiesFromFields(context, fields) {\n    return fields.map(field => propertyFromField(context, field));\n}\nexports.propertiesFromFields = propertiesFromFields;\nfunction propertyFromField(context, field) {\n    let { name: fieldName, type: fieldType, description, fragmentSpreads, inlineFragments } = field;\n    fieldName = fieldName || field.responseName;\n    const propertyName = fieldName;\n    let property = { fieldName, fieldType, propertyName, description };\n    const namedType = graphql_1.getNamedType(fieldType);\n    let isNullable = true;\n    if (fieldType instanceof graphql_1.GraphQLNonNull) {\n        isNullable = false;\n    }\n    if (graphql_1.isCompositeType(namedType)) {\n        const typeName = types_1.typeNameFromGraphQLType(context, fieldType);\n        let isArray = false;\n        let isArrayElementNullable = null;\n        if (graphql_1.isListType(fieldType)) {\n            isArray = true;\n            isArrayElementNullable = !(fieldType.ofType instanceof graphql_1.GraphQLNonNull);\n        }\n        else if (graphql_1.isNonNullType(fieldType) && graphql_1.isListType(fieldType.ofType)) {\n            isArray = true;\n            isArrayElementNullable = !(fieldType.ofType.ofType instanceof graphql_1.GraphQLNonNull);\n        }\n        return Object.assign({}, property, { typeName, fields: field.fields, isComposite: true, fragmentSpreads, inlineFragments, fieldType,\n            isArray, isNullable, isArrayElementNullable });\n    }\n    else {\n        if (field.fieldName === '__typename') {\n            const typeName = types_1.typeNameFromGraphQLType(context, fieldType, null, false);\n            return Object.assign({}, property, { typeName, isComposite: false, fieldType, isNullable: false });\n        }\n        else {\n            const typeName = types_1.typeNameFromGraphQLType(context, fieldType, null, isNullable);\n            return Object.assign({}, property, { typeName, isComposite: false, fieldType, isNullable });\n        }\n    }\n}\nexports.propertyFromField = propertyFromField;\nfunction propertyDeclarations(generator, properties, isInput = false) {\n    if (!properties)\n        return;\n    properties.forEach(property => {\n        if (graphql_1.isAbstractType(graphql_1.getNamedType(property.type || property.fieldType))) {\n            const propertySets = getPossibleTypeNames(generator, property)\n                .map(type => {\n                const inlineFragment = property.inlineFragments && property.inlineFragments.find(inlineFragment => {\n                    return inlineFragment.typeCondition.toString() == type;\n                });\n                if (inlineFragment) {\n                    const fields = inlineFragment.fields.map(field => {\n                        if (field.fieldName === '__typename') {\n                            return Object.assign({}, field, { typeName: `\"${inlineFragment.typeCondition}\"`, type: { name: `\"${inlineFragment.typeCondition}\"` } });\n                        }\n                        else {\n                            return field;\n                        }\n                    });\n                    return propertiesFromFields(generator.context, fields);\n                }\n                else {\n                    const fields = property.fields.map(field => {\n                        if (field.fieldName === '__typename') {\n                            return Object.assign({}, field, { typeName: `\"${type}\"`, type: { name: `\"${type}\"` } });\n                        }\n                        else {\n                            return field;\n                        }\n                    });\n                    return propertiesFromFields(generator.context, fields);\n                }\n            });\n            language_1.propertySetsDeclaration(generator, property, propertySets);\n        }\n        else {\n            if (property.fields && property.fields.length > 0\n                || property.inlineFragments && property.inlineFragments.length > 0\n                || property.fragmentSpreads && property.fragmentSpreads.length > 0) {\n                language_1.propertyDeclaration(generator, property, () => {\n                    const properties = propertiesFromFields(generator.context, property.fields);\n                    propertyDeclarations(generator, properties, isInput);\n                });\n            }\n            else {\n                language_1.propertyDeclaration(generator, Object.assign({}, property, { isInput }));\n            }\n        }\n    });\n}\nexports.propertyDeclarations = propertyDeclarations;\nfunction getPossibleTypeNames(generator, property) {\n    const type = graphql_1.getNamedType(property.fieldType || property.type);\n    if (type instanceof graphql_1.GraphQLUnionType || type instanceof graphql_1.GraphQLInterfaceType) {\n        return generator.context.schema.getPossibleTypes(type).map(type => type.name);\n    }\n    return [];\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZUdlbmVyYXRpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjb2RlR2VuZXJhdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLHFDQWNnQjtBQUVoQixvREFFK0I7QUFFL0IsOERBQXVEO0FBRXZELHlDQUtvQjtBQUVwQixtQ0FFaUI7QUFHakIsd0JBQStCLE9BQThCO0lBQzNELE1BQU0sU0FBUyxHQUFHLElBQUksdUJBQWEsQ0FBd0IsT0FBTyxDQUFDLENBQUM7SUFFcEUsU0FBUyxDQUFDLGNBQWMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0lBQ2pELFNBQVMsQ0FBQyxjQUFjLENBQUMscUVBQXFFLENBQUMsQ0FBQztJQUVoRyxPQUFPLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUMvQiw2QkFBNkIsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQy9DLENBQUM7SUFDRixNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEVBQUU7UUFDcEQseUNBQXlDLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQ2hFLGdDQUFnQyxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUN6RCxDQUFDLENBQUMsQ0FBQztJQUNILE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUNuRCwrQkFBK0IsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQ3RELENBQUM7SUFFRixTQUFTLENBQUMsWUFBWSxFQUFFLENBQUM7SUFFekIsT0FBTyxTQUFTLENBQUMsTUFBTSxDQUFDO0FBQzFCLENBQUM7QUFwQkQsd0NBb0JDO0FBRUQsdUNBQThDLFNBQXdCLEVBQUUsSUFBaUI7SUFDdkYsSUFBSSxJQUFJLFlBQVkseUJBQWUsRUFBRTtRQUNuQyxzQkFBc0Is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LENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUMvRTtJQUVELE9BQU8sRUFBRSxDQUFDO0FBQ1osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExlZ2FjeUNvbXBpbGVyQ29udGV4dCwgTGVnYWN5SW5saW5lRnJhZ21lbnQsIExlZ2FjeUZyYWdtZW50LCBMZWdhY3lGaWVsZCwgTGVnYWN5T3BlcmF0aW9uIH0gZnJvbSAnLi4vY29tcGlsZXIvbGVnYWN5SVInO1xuaW1wb3J0IHtcbiAgR3JhcGhRTEVycm9yLFxuICBnZXROYW1lZFR5cGUsXG4gIGlzQ29tcG9zaXRlVHlwZSxcbiAgaXNBYnN0cmFjdFR5cGUsXG4gIEdyYXBoUUxFbnVtVHlwZSxcbiAgR3JhcGhRTE5vbk51bGwsXG4gIEdyYXBoUUxJbnB1dE9iamVjdFR5cGUsXG4gIEdyYXBoUUxUeXBlLFxuICBHcmFwaFFMVW5pb25UeXBlLFxuICBHcmFwaFFMSW50ZXJmYWNlVHlwZSxcbiAgR3JhcGhRTE9iamVjdFR5cGUsXG4gIGlzTGlzdFR5cGUsXG4gIGlzTm9uTnVsbFR5cGVcbn0gZnJvbSAnZ3JhcGhxbCdcblxuaW1wb3J0IHtcbiAgd3JhcFxufSBmcm9tICcuLi91dGlsaXRpZXMvcHJpbnRpbmcnO1xuXG5pbXBvcnQgQ29kZUdlbmVyYXRvciBmcm9tICcuLi91dGlsaXRpZXMvQ29kZUdlbmVyYXRvcic7XG5cbmltcG9ydCB7XG4gIGludGVyZmFjZURlY2xhcmF0aW9uLFxuICBwcm9wZXJ0eURlY2xhcmF0aW9uLFxuICBwcm9wZXJ0eVNldHNEZWNsYXJhdGlvbixcbiAgUHJvcGVydHlcbn0gZnJvbSAnLi9sYW5ndWFnZSc7XG5cbmltcG9ydCB7XG4gIHR5cGVOYW1lRnJvbUdyYXBoUUxUeXBlLFxufSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCBNYXliZSBmcm9tICdncmFwaHFsL3RzdXRpbHMvTWF5YmUnO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVTb3VyY2UoY29udGV4dDogTGVnYWN5Q29tcGlsZXJDb250ZXh0KSB7XG4gIGNvbnN0IGdlbmVyYXRvciA9IG5ldyBDb2RlR2VuZXJhdG9yPExlZ2FjeUNvbXBpbGVyQ29udGV4dD4oY29udGV4dCk7XG5cbiAgZ2VuZXJhdG9yLnByaW50T25OZXdsaW5lKCcvKiB0c2xpbnQ6ZGlzYWJsZSAqLycpO1xuICBnZW5lcmF0b3IucHJpbnRPbk5ld2xpbmUoJy8vICBUaGlzIGZpbGUgd2FzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGFuZCBzaG91bGQgbm90IGJlIGVkaXRlZC4nKTtcblxuICBjb250ZXh0LnR5cGVzVXNlZC5mb3JFYWNoKHR5cGUgPT5cbiAgICB0eXBlRGVjbGFyYXRpb25Gb3JHcmFwaFFMVHlwZShnZW5lcmF0b3IsIHR5cGUpXG4gICk7XG4gIE9iamVjdC52YWx1ZXMoY29udGV4dC5vcGVyYXRpb25zKS5mb3JFYWNoKG9wZXJhdGlvbiA9PiB7XG4gICAgaW50ZXJmYWNlVmFyaWFibGVzRGVjbGFyYXRpb25Gb3JPcGVyYXRpb24oZ2VuZXJhdG9yLCBvcGVyYXRpb24pO1xuICAgIGludGVyZmFjZURlY2xhcmF0aW9uRm9yT3BlcmF0aW9uKGdlbmVyYXRvciwgb3BlcmF0aW9uKTtcbiAgfSk7XG4gIE9iamVjdC52YWx1ZXMoY29udGV4dC5mcmFnbWVudHMpLmZvckVhY2gob3BlcmF0aW9uID0+XG4gICAgaW50ZXJmYWNlRGVjbGFyYXRpb25Gb3JGcmFnbWVudChnZW5lcmF0b3IsIG9wZXJhdGlvbilcbiAgKTtcblxuICBnZW5lcmF0b3IucHJpbnROZXdsaW5lKCk7XG5cbiAgcmV0dXJuIGdlbmVyYXRvci5vdXRwdXQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0eXBlRGVjbGFyYXRpb25Gb3JHcmFwaFFMVHlwZShnZW5lcmF0b3I6IENvZGVHZW5lcmF0b3IsIHR5cGU6IEdyYXBoUUxUeXBlKSB7XG4gIGlmICh0eXBlIGluc3RhbmNlb2YgR3JhcGhRTEVudW1UeXBlKSB7XG4gICAgZW51bWVyYXRpb25EZWNsYXJhdGlvbihnZW5lcmF0b3IsIHR5cGUpO1xuICB9IGVsc2UgaWYgKHR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMSW5wdXRPYmplY3RUeXBlKSB7XG4gICAgc3RydWN0RGVjbGFyYXRpb25Gb3JJbnB1dE9iamVjdFR5cGUoZ2VuZXJhdG9yLCB0eXBlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBlbnVtZXJhdGlvbkRlY2xhcmF0aW9uKGdlbmVyYXRvcjogQ29kZUdlbmVyYXRvciwgdHlwZTogR3JhcGhRTEVudW1UeXBlKSB7XG4gIGNvbnN0IHsgbmFtZSwgZGVzY3JpcHRpb24gfSA9IHR5cGU7XG4gIGNvbnN0IHZhbHVlcyA9IHR5cGUuZ2V0VmFsdWVzKCk7XG5cbiAgZ2VuZXJhdG9yLnByaW50TmV3bGluZUlmTmVlZGVkKCk7XG4gIGlmIChkZXNjcmlwdGlvbikge1xuICAgIGRlc2NyaXB0aW9uLnNwbGl0KCdcXG4nKVxuICAgICAgLmZvckVhY2gobGluZSA9PiB7XG4gICAgICAgIGdlbmVyYXRvci5wcmludE9uTmV3bGluZShgLy8gJHtsaW5lLnRyaW0oKX1gKTtcbiAgICAgIH0pXG4gIH1cbiAgZ2VuZXJhdG9yLnByaW50T25OZXdsaW5lKGBleHBvcnQgZW51bSAke25hbWV9IHtgKTtcbiAgdmFsdWVzLmZvckVhY2goKHZhbHVlKSA9PiB7XG4gICAgaWYgKCF2YWx1ZS5kZXNjcmlwdGlvbiB8fCB2YWx1ZS5kZXNjcmlwdGlvbi5pbmRleE9mKCdcXG4nKSA9PT0gLTEpIHtcbiAgICAgIGdlbmVyYXRvci5wcmludE9uTmV3bGluZShgICAke3ZhbHVlLnZhbHVlfSA9IFwiJHt2YWx1ZS52YWx1ZX1cIiwke3dyYXAoJyAvLyAnLCB2YWx1ZS5kZXNjcmlwdGlvbiB8fCAnJyl9YClcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHZhbHVlLmRlc2NyaXB0aW9uKSB7XG4gICAgICAgIHZhbHVlLmRlc2NyaXB0aW9uLnNwbGl0KCdcXG4nKVxuICAgICAgICAgIC5mb3JFYWNoKGxpbmUgPT4ge1xuICAgICAgICAgICAgZ2VuZXJhdG9yLnByaW50T25OZXdsaW5lKGAgIC8vICR7bGluZS50cmltKCl9YCk7XG4gICAgICAgICAgfSlcbiAgICAgIH1cbiAgICAgIGdlbmVyYXRvci5wcmludE9uTmV3bGluZShgICAke3ZhbHVlLnZhbHVlfSA9IFwiJHt2YWx1ZS52YWx1ZX1cIixgKVxuICAgIH1cbiAgfSk7XG4gIGdlbmVyYXRvci5wcmludE9uTmV3bGluZShgfWApO1xuICBnZW5lcmF0b3IucHJpbnROZXdsaW5lKCk7XG59XG5cbmZ1bmN0aW9uIHN0cnVjdERlY2xhcmF0aW9uRm9ySW5wdXRPYmplY3RUeXBlKFxuICBnZW5lcmF0b3I6IENvZGVHZW5lcmF0b3IsXG4gIHR5cGU6IEdyYXBoUUxJbnB1dE9iamVjdFR5cGVcbikge1xuICBjb25zdCBpbnRlcmZhY2VOYW1lID0gdHlwZS5uYW1lO1xuICBpbnRlcmZhY2VEZWNsYXJhdGlvbihnZW5lcmF0b3IsIHtcbiAgICBpbnRlcmZhY2VOYW1lLFxuICB9LCAoKSA9PiB7XG4gICAgY29uc3QgcHJvcGVydGllcyA9IHByb3BlcnRpZXNGcm9tRmllbGRzKGdlbmVyYXRvci5jb250ZXh0LCBPYmplY3QudmFsdWVzKHR5cGUuZ2V0RmllbGRzKCkpKTtcbiAgICBwcm9wZXJ0eURlY2xhcmF0aW9ucyhnZW5lcmF0b3IsIHByb3BlcnRpZXMsIHRydWUpO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGludGVyZmFjZU5hbWVGcm9tT3BlcmF0aW9uKHsgb3BlcmF0aW9uTmFtZSwgb3BlcmF0aW9uVHlwZSB9OiB7IG9wZXJhdGlvbk5hbWU6IHN0cmluZywgb3BlcmF0aW9uVHlwZTogc3RyaW5nIH0pIHtcbiAgc3dpdGNoIChvcGVyYXRpb25UeXBlKSB7XG4gICAgY2FzZSAncXVlcnknOlxuICAgICAgcmV0dXJuIGAke29wZXJhdGlvbk5hbWV9UXVlcnlgO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnbXV0YXRpb24nOlxuICAgICAgcmV0dXJuIGAke29wZXJhdGlvbk5hbWV9TXV0YXRpb25gO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnc3Vic2NyaXB0aW9uJzpcbiAgICAgIHJldHVybiBgJHtvcGVyYXRpb25OYW1lfVN1YnNjcmlwdGlvbmA7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgbmV3IEdyYXBoUUxFcnJvcihgVW5zdXBwb3J0ZWQgb3BlcmF0aW9uIHR5cGUgXCIke29wZXJhdGlvblR5cGV9XCJgKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaW50ZXJmYWNlVmFyaWFibGVzRGVjbGFyYXRpb25Gb3JPcGVyYXRpb24oXG4gIGdlbmVyYXRvcjogQ29kZUdlbmVyYXRvcixcbiAge1xuICAgIG9wZXJhdGlvbk5hbWUsXG4gICAgb3BlcmF0aW9uVHlwZSxcbiAgICB2YXJpYWJsZXNcbiAgfTogTGVnYWN5T3BlcmF0aW9uXG4pIHtcbiAgaWYgKCF2YXJpYWJsZXMgfHwgdmFyaWFibGVzLmxlbmd0aCA8IDEpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgaW50ZXJmYWNlTmFtZSA9IGAke2ludGVyZmFjZU5hbWVGcm9tT3BlcmF0aW9uKHsgb3BlcmF0aW9uTmFtZSwgb3BlcmF0aW9uVHlwZSB9KX1WYXJpYWJsZXNgO1xuXG4gIGludGVyZmFjZURlY2xhcmF0aW9uKGdlbmVyYXRvciwge1xuICAgIGludGVyZmFjZU5hbWUsXG4gIH0sICgpID0+IHtcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gcHJvcGVydGllc0Zyb21GaWVsZHMoZ2VuZXJhdG9yLmNvbnRleHQsIHZhcmlhYmxlcyk7XG4gICAgcHJvcGVydHlEZWNsYXJhdGlvbnMoZ2VuZXJhdG9yLCBwcm9wZXJ0aWVzLCB0cnVlKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldE9iamVjdFR5cGVOYW1lKHR5cGU6IEdyYXBoUUxUeXBlKTogc3RyaW5nIHtcbiAgaWYgKGlzTGlzdFR5cGUodHlwZSkpIHtcbiAgICByZXR1cm4gZ2V0T2JqZWN0VHlwZU5hbWUodHlwZS5vZlR5cGUpO1xuICB9XG4gIGlmIChpc05vbk51bGxUeXBlKHR5cGUpKSB7XG4gICAgcmV0dXJuIGdldE9iamVjdFR5cGVOYW1lKHR5cGUub2ZUeXBlKTtcbiAgfVxuICBpZiAodHlwZSBpbnN0YW5jZW9mIEdyYXBoUUxPYmplY3RUeXBlKSB7XG4gICAgcmV0dXJuIGBcIiR7dHlwZS5uYW1lfVwiYDtcbiAgfVxuICBpZiAodHlwZSBpbnN0YW5jZW9mIEdyYXBoUUxVbmlvblR5cGUpIHtcbiAgICByZXR1cm4gdHlwZS5nZXRUeXBlcygpLm1hcCh0eXBlID0+IGdldE9iamVjdFR5cGVOYW1lKHR5cGUpKS5qb2luKFwiIHwgXCIpO1xuICB9XG4gIHJldHVybiBgXCIke3R5cGUubmFtZX1cImA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVUeXBlTmFtZUZpZWxkKHJvb3RGaWVsZDogTGVnYWN5RmllbGQpOiBMZWdhY3lGaWVsZCB7XG4gIGNvbnN0IGZpZWxkcyA9IHJvb3RGaWVsZC5maWVsZHMgJiYgcm9vdEZpZWxkLmZpZWxkcy5tYXAoZmllbGQgPT4ge1xuICAgIGlmIChmaWVsZC5maWVsZE5hbWUgPT09ICdfX3R5cGVuYW1lJykge1xuICAgICAgY29uc3Qgb2JqZWN0VHlwZU5hbWUgPSBnZXRPYmplY3RUeXBlTmFtZShyb290RmllbGQudHlwZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5maWVsZCxcbiAgICAgICAgdHlwZU5hbWU6IG9iamVjdFR5cGVOYW1lLFxuICAgICAgICB0eXBlOiB7IG5hbWU6IG9iamVjdFR5cGVOYW1lIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmIChmaWVsZC5maWVsZHMpIHtcbiAgICAgIHJldHVybiB1cGRhdGVUeXBlTmFtZUZpZWxkKGZpZWxkKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmllbGQ7XG4gIH0pO1xuICByZXR1cm4ge1xuICAgIC4uLnJvb3RGaWVsZCxcbiAgICBmaWVsZHMsXG4gIH0gYXMgTGVnYWN5RmllbGQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbnRlcmZhY2VEZWNsYXJhdGlvbkZvck9wZXJhdGlvbihcbiAgZ2VuZXJhdG9yOiBDb2RlR2VuZXJhdG9yLFxuICB7XG4gICAgb3BlcmF0aW9uTmFtZSxcbiAgICBvcGVyYXRpb25UeXBlLFxuICAgIGZpZWxkc1xuICB9OiBMZWdhY3lPcGVyYXRpb25cbikge1xuICBjb25zdCBpbnRlcmZhY2VOYW1lID0gaW50ZXJmYWNlTmFtZUZyb21PcGVyYXRpb24oeyBvcGVyYXRpb25OYW1lLCBvcGVyYXRpb25UeXBlIH0pO1xuICBmaWVsZHMgPSBmaWVsZHMubWFwKGZpZWxkID0+IHVwZGF0ZVR5cGVOYW1lRmllbGQoZmllbGQpKTtcbiAgY29uc3QgcHJvcGVydGllcyA9IHByb3BlcnRpZXNGcm9tRmllbGRzKGdlbmVyYXRvci5jb250ZXh0LCBmaWVsZHMpO1xuICBpbnRlcmZhY2VEZWNsYXJhdGlvbihnZW5lcmF0b3IsIHtcbiAgICBpbnRlcmZhY2VOYW1lLFxuICB9LCAoKSA9PiB7XG4gICAgcHJvcGVydHlEZWNsYXJhdGlvbnMoZ2VuZXJhdG9yLCBwcm9wZXJ0aWVzKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbnRlcmZhY2VEZWNsYXJhdGlvbkZvckZyYWdtZW50KFxuICBnZW5lcmF0b3I6IENvZGVHZW5lcmF0b3IsXG4gIGZyYWdtZW50OiBMZWdhY3lGcmFnbWVudFxuKSB7XG4gIGNvbnN0IHtcbiAgICBmcmFnbWVudE5hbWUsXG4gICAgdHlwZUNvbmRpdGlvbixcbiAgICBmaWVsZHMsXG4gICAgaW5saW5lRnJhZ21lbnRzXG4gIH0gPSBmcmFnbWVudDtcblxuICBjb25zdCBpbnRlcmZhY2VOYW1lID0gYCR7ZnJhZ21lbnROYW1lfUZyYWdtZW50YDtcblxuICBpbnRlcmZhY2VEZWNsYXJhdGlvbihnZW5lcmF0b3IsIHtcbiAgICBpbnRlcmZhY2VOYW1lLFxuICAgIG5vQnJhY2tldHM6IGlzQWJzdHJhY3RUeXBlKHR5cGVDb25kaXRpb24pXG4gIH0sICgpID0+IHtcbiAgICBpZiAoaXNBYnN0cmFjdFR5cGUodHlwZUNvbmRpdGlvbikpIHtcbiAgICAgIGNvbnN0IHByb3BlcnR5U2V0cyA9IGZyYWdtZW50LnBvc3NpYmxlVHlwZXNcbiAgICAgICAgLm1hcCh0eXBlID0+IHtcbiAgICAgICAgICAvLyBOT1RFOiBpbmxpbmVGcmFnbWVudCBjdXJyZW50bHkgY29uc2lzdHMgb2YgdGhlIG1lcmdlZCBmaWVsZHNcbiAgICAgICAgICAvLyBmcm9tIGJvdGggaW5saW5lIGZyYWdtZW50cyBhbmQgZnJhZ21lbnQgc3ByZWFkcy5cbiAgICAgICAgICAvLyBUT0RPOiBSZW5hbWUgaW5saW5lRnJhZ21lbnRzIGluIHRoZSBJUi5cbiAgICAgICAgICBjb25zdCBpbmxpbmVGcmFnbWVudCA9IGlubGluZUZyYWdtZW50cy5maW5kKGlubGluZUZyYWdtZW50ID0+IHtcbiAgICAgICAgICAgIHJldHVybiBpbmxpbmVGcmFnbWVudC50eXBlQ29uZGl0aW9uLnRvU3RyaW5nKCkgPT0gdHlwZS50b1N0cmluZygpXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpZiAoaW5saW5lRnJhZ21lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IGlubGluZUZyYWdtZW50LmZpZWxkcy5tYXAoZmllbGQgPT4ge1xuICAgICAgICAgICAgICBpZiAoZmllbGQuZmllbGROYW1lID09PSAnX190eXBlbmFtZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgLi4uZmllbGQsXG4gICAgICAgICAgICAgICAgICB0eXBlTmFtZTogYFwiJHtpbmxpbmVGcmFnbWVudC50eXBlQ29uZGl0aW9ufVwiYCxcbiAgICAgICAgICAgICAgICAgIHR5cGU6IHsgbmFtZTogYFwiJHtpbmxpbmVGcmFnbWVudC50eXBlQ29uZGl0aW9ufVwiYCB9IGFzIEdyYXBoUUxUeXBlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhnZW5lcmF0b3IuY29udGV4dCwgZmllbGRzKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgZnJhZ21lbnRGaWVsZHMgPSBmaWVsZHMubWFwKGZpZWxkID0+IHtcbiAgICAgICAgICAgICAgaWYgKGZpZWxkLmZpZWxkTmFtZSA9PT0gJ19fdHlwZW5hbWUnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgIC4uLmZpZWxkLFxuICAgICAgICAgICAgICAgICAgdHlwZU5hbWU6IGBcIiR7dHlwZX1cImAsXG4gICAgICAgICAgICAgICAgICB0eXBlOiB7IG5hbWU6IGBcIiR7dHlwZX1cImAgfSBhcyBHcmFwaFFMVHlwZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gcHJvcGVydGllc0Zyb21GaWVsZHMoZ2VuZXJhdG9yLmNvbnRleHQsIGZyYWdtZW50RmllbGRzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICBwcm9wZXJ0eVNldHNEZWNsYXJhdGlvbihnZW5lcmF0b3IsIGZyYWdtZW50LCBwcm9wZXJ0eVNldHMsIHRydWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBmcmFnbWVudEZpZWxkcyA9IGZpZWxkcy5tYXAoZmllbGQgPT4ge1xuICAgICAgICBpZiAoZmllbGQuZmllbGROYW1lID09PSAnX190eXBlbmFtZScpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uZmllbGQsXG4gICAgICAgICAgICB0eXBlTmFtZTogYFwiJHtmcmFnbWVudC50eXBlQ29uZGl0aW9ufVwiYCxcbiAgICAgICAgICAgIHR5cGU6IHsgbmFtZTogYFwiJHtmcmFnbWVudC50eXBlQ29uZGl0aW9ufVwiYCB9IGFzIEdyYXBoUUxUeXBlXG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhnZW5lcmF0b3IuY29udGV4dCwgZnJhZ21lbnRGaWVsZHMpXG4gICAgICBwcm9wZXJ0eURlY2xhcmF0aW9ucyhnZW5lcmF0b3IsIHByb3BlcnRpZXMpO1xuICAgIH1cbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhjb250ZXh0OiBMZWdhY3lDb21waWxlckNvbnRleHQsIGZpZWxkczoge1xuICBuYW1lPzogc3RyaW5nLFxuICB0eXBlOiBHcmFwaFFMVHlwZSxcbiAgcmVzcG9uc2VOYW1lPzogc3RyaW5nLFxuICBkZXNjcmlwdGlvbj86IE1heWJlPHN0cmluZz4sXG4gIGZyYWdtZW50U3ByZWFkcz86IGFueSxcbiAgaW5saW5lRnJhZ21lbnRzPzogTGVnYWN5SW5saW5lRnJhZ21lbnRbXSxcbiAgZmllbGROYW1lPzogc3RyaW5nXG59W10pIHtcbiAgcmV0dXJuIGZpZWxkcy5tYXAoZmllbGQgPT4gcHJvcGVydHlGcm9tRmllbGQoY29udGV4dCwgZmllbGQpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByb3BlcnR5RnJvbUZpZWxkKGNvbnRleHQ6IExlZ2FjeUNvbXBpbGVyQ29udGV4dCwgZmllbGQ6IHtcbiAgbmFtZT86IHN0cmluZyxcbiAgdHlwZTogR3JhcGhRTFR5cGUsXG4gIGZpZWxkcz86IGFueVtdLFxuICByZXNwb25zZU5hbWU/OiBzdHJpbmcsXG4gIGRlc2NyaXB0aW9uPzogTWF5YmU8c3RyaW5nPixcbiAgZnJhZ21lbnRTcHJlYWRzPzogYW55LFxuICBpbmxpbmVGcmFnbWVudHM/OiBMZWdhY3lJbmxpbmVGcmFnbWVudFtdLFxuICBmaWVsZE5hbWU/OiBzdHJpbmdcbn0pOiBQcm9wZXJ0eSB7XG4gIGxldCB7IG5hbWU6IGZpZWxkTmFtZSwgdHlwZTogZmllbGRUeXBlLCBkZXNjcmlwdGlvbiwgZnJhZ21lbnRTcHJlYWRzLCBpbmxpbmVGcmFnbWVudHMgfSA9IGZpZWxkO1xuICBmaWVsZE5hbWUgPSBmaWVsZE5hbWUgfHwgZmllbGQucmVzcG9uc2VOYW1lO1xuXG4gIGNvbnN0IHByb3BlcnR5TmFtZSA9IGZpZWxkTmFtZTtcblxuICBsZXQgcHJvcGVydHkgPSB7IGZpZWxkTmFtZSwgZmllbGRUeXBlLCBwcm9wZXJ0eU5hbWUsIGRlc2NyaXB0aW9uIH07XG5cbiAgY29uc3QgbmFtZWRUeXBlID0gZ2V0TmFtZWRUeXBlKGZpZWxkVHlwZSk7XG5cbiAgbGV0IGlzTnVsbGFibGUgPSB0cnVlO1xuICBpZiAoZmllbGRUeXBlIGluc3RhbmNlb2YgR3JhcGhRTE5vbk51bGwpIHtcbiAgICBpc051bGxhYmxlID0gZmFsc2U7XG4gIH1cblxuICBpZiAoaXNDb21wb3NpdGVUeXBlKG5hbWVkVHlwZSkpIHtcbiAgICBjb25zdCB0eXBlTmFtZSA9IHR5cGVOYW1lRnJvbUdyYXBoUUxUeXBlKGNvbnRleHQsIGZpZWxkVHlwZSk7XG4gICAgbGV0IGlzQXJyYXkgPSBmYWxzZTtcbiAgICBsZXQgaXNBcnJheUVsZW1lbnROdWxsYWJsZSA9IG51bGw7XG4gICAgaWYgKGlzTGlzdFR5cGUoZmllbGRUeXBlKSkge1xuICAgICAgaXNBcnJheSA9IHRydWU7XG4gICAgICBpc0FycmF5RWxlbWVudE51bGxhYmxlID0gIShmaWVsZFR5cGUub2ZUeXBlIGluc3RhbmNlb2YgR3JhcGhRTE5vbk51bGwpO1xuICAgIH0gZWxzZSBpZiAoaXNOb25OdWxsVHlwZShmaWVsZFR5cGUpICAmJiBpc0xpc3RUeXBlKGZpZWxkVHlwZS5vZlR5cGUpKSB7XG4gICAgICBpc0FycmF5ID0gdHJ1ZVxuICAgICAgaXNBcnJheUVsZW1lbnROdWxsYWJsZSA9ICEoZmllbGRUeXBlLm9mVHlwZS5vZlR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMTm9uTnVsbCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnByb3BlcnR5LFxuICAgICAgdHlwZU5hbWUsXG4gICAgICBmaWVsZHM6IGZpZWxkLmZpZWxkcyxcbiAgICAgIGlzQ29tcG9zaXRlOiB0cnVlLFxuICAgICAgZnJhZ21lbnRTcHJlYWRzLCBpbmxpbmVGcmFnbWVudHMsIGZpZWxkVHlwZSxcbiAgICAgIGlzQXJyYXksIGlzTnVsbGFibGUsIGlzQXJyYXlFbGVtZW50TnVsbGFibGUsXG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICBpZiAoZmllbGQuZmllbGROYW1lID09PSAnX190eXBlbmFtZScpIHtcbiAgICAgIGNvbnN0IHR5cGVOYW1lID0gdHlwZU5hbWVGcm9tR3JhcGhRTFR5cGUoY29udGV4dCwgZmllbGRUeXBlLCBudWxsLCBmYWxzZSk7XG4gICAgICByZXR1cm4geyAuLi5wcm9wZXJ0eSwgdHlwZU5hbWUsIGlzQ29tcG9zaXRlOiBmYWxzZSwgZmllbGRUeXBlLCBpc051bGxhYmxlOiBmYWxzZSB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB0eXBlTmFtZSA9IHR5cGVOYW1lRnJvbUdyYXBoUUxUeXBlKGNvbnRleHQsIGZpZWxkVHlwZSwgbnVsbCwgaXNOdWxsYWJsZSk7XG4gICAgICByZXR1cm4geyAuLi5wcm9wZXJ0eSwgdHlwZU5hbWUsIGlzQ29tcG9zaXRlOiBmYWxzZSwgZmllbGRUeXBlLCBpc051bGxhYmxlIH07XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcm9wZXJ0eURlY2xhcmF0aW9ucyhnZW5lcmF0b3I6IENvZGVHZW5lcmF0b3IsIHByb3BlcnRpZXM6IFByb3BlcnR5W10sIGlzSW5wdXQgPSBmYWxzZSkge1xuXG4gIGlmICghcHJvcGVydGllcykgcmV0dXJuO1xuICBwcm9wZXJ0aWVzLmZvckVhY2gocHJvcGVydHkgPT4ge1xuICAgIGlmIChpc0Fic3RyYWN0VHlwZShnZXROYW1lZFR5cGUocHJvcGVydHkudHlwZSB8fCBwcm9wZXJ0eS5maWVsZFR5cGUhKSkpIHtcbiAgICAgIGNvbnN0IHByb3BlcnR5U2V0cyA9IGdldFBvc3NpYmxlVHlwZU5hbWVzKGdlbmVyYXRvciwgcHJvcGVydHkpXG4gICAgICAgIC5tYXAodHlwZSA9PiB7XG4gICAgICAgICAgY29uc3QgaW5saW5lRnJhZ21lbnQgPSBwcm9wZXJ0eS5pbmxpbmVGcmFnbWVudHMgJiYgcHJvcGVydHkuaW5saW5lRnJhZ21lbnRzLmZpbmQoaW5saW5lRnJhZ21lbnQgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGlubGluZUZyYWdtZW50LnR5cGVDb25kaXRpb24udG9TdHJpbmcoKSA9PSB0eXBlXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpZiAoaW5saW5lRnJhZ21lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IGlubGluZUZyYWdtZW50LmZpZWxkcy5tYXAoZmllbGQgPT4ge1xuICAgICAgICAgICAgICBpZiAoZmllbGQuZmllbGROYW1lID09PSAnX190eXBlbmFtZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgLi4uZmllbGQsXG4gICAgICAgICAgICAgICAgICB0eXBlTmFtZTogYFwiJHtpbmxpbmVGcmFnbWVudC50eXBlQ29uZGl0aW9ufVwiYCxcbiAgICAgICAgICAgICAgICAgIHR5cGU6IHsgbmFtZTogYFwiJHtpbmxpbmVGcmFnbWVudC50eXBlQ29uZGl0aW9ufVwiYCB9IGFzIEdyYXBoUUxUeXBlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhnZW5lcmF0b3IuY29udGV4dCwgZmllbGRzKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgZmllbGRzID0gcHJvcGVydHkuZmllbGRzIS5tYXAoZmllbGQgPT4ge1xuICAgICAgICAgICAgICBpZiAoZmllbGQuZmllbGROYW1lID09PSAnX190eXBlbmFtZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgLi4uZmllbGQsXG4gICAgICAgICAgICAgICAgICB0eXBlTmFtZTogYFwiJHt0eXBlfVwiYCxcbiAgICAgICAgICAgICAgICAgIHR5cGU6IHsgbmFtZTogYFwiJHt0eXBlfVwiYCB9IGFzIEdyYXBoUUxUeXBlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhnZW5lcmF0b3IuY29udGV4dCwgZmllbGRzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICBwcm9wZXJ0eVNldHNEZWNsYXJhdGlvbihnZW5lcmF0b3IsIHByb3BlcnR5LCBwcm9wZXJ0eVNldHMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAocHJvcGVydHkuZmllbGRzICYmIHByb3BlcnR5LmZpZWxkcy5sZW5ndGggPiAwXG4gICAgICAgIHx8IHByb3BlcnR5LmlubGluZUZyYWdtZW50cyAmJiBwcm9wZXJ0eS5pbmxpbmVGcmFnbWVudHMubGVuZ3RoID4gMFxuICAgICAgICB8fCBwcm9wZXJ0eS5mcmFnbWVudFNwcmVhZHMgJiYgcHJvcGVydHkuZnJhZ21lbnRTcHJlYWRzLmxlbmd0aCA+IDBcbiAgICAgICkge1xuICAgICAgICBwcm9wZXJ0eURlY2xhcmF0aW9uKGdlbmVyYXRvciwgcHJvcGVydHksICgpID0+IHtcbiAgICAgICAgICBjb25zdCBwcm9wZXJ0aWVzID0gcHJvcGVydGllc0Zyb21GaWVsZHMoZ2VuZXJhdG9yLmNvbnRleHQsIHByb3BlcnR5LmZpZWxkcyEpO1xuICAgICAgICAgIHByb3BlcnR5RGVjbGFyYXRpb25zKGdlbmVyYXRvciwgcHJvcGVydGllcywgaXNJbnB1dCk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcHJvcGVydHlEZWNsYXJhdGlvbihnZW5lcmF0b3IsIHsgLi4ucHJvcGVydHksIGlzSW5wdXQgfSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBUaGlzIGV4aXN0cyBvbmx5IHRvIHByb3Blcmx5IGdlbmVyYXRlIHR5cGVzIGZvciB1bmlvbi9pbnRlcmZhY2UgdHlwZWQgZmllbGRzIHRoYXRcbiAqIGRvIG5vdCBoYXZlIGlubGluZSBmcmFnbWVudHMuIFRoaXMgY3VycmVudGx5IGNhbiBoYXBwZW4gYW5kIHRoZSBJUiBkb2VzIGdpdmUgdXNcbiAqIGEgc2V0IG9mIGZpZWxkcyBwZXIgdHlwZSBjb25kaXRpb24gdW5sZXNzIGZyYWdtZW50cyBhcmUgdXNlZCB3aXRoaW4gdGhlIHNlbGVjdGlvbiBzZXQuXG4gKi9cbmZ1bmN0aW9uIGdldFBvc3NpYmxlVHlwZU5hbWVzKGdlbmVyYXRvcjogQ29kZUdlbmVyYXRvcjxMZWdhY3lDb21waWxlckNvbnRleHQ+LCBwcm9wZXJ0eTogUHJvcGVydHkpIHtcbiAgY29uc3QgdHlwZSA9IGdldE5hbWVkVHlwZShwcm9wZXJ0eS5maWVsZFR5cGUgfHwgcHJvcGVydHkudHlwZSEpO1xuXG4gIGlmICh0eXBlIGluc3RhbmNlb2YgR3JhcGhRTFVuaW9uVHlwZSB8fCB0eXBlIGluc3RhbmNlb2YgR3JhcGhRTEludGVyZmFjZVR5cGUpIHtcbiAgICByZXR1cm4gZ2VuZXJhdG9yLmNvbnRleHQuc2NoZW1hLmdldFBvc3NpYmxlVHlwZXModHlwZSkubWFwKHR5cGUgPT4gdHlwZS5uYW1lKTtcbiAgfVxuXG4gIHJldHVybiBbXTtcbn1cbiJdfQ==");"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const graphql_1 = require("graphql");
const printing_1 = require("../utilities/printing");
const CodeGenerator_1 = require("../utilities/CodeGenerator");
const language_1 = require("./language");
const types_1 = require("./types");
function generateSource(context) {
    const generator = new CodeGenerator_1.default(context);
    generator.printOnNewline('/* tslint:disable */');
    generator.printOnNewline('//  This file was automatically generated and should not be edited.');
    context.typesUsed.forEach(type => typeDeclarationForGraphQLType(generator, type));
    Object.values(context.operations).forEach(operation => {
        interfaceVariablesDeclarationForOperation(generator, operation);
        interfaceDeclarationForOperation(generator, operation);
    });
    Object.values(context.fragments).forEach(operation => interfaceDeclarationForFragment(generator, operation));
    generator.printNewline();
    return generator.output;
}
exports.generateSource = generateSource;
function typeDeclarationForGraphQLType(generator, type) {
    if (type instanceof graphql_1.GraphQLEnumType) {
        enumerationDeclaration(generator, type);
    } else
    if (type instanceof graphql_1.GraphQLInputObjectType) {
        structDeclarationForInputObjectType(generator, type);
    }
}
exports.typeDeclarationForGraphQLType = typeDeclarationForGraphQLType;
function enumerationDeclaration(generator, type) {
    const { name, description } = type;
    const values = type.getValues();
    generator.printNewlineIfNeeded();
    if (description) {
        description.split('\n').
        forEach(line => {
            generator.printOnNewline(`// ${line.trim()}`);
        });
    }
    generator.printOnNewline(`export enum ${name} {`);
    values.forEach(value => {
        if (!value.description || value.description.indexOf('\n') === -1) {
            generator.printOnNewline(`  ${value.value} = "${value.value}",${printing_1.wrap(' // ', value.description || '')}`);
        } else
        {
            if (value.description) {
                value.description.split('\n').
                forEach(line => {
                    generator.printOnNewline(`  // ${line.trim()}`);
                });
            }
            generator.printOnNewline(`  ${value.value} = "${value.value}",`);
        }
    });
    generator.printOnNewline(`}`);
    generator.printNewline();
}
function structDeclarationForInputObjectType(generator, type) {
    const interfaceName = type.name;
    language_1.interfaceDeclaration(generator, {
        interfaceName },
    () => {
        const properties = propertiesFromFields(generator.context, Object.values(type.getFields()));
        propertyDeclarations(generator, properties, true);
    });
}
function interfaceNameFromOperation({ operationName, operationType }) {
    switch (operationType) {
        case 'query':
            return `${operationName}Query`;
            break;
        case 'mutation':
            return `${operationName}Mutation`;
            break;
        case 'subscription':
            return `${operationName}Subscription`;
            break;
        default:
            throw new graphql_1.GraphQLError(`Unsupported operation type "${operationType}"`);}

}
exports.interfaceNameFromOperation = interfaceNameFromOperation;
function interfaceVariablesDeclarationForOperation(generator, { operationName, operationType, variables }) {
    if (!variables || variables.length < 1) {
        return;
    }
    const interfaceName = `${interfaceNameFromOperation({ operationName, operationType })}Variables`;
    language_1.interfaceDeclaration(generator, {
        interfaceName },
    () => {
        const properties = propertiesFromFields(generator.context, variables);
        propertyDeclarations(generator, properties, true);
    });
}
exports.interfaceVariablesDeclarationForOperation = interfaceVariablesDeclarationForOperation;
function getObjectTypeName(type) {
    if (graphql_1.isListType(type)) {
        return getObjectTypeName(type.ofType);
    }
    if (graphql_1.isNonNullType(type)) {
        return getObjectTypeName(type.ofType);
    }
    if (type instanceof graphql_1.GraphQLObjectType) {
        return `"${type.name}"`;
    }
    if (type instanceof graphql_1.GraphQLUnionType) {
        return type.getTypes().map(type => getObjectTypeName(type)).join(" | ");
    }
    return `"${type.name}"`;
}
function updateTypeNameField(rootField) {
    const fields = rootField.fields && rootField.fields.map(field => {
        if (field.fieldName === '__typename') {
            const objectTypeName = getObjectTypeName(rootField.type);
            return Object.assign({}, field, { typeName: objectTypeName, type: { name: objectTypeName } });
        }
        if (field.fields) {
            return updateTypeNameField(field);
        }
        return field;
    });
    return Object.assign({}, rootField, { fields });
}
exports.updateTypeNameField = updateTypeNameField;
function interfaceDeclarationForOperation(generator, { operationName, operationType, fields }) {
    const interfaceName = interfaceNameFromOperation({ operationName, operationType });
    fields = fields.map(field => updateTypeNameField(field));
    const properties = propertiesFromFields(generator.context, fields);
    language_1.interfaceDeclaration(generator, {
        interfaceName },
    () => {
        propertyDeclarations(generator, properties);
    });
}
exports.interfaceDeclarationForOperation = interfaceDeclarationForOperation;
function interfaceDeclarationForFragment(generator, fragment) {
    const { fragmentName, typeCondition, fields, inlineFragments } = fragment;
    const interfaceName = `${fragmentName}Fragment`;
    language_1.interfaceDeclaration(generator, {
        interfaceName,
        noBrackets: graphql_1.isAbstractType(typeCondition) },
    () => {
        if (graphql_1.isAbstractType(typeCondition)) {
            const propertySets = fragment.possibleTypes.
            map(type => {
                const inlineFragment = inlineFragments.find(inlineFragment => {
                    return inlineFragment.typeCondition.toString() == type.toString();
                });
                if (inlineFragment) {
                    const fields = inlineFragment.fields.map(field => {
                        if (field.fieldName === '__typename') {
                            return Object.assign({}, field, { typeName: `"${inlineFragment.typeCondition}"`, type: { name: `"${inlineFragment.typeCondition}"` } });
                        } else
                        {
                            return field;
                        }
                    });
                    return propertiesFromFields(generator.context, fields);
                } else
                {
                    const fragmentFields = fields.map(field => {
                        if (field.fieldName === '__typename') {
                            return Object.assign({}, field, { typeName: `"${type}"`, type: { name: `"${type}"` } });
                        } else
                        {
                            return field;
                        }
                    });
                    return propertiesFromFields(generator.context, fragmentFields);
                }
            });
            language_1.propertySetsDeclaration(generator, fragment, propertySets, true);
        } else
        {
            const fragmentFields = fields.map(field => {
                if (field.fieldName === '__typename') {
                    return Object.assign({}, field, { typeName: `"${fragment.typeCondition}"`, type: { name: `"${fragment.typeCondition}"` } });
                } else
                {
                    return field;
                }
            });
            const properties = propertiesFromFields(generator.context, fragmentFields);
            propertyDeclarations(generator, properties);
        }
    });
}
exports.interfaceDeclarationForFragment = interfaceDeclarationForFragment;
function propertiesFromFields(context, fields) {
    return fields.map(field => propertyFromField(context, field));
}
exports.propertiesFromFields = propertiesFromFields;
function propertyFromField(context, field) {
    let { name: fieldName, type: fieldType, description, fragmentSpreads, inlineFragments } = field;
    fieldName = fieldName || field.responseName;
    const propertyName = fieldName;
    let property = { fieldName, fieldType, propertyName, description };
    const namedType = graphql_1.getNamedType(fieldType);
    let isNullable = true;
    if (fieldType instanceof graphql_1.GraphQLNonNull) {
        isNullable = false;
    }
    if (graphql_1.isCompositeType(namedType)) {
        const typeName = types_1.typeNameFromGraphQLType(context, fieldType);
        let isArray = false;
        let isArrayElementNullable = null;
        if (graphql_1.isListType(fieldType)) {
            isArray = true;
            isArrayElementNullable = !(fieldType.ofType instanceof graphql_1.GraphQLNonNull);
        } else
        if (graphql_1.isNonNullType(fieldType) && graphql_1.isListType(fieldType.ofType)) {
            isArray = true;
            isArrayElementNullable = !(fieldType.ofType.ofType instanceof graphql_1.GraphQLNonNull);
        }
        return Object.assign({}, property, { typeName, fields: field.fields, isComposite: true, fragmentSpreads, inlineFragments, fieldType,
            isArray, isNullable, isArrayElementNullable });
    } else
    {
        if (field.fieldName === '__typename') {
            const typeName = types_1.typeNameFromGraphQLType(context, fieldType, null, false);
            return Object.assign({}, property, { typeName, isComposite: false, fieldType, isNullable: false });
        } else
        {
            const typeName = types_1.typeNameFromGraphQLType(context, fieldType, null, isNullable);
            return Object.assign({}, property, { typeName, isComposite: false, fieldType, isNullable });
        }
    }
}
exports.propertyFromField = propertyFromField;
function propertyDeclarations(generator, properties, isInput = false) {
    if (!properties)
    return;
    properties.forEach(property => {
        if (graphql_1.isAbstractType(graphql_1.getNamedType(property.type || property.fieldType))) {
            const propertySets = getPossibleTypeNames(generator, property).
            map(type => {
                const inlineFragment = property.inlineFragments && property.inlineFragments.find(inlineFragment => {
                    return inlineFragment.typeCondition.toString() == type;
                });
                if (inlineFragment) {
                    const fields = inlineFragment.fields.map(field => {
                        if (field.fieldName === '__typename') {
                            return Object.assign({}, field, { typeName: `"${inlineFragment.typeCondition}"`, type: { name: `"${inlineFragment.typeCondition}"` } });
                        } else
                        {
                            return field;
                        }
                    });
                    return propertiesFromFields(generator.context, fields);
                } else
                {
                    const fields = property.fields.map(field => {
                        if (field.fieldName === '__typename') {
                            return Object.assign({}, field, { typeName: `"${type}"`, type: { name: `"${type}"` } });
                        } else
                        {
                            return field;
                        }
                    });
                    return propertiesFromFields(generator.context, fields);
                }
            });
            language_1.propertySetsDeclaration(generator, property, propertySets);
        } else
        {
            if (property.fields && property.fields.length > 0 ||
            property.inlineFragments && property.inlineFragments.length > 0 ||
            property.fragmentSpreads && property.fragmentSpreads.length > 0) {
                language_1.propertyDeclaration(generator, property, () => {
                    const properties = propertiesFromFields(generator.context, property.fields);
                    propertyDeclarations(generator, properties, isInput);
                });
            } else
            {
                language_1.propertyDeclaration(generator, Object.assign({}, property, { isInput }));
            }
        }
    });
}
exports.propertyDeclarations = propertyDeclarations;
function getPossibleTypeNames(generator, property) {
    const type = graphql_1.getNamedType(property.fieldType || property.type);
    if (type instanceof graphql_1.GraphQLUnionType || type instanceof graphql_1.GraphQLInterfaceType) {
        return generator.context.schema.getPossibleTypes(type).map(type => type.name);
    }
    return [];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QXNCLFNBQVMsSUFBNUMsQ0FBYjtBQUVBLFFBQUksZ0JBQWdCLFVBQUEsZ0JBQWhCLElBQW9DLGdCQUFnQixVQUFBLG9CQUF4RCxFQUE4RTtBQUM1RSxlQUFPLFVBQVUsT0FBVixDQUFrQixNQUFsQixDQUF5QixnQkFBekIsQ0FBMEMsSUFBMUMsRUFBZ0QsR0FBaEQsQ0FBb0QsUUFBUSxLQUFLLElBQWpFLENBQVA7QUFDRDtBQUVELFdBQU8sRUFBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTGVnYWN5Q29tcGlsZXJDb250ZXh0LCBMZWdhY3lJbmxpbmVGcmFnbWVudCwgTGVnYWN5RnJhZ21lbnQsIExlZ2FjeUZpZWxkLCBMZWdhY3lPcGVyYXRpb24gfSBmcm9tICcuLi9jb21waWxlci9sZWdhY3lJUic7XG5pbXBvcnQge1xuICBHcmFwaFFMRXJyb3IsXG4gIGdldE5hbWVkVHlwZSxcbiAgaXNDb21wb3NpdGVUeXBlLFxuICBpc0Fic3RyYWN0VHlwZSxcbiAgR3JhcGhRTEVudW1UeXBlLFxuICBHcmFwaFFMTm9uTnVsbCxcbiAgR3JhcGhRTElucHV0T2JqZWN0VHlwZSxcbiAgR3JhcGhRTFR5cGUsXG4gIEdyYXBoUUxVbmlvblR5cGUsXG4gIEdyYXBoUUxJbnRlcmZhY2VUeXBlLFxuICBHcmFwaFFMT2JqZWN0VHlwZSxcbiAgaXNMaXN0VHlwZSxcbiAgaXNOb25OdWxsVHlwZVxufSBmcm9tICdncmFwaHFsJ1xuXG5pbXBvcnQge1xuICB3cmFwXG59IGZyb20gJy4uL3V0aWxpdGllcy9wcmludGluZyc7XG5cbmltcG9ydCBDb2RlR2VuZXJhdG9yIGZyb20gJy4uL3V0aWxpdGllcy9Db2RlR2VuZXJhdG9yJztcblxuaW1wb3J0IHtcbiAgaW50ZXJmYWNlRGVjbGFyYXRpb24sXG4gIHByb3BlcnR5RGVjbGFyYXRpb24sXG4gIHByb3BlcnR5U2V0c0RlY2xhcmF0aW9uLFxuICBQcm9wZXJ0eVxufSBmcm9tICcuL2xhbmd1YWdlJztcblxuaW1wb3J0IHtcbiAgdHlwZU5hbWVGcm9tR3JhcGhRTFR5cGUsXG59IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IE1heWJlIGZyb20gJ2dyYXBocWwvdHN1dGlscy9NYXliZSc7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVNvdXJjZShjb250ZXh0OiBMZWdhY3lDb21waWxlckNvbnRleHQpIHtcbiAgY29uc3QgZ2VuZXJhdG9yID0gbmV3IENvZGVHZW5lcmF0b3I8TGVnYWN5Q29tcGlsZXJDb250ZXh0Pihjb250ZXh0KTtcblxuICBnZW5lcmF0b3IucHJpbnRPbk5ld2xpbmUoJy8qIHRzbGludDpkaXNhYmxlICovJyk7XG4gIGdlbmVyYXRvci5wcmludE9uTmV3bGluZSgnLy8gIFRoaXMgZmlsZSB3YXMgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgYW5kIHNob3VsZCBub3QgYmUgZWRpdGVkLicpO1xuXG4gIGNvbnRleHQudHlwZXNVc2VkLmZvckVhY2godHlwZSA9PlxuICAgIHR5cGVEZWNsYXJhdGlvbkZvckdyYXBoUUxUeXBlKGdlbmVyYXRvciwgdHlwZSlcbiAgKTtcbiAgT2JqZWN0LnZhbHVlcyhjb250ZXh0Lm9wZXJhdGlvbnMpLmZvckVhY2gob3BlcmF0aW9uID0+IHtcbiAgICBpbnRlcmZhY2VWYXJpYWJsZXNEZWNsYXJhdGlvbkZvck9wZXJhdGlvbihnZW5lcmF0b3IsIG9wZXJhdGlvbik7XG4gICAgaW50ZXJmYWNlRGVjbGFyYXRpb25Gb3JPcGVyYXRpb24oZ2VuZXJhdG9yLCBvcGVyYXRpb24pO1xuICB9KTtcbiAgT2JqZWN0LnZhbHVlcyhjb250ZXh0LmZyYWdtZW50cykuZm9yRWFjaChvcGVyYXRpb24gPT5cbiAgICBpbnRlcmZhY2VEZWNsYXJhdGlvbkZvckZyYWdtZW50KGdlbmVyYXRvciwgb3BlcmF0aW9uKVxuICApO1xuXG4gIGdlbmVyYXRvci5wcmludE5ld2xpbmUoKTtcblxuICByZXR1cm4gZ2VuZXJhdG9yLm91dHB1dDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHR5cGVEZWNsYXJhdGlvbkZvckdyYXBoUUxUeXBlKGdlbmVyYXRvcjogQ29kZUdlbmVyYXRvciwgdHlwZTogR3JhcGhRTFR5cGUpIHtcbiAgaWYgKHR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMRW51bVR5cGUpIHtcbiAgICBlbnVtZXJhdGlvbkRlY2xhcmF0aW9uKGdlbmVyYXRvciwgdHlwZSk7XG4gIH0gZWxzZSBpZiAodHlwZSBpbnN0YW5jZW9mIEdyYXBoUUxJbnB1dE9iamVjdFR5cGUpIHtcbiAgICBzdHJ1Y3REZWNsYXJhdGlvbkZvcklucHV0T2JqZWN0VHlwZShnZW5lcmF0b3IsIHR5cGUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGVudW1lcmF0aW9uRGVjbGFyYXRpb24oZ2VuZXJhdG9yOiBDb2RlR2VuZXJhdG9yLCB0eXBlOiBHcmFwaFFMRW51bVR5cGUpIHtcbiAgY29uc3QgeyBuYW1lLCBkZXNjcmlwdGlvbiB9ID0gdHlwZTtcbiAgY29uc3QgdmFsdWVzID0gdHlwZS5nZXRWYWx1ZXMoKTtcblxuICBnZW5lcmF0b3IucHJpbnROZXdsaW5lSWZOZWVkZWQoKTtcbiAgaWYgKGRlc2NyaXB0aW9uKSB7XG4gICAgZGVzY3JpcHRpb24uc3BsaXQoJ1xcbicpXG4gICAgICAuZm9yRWFjaChsaW5lID0+IHtcbiAgICAgICAgZ2VuZXJhdG9yLnByaW50T25OZXdsaW5lKGAvLyAke2xpbmUudHJpbSgpfWApO1xuICAgICAgfSlcbiAgfVxuICBnZW5lcmF0b3IucHJpbnRPbk5ld2xpbmUoYGV4cG9ydCBlbnVtICR7bmFtZX0ge2ApO1xuICB2YWx1ZXMuZm9yRWFjaCgodmFsdWUpID0+IHtcbiAgICBpZiAoIXZhbHVlLmRlc2NyaXB0aW9uIHx8IHZhbHVlLmRlc2NyaXB0aW9uLmluZGV4T2YoJ1xcbicpID09PSAtMSkge1xuICAgICAgZ2VuZXJhdG9yLnByaW50T25OZXdsaW5lKGAgICR7dmFsdWUudmFsdWV9ID0gXCIke3ZhbHVlLnZhbHVlfVwiLCR7d3JhcCgnIC8vICcsIHZhbHVlLmRlc2NyaXB0aW9uIHx8ICcnKX1gKVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodmFsdWUuZGVzY3JpcHRpb24pIHtcbiAgICAgICAgdmFsdWUuZGVzY3JpcHRpb24uc3BsaXQoJ1xcbicpXG4gICAgICAgICAgLmZvckVhY2gobGluZSA9PiB7XG4gICAgICAgICAgICBnZW5lcmF0b3IucHJpbnRPbk5ld2xpbmUoYCAgLy8gJHtsaW5lLnRyaW0oKX1gKTtcbiAgICAgICAgICB9KVxuICAgICAgfVxuICAgICAgZ2VuZXJhdG9yLnByaW50T25OZXdsaW5lKGAgICR7dmFsdWUudmFsdWV9ID0gXCIke3ZhbHVlLnZhbHVlfVwiLGApXG4gICAgfVxuICB9KTtcbiAgZ2VuZXJhdG9yLnByaW50T25OZXdsaW5lKGB9YCk7XG4gIGdlbmVyYXRvci5wcmludE5ld2xpbmUoKTtcbn1cblxuZnVuY3Rpb24gc3RydWN0RGVjbGFyYXRpb25Gb3JJbnB1dE9iamVjdFR5cGUoXG4gIGdlbmVyYXRvcjogQ29kZUdlbmVyYXRvcixcbiAgdHlwZTogR3JhcGhRTElucHV0T2JqZWN0VHlwZVxuKSB7XG4gIGNvbnN0IGludGVyZmFjZU5hbWUgPSB0eXBlLm5hbWU7XG4gIGludGVyZmFjZURlY2xhcmF0aW9uKGdlbmVyYXRvciwge1xuICAgIGludGVyZmFjZU5hbWUsXG4gIH0sICgpID0+IHtcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gcHJvcGVydGllc0Zyb21GaWVsZHMoZ2VuZXJhdG9yLmNvbnRleHQsIE9iamVjdC52YWx1ZXModHlwZS5nZXRGaWVsZHMoKSkpO1xuICAgIHByb3BlcnR5RGVjbGFyYXRpb25zKGdlbmVyYXRvciwgcHJvcGVydGllcywgdHJ1ZSk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW50ZXJmYWNlTmFtZUZyb21PcGVyYXRpb24oeyBvcGVyYXRpb25OYW1lLCBvcGVyYXRpb25UeXBlIH06IHsgb3BlcmF0aW9uTmFtZTogc3RyaW5nLCBvcGVyYXRpb25UeXBlOiBzdHJpbmcgfSkge1xuICBzd2l0Y2ggKG9wZXJhdGlvblR5cGUpIHtcbiAgICBjYXNlICdxdWVyeSc6XG4gICAgICByZXR1cm4gYCR7b3BlcmF0aW9uTmFtZX1RdWVyeWA7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdtdXRhdGlvbic6XG4gICAgICByZXR1cm4gYCR7b3BlcmF0aW9uTmFtZX1NdXRhdGlvbmA7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdzdWJzY3JpcHRpb24nOlxuICAgICAgcmV0dXJuIGAke29wZXJhdGlvbk5hbWV9U3Vic2NyaXB0aW9uYDtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBuZXcgR3JhcGhRTEVycm9yKGBVbnN1cHBvcnRlZCBvcGVyYXRpb24gdHlwZSBcIiR7b3BlcmF0aW9uVHlwZX1cImApO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbnRlcmZhY2VWYXJpYWJsZXNEZWNsYXJhdGlvbkZvck9wZXJhdGlvbihcbiAgZ2VuZXJhdG9yOiBDb2RlR2VuZXJhdG9yLFxuICB7XG4gICAgb3BlcmF0aW9uTmFtZSxcbiAgICBvcGVyYXRpb25UeXBlLFxuICAgIHZhcmlhYmxlc1xuICB9OiBMZWdhY3lPcGVyYXRpb25cbikge1xuICBpZiAoIXZhcmlhYmxlcyB8fCB2YXJpYWJsZXMubGVuZ3RoIDwgMSkge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBpbnRlcmZhY2VOYW1lID0gYCR7aW50ZXJmYWNlTmFtZUZyb21PcGVyYXRpb24oeyBvcGVyYXRpb25OYW1lLCBvcGVyYXRpb25UeXBlIH0pfVZhcmlhYmxlc2A7XG5cbiAgaW50ZXJmYWNlRGVjbGFyYXRpb24oZ2VuZXJhdG9yLCB7XG4gICAgaW50ZXJmYWNlTmFtZSxcbiAgfSwgKCkgPT4ge1xuICAgIGNvbnN0IHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhnZW5lcmF0b3IuY29udGV4dCwgdmFyaWFibGVzKTtcbiAgICBwcm9wZXJ0eURlY2xhcmF0aW9ucyhnZW5lcmF0b3IsIHByb3BlcnRpZXMsIHRydWUpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0T2JqZWN0VHlwZU5hbWUodHlwZTogR3JhcGhRTFR5cGUpOiBzdHJpbmcge1xuICBpZiAoaXNMaXN0VHlwZSh0eXBlKSkge1xuICAgIHJldHVybiBnZXRPYmplY3RUeXBlTmFtZSh0eXBlLm9mVHlwZSk7XG4gIH1cbiAgaWYgKGlzTm9uTnVsbFR5cGUodHlwZSkpIHtcbiAgICByZXR1cm4gZ2V0T2JqZWN0VHlwZU5hbWUodHlwZS5vZlR5cGUpO1xuICB9XG4gIGlmICh0eXBlIGluc3RhbmNlb2YgR3JhcGhRTE9iamVjdFR5cGUpIHtcbiAgICByZXR1cm4gYFwiJHt0eXBlLm5hbWV9XCJgO1xuICB9XG4gIGlmICh0eXBlIGluc3RhbmNlb2YgR3JhcGhRTFVuaW9uVHlwZSkge1xuICAgIHJldHVybiB0eXBlLmdldFR5cGVzKCkubWFwKHR5cGUgPT4gZ2V0T2JqZWN0VHlwZU5hbWUodHlwZSkpLmpvaW4oXCIgfCBcIik7XG4gIH1cbiAgcmV0dXJuIGBcIiR7dHlwZS5uYW1lfVwiYDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVR5cGVOYW1lRmllbGQocm9vdEZpZWxkOiBMZWdhY3lGaWVsZCk6IExlZ2FjeUZpZWxkIHtcbiAgY29uc3QgZmllbGRzID0gcm9vdEZpZWxkLmZpZWxkcyAmJiByb290RmllbGQuZmllbGRzLm1hcChmaWVsZCA9PiB7XG4gICAgaWYgKGZpZWxkLmZpZWxkTmFtZSA9PT0gJ19fdHlwZW5hbWUnKSB7XG4gICAgICBjb25zdCBvYmplY3RUeXBlTmFtZSA9IGdldE9iamVjdFR5cGVOYW1lKHJvb3RGaWVsZC50eXBlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmZpZWxkLFxuICAgICAgICB0eXBlTmFtZTogb2JqZWN0VHlwZU5hbWUsXG4gICAgICAgIHR5cGU6IHsgbmFtZTogb2JqZWN0VHlwZU5hbWUgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKGZpZWxkLmZpZWxkcykge1xuICAgICAgcmV0dXJuIHVwZGF0ZVR5cGVOYW1lRmllbGQoZmllbGQpO1xuICAgIH1cblxuICAgIHJldHVybiBmaWVsZDtcbiAgfSk7XG4gIHJldHVybiB7XG4gICAgLi4ucm9vdEZpZWxkLFxuICAgIGZpZWxkcyxcbiAgfSBhcyBMZWdhY3lGaWVsZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGludGVyZmFjZURlY2xhcmF0aW9uRm9yT3BlcmF0aW9uKFxuICBnZW5lcmF0b3I6IENvZGVHZW5lcmF0b3IsXG4gIHtcbiAgICBvcGVyYXRpb25OYW1lLFxuICAgIG9wZXJhdGlvblR5cGUsXG4gICAgZmllbGRzXG4gIH06IExlZ2FjeU9wZXJhdGlvblxuKSB7XG4gIGNvbnN0IGludGVyZmFjZU5hbWUgPSBpbnRlcmZhY2VOYW1lRnJvbU9wZXJhdGlvbih7IG9wZXJhdGlvbk5hbWUsIG9wZXJhdGlvblR5cGUgfSk7XG4gIGZpZWxkcyA9IGZpZWxkcy5tYXAoZmllbGQgPT4gdXBkYXRlVHlwZU5hbWVGaWVsZChmaWVsZCkpO1xuICBjb25zdCBwcm9wZXJ0aWVzID0gcHJvcGVydGllc0Zyb21GaWVsZHMoZ2VuZXJhdG9yLmNvbnRleHQsIGZpZWxkcyk7XG4gIGludGVyZmFjZURlY2xhcmF0aW9uKGdlbmVyYXRvciwge1xuICAgIGludGVyZmFjZU5hbWUsXG4gIH0sICgpID0+IHtcbiAgICBwcm9wZXJ0eURlY2xhcmF0aW9ucyhnZW5lcmF0b3IsIHByb3BlcnRpZXMpO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGludGVyZmFjZURlY2xhcmF0aW9uRm9yRnJhZ21lbnQoXG4gIGdlbmVyYXRvcjogQ29kZUdlbmVyYXRvcixcbiAgZnJhZ21lbnQ6IExlZ2FjeUZyYWdtZW50XG4pIHtcbiAgY29uc3Qge1xuICAgIGZyYWdtZW50TmFtZSxcbiAgICB0eXBlQ29uZGl0aW9uLFxuICAgIGZpZWxkcyxcbiAgICBpbmxpbmVGcmFnbWVudHNcbiAgfSA9IGZyYWdtZW50O1xuXG4gIGNvbnN0IGludGVyZmFjZU5hbWUgPSBgJHtmcmFnbWVudE5hbWV9RnJhZ21lbnRgO1xuXG4gIGludGVyZmFjZURlY2xhcmF0aW9uKGdlbmVyYXRvciwge1xuICAgIGludGVyZmFjZU5hbWUsXG4gICAgbm9CcmFja2V0czogaXNBYnN0cmFjdFR5cGUodHlwZUNvbmRpdGlvbilcbiAgfSwgKCkgPT4ge1xuICAgIGlmIChpc0Fic3RyYWN0VHlwZSh0eXBlQ29uZGl0aW9uKSkge1xuICAgICAgY29uc3QgcHJvcGVydHlTZXRzID0gZnJhZ21lbnQucG9zc2libGVUeXBlc1xuICAgICAgICAubWFwKHR5cGUgPT4ge1xuICAgICAgICAgIC8vIE5PVEU6IGlubGluZUZyYWdtZW50IGN1cnJlbnRseSBjb25zaXN0cyBvZiB0aGUgbWVyZ2VkIGZpZWxkc1xuICAgICAgICAgIC8vIGZyb20gYm90aCBpbmxpbmUgZnJhZ21lbnRzIGFuZCBmcmFnbWVudCBzcHJlYWRzLlxuICAgICAgICAgIC8vIFRPRE86IFJlbmFtZSBpbmxpbmVGcmFnbWVudHMgaW4gdGhlIElSLlxuICAgICAgICAgIGNvbnN0IGlubGluZUZyYWdtZW50ID0gaW5saW5lRnJhZ21lbnRzLmZpbmQoaW5saW5lRnJhZ21lbnQgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGlubGluZUZyYWdtZW50LnR5cGVDb25kaXRpb24udG9TdHJpbmcoKSA9PSB0eXBlLnRvU3RyaW5nKClcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGlmIChpbmxpbmVGcmFnbWVudCkge1xuICAgICAgICAgICAgY29uc3QgZmllbGRzID0gaW5saW5lRnJhZ21lbnQuZmllbGRzLm1hcChmaWVsZCA9PiB7XG4gICAgICAgICAgICAgIGlmIChmaWVsZC5maWVsZE5hbWUgPT09ICdfX3R5cGVuYW1lJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAuLi5maWVsZCxcbiAgICAgICAgICAgICAgICAgIHR5cGVOYW1lOiBgXCIke2lubGluZUZyYWdtZW50LnR5cGVDb25kaXRpb259XCJgLFxuICAgICAgICAgICAgICAgICAgdHlwZTogeyBuYW1lOiBgXCIke2lubGluZUZyYWdtZW50LnR5cGVDb25kaXRpb259XCJgIH0gYXMgR3JhcGhRTFR5cGVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHByb3BlcnRpZXNGcm9tRmllbGRzKGdlbmVyYXRvci5jb250ZXh0LCBmaWVsZHMpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBmcmFnbWVudEZpZWxkcyA9IGZpZWxkcy5tYXAoZmllbGQgPT4ge1xuICAgICAgICAgICAgICBpZiAoZmllbGQuZmllbGROYW1lID09PSAnX190eXBlbmFtZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgLi4uZmllbGQsXG4gICAgICAgICAgICAgICAgICB0eXBlTmFtZTogYFwiJHt0eXBlfVwiYCxcbiAgICAgICAgICAgICAgICAgIHR5cGU6IHsgbmFtZTogYFwiJHt0eXBlfVwiYCB9IGFzIEdyYXBoUUxUeXBlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhnZW5lcmF0b3IuY29udGV4dCwgZnJhZ21lbnRGaWVsZHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgIHByb3BlcnR5U2V0c0RlY2xhcmF0aW9uKGdlbmVyYXRvciwgZnJhZ21lbnQsIHByb3BlcnR5U2V0cywgdHJ1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGZyYWdtZW50RmllbGRzID0gZmllbGRzLm1hcChmaWVsZCA9PiB7XG4gICAgICAgIGlmIChmaWVsZC5maWVsZE5hbWUgPT09ICdfX3R5cGVuYW1lJykge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5maWVsZCxcbiAgICAgICAgICAgIHR5cGVOYW1lOiBgXCIke2ZyYWdtZW50LnR5cGVDb25kaXRpb259XCJgLFxuICAgICAgICAgICAgdHlwZTogeyBuYW1lOiBgXCIke2ZyYWdtZW50LnR5cGVDb25kaXRpb259XCJgIH0gYXMgR3JhcGhRTFR5cGVcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGZpZWxkO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcHJvcGVydGllcyA9IHByb3BlcnRpZXNGcm9tRmllbGRzKGdlbmVyYXRvci5jb250ZXh0LCBmcmFnbWVudEZpZWxkcylcbiAgICAgIHByb3BlcnR5RGVjbGFyYXRpb25zKGdlbmVyYXRvciwgcHJvcGVydGllcyk7XG4gICAgfVxuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByb3BlcnRpZXNGcm9tRmllbGRzKGNvbnRleHQ6IExlZ2FjeUNvbXBpbGVyQ29udGV4dCwgZmllbGRzOiB7XG4gIG5hbWU/OiBzdHJpbmcsXG4gIHR5cGU6IEdyYXBoUUxUeXBlLFxuICByZXNwb25zZU5hbWU/OiBzdHJpbmcsXG4gIGRlc2NyaXB0aW9uPzogTWF5YmU8c3RyaW5nPixcbiAgZnJhZ21lbnRTcHJlYWRzPzogYW55LFxuICBpbmxpbmVGcmFnbWVudHM/OiBMZWdhY3lJbmxpbmVGcmFnbWVudFtdLFxuICBmaWVsZE5hbWU/OiBzdHJpbmdcbn1bXSkge1xuICByZXR1cm4gZmllbGRzLm1hcChmaWVsZCA9PiBwcm9wZXJ0eUZyb21GaWVsZChjb250ZXh0LCBmaWVsZCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJvcGVydHlGcm9tRmllbGQoY29udGV4dDogTGVnYWN5Q29tcGlsZXJDb250ZXh0LCBmaWVsZDoge1xuICBuYW1lPzogc3RyaW5nLFxuICB0eXBlOiBHcmFwaFFMVHlwZSxcbiAgZmllbGRzPzogYW55W10sXG4gIHJlc3BvbnNlTmFtZT86IHN0cmluZyxcbiAgZGVzY3JpcHRpb24/OiBNYXliZTxzdHJpbmc+LFxuICBmcmFnbWVudFNwcmVhZHM/OiBhbnksXG4gIGlubGluZUZyYWdtZW50cz86IExlZ2FjeUlubGluZUZyYWdtZW50W10sXG4gIGZpZWxkTmFtZT86IHN0cmluZ1xufSk6IFByb3BlcnR5IHtcbiAgbGV0IHsgbmFtZTogZmllbGROYW1lLCB0eXBlOiBmaWVsZFR5cGUsIGRlc2NyaXB0aW9uLCBmcmFnbWVudFNwcmVhZHMsIGlubGluZUZyYWdtZW50cyB9ID0gZmllbGQ7XG4gIGZpZWxkTmFtZSA9IGZpZWxkTmFtZSB8fCBmaWVsZC5yZXNwb25zZU5hbWU7XG5cbiAgY29uc3QgcHJvcGVydHlOYW1lID0gZmllbGROYW1lO1xuXG4gIGxldCBwcm9wZXJ0eSA9IHsgZmllbGROYW1lLCBmaWVsZFR5cGUsIHByb3BlcnR5TmFtZSwgZGVzY3JpcHRpb24gfTtcblxuICBjb25zdCBuYW1lZFR5cGUgPSBnZXROYW1lZFR5cGUoZmllbGRUeXBlKTtcblxuICBsZXQgaXNOdWxsYWJsZSA9IHRydWU7XG4gIGlmIChmaWVsZFR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMTm9uTnVsbCkge1xuICAgIGlzTnVsbGFibGUgPSBmYWxzZTtcbiAgfVxuXG4gIGlmIChpc0NvbXBvc2l0ZVR5cGUobmFtZWRUeXBlKSkge1xuICAgIGNvbnN0IHR5cGVOYW1lID0gdHlwZU5hbWVGcm9tR3JhcGhRTFR5cGUoY29udGV4dCwgZmllbGRUeXBlKTtcbiAgICBsZXQgaXNBcnJheSA9IGZhbHNlO1xuICAgIGxldCBpc0FycmF5RWxlbWVudE51bGxhYmxlID0gbnVsbDtcbiAgICBpZiAoaXNMaXN0VHlwZShmaWVsZFR5cGUpKSB7XG4gICAgICBpc0FycmF5ID0gdHJ1ZTtcbiAgICAgIGlzQXJyYXlFbGVtZW50TnVsbGFibGUgPSAhKGZpZWxkVHlwZS5vZlR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMTm9uTnVsbCk7XG4gICAgfSBlbHNlIGlmIChpc05vbk51bGxUeXBlKGZpZWxkVHlwZSkgICYmIGlzTGlzdFR5cGUoZmllbGRUeXBlLm9mVHlwZSkpIHtcbiAgICAgIGlzQXJyYXkgPSB0cnVlXG4gICAgICBpc0FycmF5RWxlbWVudE51bGxhYmxlID0gIShmaWVsZFR5cGUub2ZUeXBlLm9mVHlwZSBpbnN0YW5jZW9mIEdyYXBoUUxOb25OdWxsKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4ucHJvcGVydHksXG4gICAgICB0eXBlTmFtZSxcbiAgICAgIGZpZWxkczogZmllbGQuZmllbGRzLFxuICAgICAgaXNDb21wb3NpdGU6IHRydWUsXG4gICAgICBmcmFnbWVudFNwcmVhZHMsIGlubGluZUZyYWdtZW50cywgZmllbGRUeXBlLFxuICAgICAgaXNBcnJheSwgaXNOdWxsYWJsZSwgaXNBcnJheUVsZW1lbnROdWxsYWJsZSxcbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIGlmIChmaWVsZC5maWVsZE5hbWUgPT09ICdfX3R5cGVuYW1lJykge1xuICAgICAgY29uc3QgdHlwZU5hbWUgPSB0eXBlTmFtZUZyb21HcmFwaFFMVHlwZShjb250ZXh0LCBmaWVsZFR5cGUsIG51bGwsIGZhbHNlKTtcbiAgICAgIHJldHVybiB7IC4uLnByb3BlcnR5LCB0eXBlTmFtZSwgaXNDb21wb3NpdGU6IGZhbHNlLCBmaWVsZFR5cGUsIGlzTnVsbGFibGU6IGZhbHNlIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHR5cGVOYW1lID0gdHlwZU5hbWVGcm9tR3JhcGhRTFR5cGUoY29udGV4dCwgZmllbGRUeXBlLCBudWxsLCBpc051bGxhYmxlKTtcbiAgICAgIHJldHVybiB7IC4uLnByb3BlcnR5LCB0eXBlTmFtZSwgaXNDb21wb3NpdGU6IGZhbHNlLCBmaWVsZFR5cGUsIGlzTnVsbGFibGUgfTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByb3BlcnR5RGVjbGFyYXRpb25zKGdlbmVyYXRvcjogQ29kZUdlbmVyYXRvciwgcHJvcGVydGllczogUHJvcGVydHlbXSwgaXNJbnB1dCA9IGZhbHNlKSB7XG5cbiAgaWYgKCFwcm9wZXJ0aWVzKSByZXR1cm47XG4gIHByb3BlcnRpZXMuZm9yRWFjaChwcm9wZXJ0eSA9PiB7XG4gICAgaWYgKGlzQWJzdHJhY3RUeXBlKGdldE5hbWVkVHlwZShwcm9wZXJ0eS50eXBlIHx8IHByb3BlcnR5LmZpZWxkVHlwZSEpKSkge1xuICAgICAgY29uc3QgcHJvcGVydHlTZXRzID0gZ2V0UG9zc2libGVUeXBlTmFtZXMoZ2VuZXJhdG9yLCBwcm9wZXJ0eSlcbiAgICAgICAgLm1hcCh0eXBlID0+IHtcbiAgICAgICAgICBjb25zdCBpbmxpbmVGcmFnbWVudCA9IHByb3BlcnR5LmlubGluZUZyYWdtZW50cyAmJiBwcm9wZXJ0eS5pbmxpbmVGcmFnbWVudHMuZmluZChpbmxpbmVGcmFnbWVudCA9PiB7XG4gICAgICAgICAgICByZXR1cm4gaW5saW5lRnJhZ21lbnQudHlwZUNvbmRpdGlvbi50b1N0cmluZygpID09IHR5cGVcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGlmIChpbmxpbmVGcmFnbWVudCkge1xuICAgICAgICAgICAgY29uc3QgZmllbGRzID0gaW5saW5lRnJhZ21lbnQuZmllbGRzLm1hcChmaWVsZCA9PiB7XG4gICAgICAgICAgICAgIGlmIChmaWVsZC5maWVsZE5hbWUgPT09ICdfX3R5cGVuYW1lJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAuLi5maWVsZCxcbiAgICAgICAgICAgICAgICAgIHR5cGVOYW1lOiBgXCIke2lubGluZUZyYWdtZW50LnR5cGVDb25kaXRpb259XCJgLFxuICAgICAgICAgICAgICAgICAgdHlwZTogeyBuYW1lOiBgXCIke2lubGluZUZyYWdtZW50LnR5cGVDb25kaXRpb259XCJgIH0gYXMgR3JhcGhRTFR5cGVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHByb3BlcnRpZXNGcm9tRmllbGRzKGdlbmVyYXRvci5jb250ZXh0LCBmaWVsZHMpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBwcm9wZXJ0eS5maWVsZHMhLm1hcChmaWVsZCA9PiB7XG4gICAgICAgICAgICAgIGlmIChmaWVsZC5maWVsZE5hbWUgPT09ICdfX3R5cGVuYW1lJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAuLi5maWVsZCxcbiAgICAgICAgICAgICAgICAgIHR5cGVOYW1lOiBgXCIke3R5cGV9XCJgLFxuICAgICAgICAgICAgICAgICAgdHlwZTogeyBuYW1lOiBgXCIke3R5cGV9XCJgIH0gYXMgR3JhcGhRTFR5cGVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHByb3BlcnRpZXNGcm9tRmllbGRzKGdlbmVyYXRvci5jb250ZXh0LCBmaWVsZHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgIHByb3BlcnR5U2V0c0RlY2xhcmF0aW9uKGdlbmVyYXRvciwgcHJvcGVydHksIHByb3BlcnR5U2V0cyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChwcm9wZXJ0eS5maWVsZHMgJiYgcHJvcGVydHkuZmllbGRzLmxlbmd0aCA+IDBcbiAgICAgICAgfHwgcHJvcGVydHkuaW5saW5lRnJhZ21lbnRzICYmIHByb3BlcnR5LmlubGluZUZyYWdtZW50cy5sZW5ndGggPiAwXG4gICAgICAgIHx8IHByb3BlcnR5LmZyYWdtZW50U3ByZWFkcyAmJiBwcm9wZXJ0eS5mcmFnbWVudFNwcmVhZHMubGVuZ3RoID4gMFxuICAgICAgKSB7XG4gICAgICAgIHByb3BlcnR5RGVjbGFyYXRpb24oZ2VuZXJhdG9yLCBwcm9wZXJ0eSwgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhnZW5lcmF0b3IuY29udGV4dCwgcHJvcGVydHkuZmllbGRzISk7XG4gICAgICAgICAgcHJvcGVydHlEZWNsYXJhdGlvbnMoZ2VuZXJhdG9yLCBwcm9wZXJ0aWVzLCBpc0lucHV0KTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwcm9wZXJ0eURlY2xhcmF0aW9uKGdlbmVyYXRvciwgeyAuLi5wcm9wZXJ0eSwgaXNJbnB1dCB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIFRoaXMgZXhpc3RzIG9ubHkgdG8gcHJvcGVybHkgZ2VuZXJhdGUgdHlwZXMgZm9yIHVuaW9uL2ludGVyZmFjZSB0eXBlZCBmaWVsZHMgdGhhdFxuICogZG8gbm90IGhhdmUgaW5saW5lIGZyYWdtZW50cy4gVGhpcyBjdXJyZW50bHkgY2FuIGhhcHBlbiBhbmQgdGhlIElSIGRvZXMgZ2l2ZSB1c1xuICogYSBzZXQgb2YgZmllbGRzIHBlciB0eXBlIGNvbmRpdGlvbiB1bmxlc3MgZnJhZ21lbnRzIGFyZSB1c2VkIHdpdGhpbiB0aGUgc2VsZWN0aW9uIHNldC5cbiAqL1xuZnVuY3Rpb24gZ2V0UG9zc2libGVUeXBlTmFtZXMoZ2VuZXJhdG9yOiBDb2RlR2VuZXJhdG9yPExlZ2FjeUNvbXBpbGVyQ29udGV4dD4sIHByb3BlcnR5OiBQcm9wZXJ0eSkge1xuICBjb25zdCB0eXBlID0gZ2V0TmFtZWRUeXBlKHByb3BlcnR5LmZpZWxkVHlwZSB8fCBwcm9wZXJ0eS50eXBlISk7XG5cbiAgaWYgKHR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMVW5pb25UeXBlIHx8IHR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMSW50ZXJmYWNlVHlwZSkge1xuICAgIHJldHVybiBnZW5lcmF0b3IuY29udGV4dC5zY2hlbWEuZ2V0UG9zc2libGVUeXBlcyh0eXBlKS5tYXAodHlwZSA9PiB0eXBlLm5hbWUpO1xuICB9XG5cbiAgcmV0dXJuIFtdO1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==