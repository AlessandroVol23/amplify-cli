cff204ea75b3bef51c72ee83f7b7c1d0
'use strict';require('ts-jest').install("/c/Users/Sandro/repo/amplify-cli/packages/amplify-graphql-types-generator/src/flow/codeGeneration.js", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst graphql_1 = require(\"graphql\");\nconst printing_1 = require(\"../utilities/printing\");\nconst CodeGenerator_1 = require(\"../utilities/CodeGenerator\");\nconst language_1 = require(\"./language\");\nconst types_1 = require(\"./types\");\nfunction generateSource(context) {\n    const generator = new CodeGenerator_1.default(context);\n    generator.printOnNewline('/* @flow */');\n    generator.printOnNewline('/* eslint-disable */');\n    generator.printOnNewline('//  This file was automatically generated and should not be edited.');\n    typeDeclarationForGraphQLType(context.typesUsed.forEach(type => typeDeclarationForGraphQLType(generator, type)));\n    Object.values(context.operations).forEach(operation => {\n        interfaceVariablesDeclarationForOperation(generator, operation);\n        typeDeclarationForOperation(generator, operation);\n    });\n    Object.values(context.fragments).forEach(fragment => {\n        typeDeclarationForFragment(generator, fragment);\n    });\n    return generator.output;\n}\nexports.generateSource = generateSource;\nfunction typeDeclarationForGraphQLType(generator, type) {\n    if (type instanceof graphql_1.GraphQLEnumType) {\n        enumerationDeclaration(generator, type);\n    }\n    else if (type instanceof graphql_1.GraphQLInputObjectType) {\n        structDeclarationForInputObjectType(generator, type);\n    }\n}\nexports.typeDeclarationForGraphQLType = typeDeclarationForGraphQLType;\nfunction enumerationDeclaration(generator, type) {\n    const { name, description } = type;\n    const values = type.getValues();\n    generator.printNewlineIfNeeded();\n    if (description) {\n        description.split('\\n')\n            .forEach(line => {\n            generator.printOnNewline(`// ${line.trim()}`);\n        });\n    }\n    generator.printOnNewline(`export type ${name} =`);\n    const nValues = values.length;\n    values.forEach((value, i) => {\n        if (!value.description || value.description.indexOf('\\n') === -1) {\n            generator.printOnNewline(`  \"${value.value}\"${i === nValues - 1 ? ';' : ' |'}${printing_1.wrap(' // ', value.description)}`);\n        }\n        else {\n            if (value.description) {\n                value.description.split('\\n')\n                    .forEach(line => {\n                    generator.printOnNewline(`  // ${line.trim()}`);\n                });\n            }\n            generator.printOnNewline(`  \"${value.value}\"${i === nValues - 1 ? ';' : ' |'}`);\n        }\n    });\n    generator.printNewline();\n}\nfunction structDeclarationForInputObjectType(generator, type) {\n    const interfaceName = type.name;\n    language_1.typeDeclaration(generator, {\n        interfaceName,\n    }, () => {\n        const properties = propertiesFromFields(generator.context, Object.values(type.getFields()));\n        propertyDeclarations(generator, properties, true);\n    });\n}\nfunction interfaceNameFromOperation({ operationName, operationType }) {\n    switch (operationType) {\n        case 'query':\n            return `${operationName}Query`;\n            break;\n        case 'mutation':\n            return `${operationName}Mutation`;\n            break;\n        case 'subscription':\n            return `${operationName}Subscription`;\n            break;\n        default:\n            throw new graphql_1.GraphQLError(`Unsupported operation type \"${operationType}\"`);\n    }\n}\nfunction interfaceVariablesDeclarationForOperation(generator, { operationName, operationType, variables, fields, fragmentsReferenced, source, }) {\n    if (!variables || variables.length < 1) {\n        return null;\n    }\n    const interfaceName = `${interfaceNameFromOperation({ operationName, operationType })}Variables`;\n    language_1.typeDeclaration(generator, {\n        interfaceName,\n    }, () => {\n        const properties = propertiesFromFields(generator.context, variables);\n        propertyDeclarations(generator, properties, true);\n    });\n}\nexports.interfaceVariablesDeclarationForOperation = interfaceVariablesDeclarationForOperation;\nfunction getObjectTypeName(type) {\n    if (type instanceof graphql_1.GraphQLList) {\n        return getObjectTypeName(type.ofType);\n    }\n    if (type instanceof graphql_1.GraphQLNonNull) {\n        return getObjectTypeName(type.ofType);\n    }\n    if (type instanceof graphql_1.GraphQLObjectType) {\n        return `\"${type.name}\"`;\n    }\n    if (type instanceof graphql_1.GraphQLUnionType) {\n        return type.getTypes().map(type => getObjectTypeName(type)).join(\" | \");\n    }\n    return `\"${type.name}\"`;\n}\nfunction typeDeclarationForOperation(generator, { operationName, operationType, variables, fields, fragmentSpreads, fragmentsReferenced, source, }) {\n    const interfaceName = interfaceNameFromOperation({ operationName, operationType });\n    fields = fields.map(rootField => {\n        const fields = rootField.fields && rootField.fields.map(field => {\n            if (field.fieldName === '__typename') {\n                const objectTypeName = getObjectTypeName(rootField.type);\n                return Object.assign({}, field, { typeName: objectTypeName, type: { name: objectTypeName } });\n            }\n            return field;\n        });\n        return Object.assign({}, rootField, { fields });\n    });\n    const properties = propertiesFromFields(generator.context, fields);\n    language_1.typeDeclaration(generator, {\n        interfaceName,\n    }, () => {\n        propertyDeclarations(generator, properties);\n    });\n}\nexports.typeDeclarationForOperation = typeDeclarationForOperation;\nfunction typeDeclarationForFragment(generator, fragment) {\n    const { fragmentName, typeCondition, fields, inlineFragments, fragmentSpreads, source, } = fragment;\n    const interfaceName = `${fragmentName}Fragment`;\n    language_1.typeDeclaration(generator, {\n        interfaceName,\n        noBrackets: graphql_1.isAbstractType(typeCondition)\n    }, () => {\n        if (graphql_1.isAbstractType(typeCondition)) {\n            const propertySets = fragment.possibleTypes\n                .map(type => {\n                const inlineFragment = inlineFragments.find(inlineFragment => {\n                    return inlineFragment.typeCondition.toString() == type;\n                });\n                if (inlineFragment) {\n                    const fields = inlineFragment.fields.map(field => {\n                        if (field.fieldName === '__typename') {\n                            return Object.assign({}, field, { typeName: `\"${inlineFragment.typeCondition}\"`, type: { name: `\"${inlineFragment.typeCondition}\"` } });\n                        }\n                        else {\n                            return field;\n                        }\n                    });\n                    return propertiesFromFields(generator, fields);\n                }\n                else {\n                    const fragmentFields = fields.map(field => {\n                        if (field.fieldName === '__typename') {\n                            return Object.assign({}, field, { typeName: `\"${type}\"`, type: { name: `\"${type}\"` } });\n                        }\n                        else {\n                            return field;\n                        }\n                    });\n                    return propertiesFromFields(generator, fragmentFields);\n                }\n            });\n            language_1.propertySetsDeclaration(generator, fragment, propertySets, true);\n        }\n        else {\n            const fragmentFields = fields.map(field => {\n                if (field.fieldName === '__typename') {\n                    return Object.assign({}, field, { typeName: `\"${fragment.typeCondition}\"`, type: { name: `\"${fragment.typeCondition}\"` } });\n                }\n                else {\n                    return field;\n                }\n            });\n            const properties = propertiesFromFields(generator.context, fragmentFields);\n            propertyDeclarations(generator, properties);\n        }\n    });\n}\nexports.typeDeclarationForFragment = typeDeclarationForFragment;\nfunction propertiesFromFields(context, fields) {\n    return fields.map(field => propertyFromField(context, field));\n}\nexports.propertiesFromFields = propertiesFromFields;\nfunction propertyFromField(context, field) {\n    let { name: fieldName, type: fieldType, description, fragmentSpreads, inlineFragments } = field;\n    fieldName = fieldName || field.responseName;\n    const propertyName = fieldName;\n    let property = { fieldName, fieldType, propertyName, description };\n    let isNullable = true;\n    if (fieldType instanceof graphql_1.GraphQLNonNull) {\n        isNullable = false;\n    }\n    const namedType = graphql_1.getNamedType(fieldType);\n    if (graphql_1.isCompositeType(namedType)) {\n        const typeName = types_1.typeNameFromGraphQLType(context, fieldType);\n        let isArray = false;\n        let isArrayElementNullable = null;\n        if (fieldType instanceof graphql_1.GraphQLList) {\n            isArray = true;\n            isArrayElementNullable = !(fieldType.ofType instanceof graphql_1.GraphQLNonNull);\n        }\n        else if (fieldType instanceof graphql_1.GraphQLNonNull && fieldType.ofType instanceof graphql_1.GraphQLList) {\n            isArray = true;\n            isArrayElementNullable = !(fieldType.ofType.ofType instanceof graphql_1.GraphQLNonNull);\n        }\n        return Object.assign({}, property, { typeName, fields: field.fields, isComposite: true, fragmentSpreads, inlineFragments, fieldType,\n            isArray, isNullable, isArrayElementNullable });\n    }\n    else {\n        if (field.fieldName === '__typename') {\n            const typeName = types_1.typeNameFromGraphQLType(context, fieldType, null, false);\n            return Object.assign({}, property, { typeName, isComposite: false, fieldType, isNullable: false });\n        }\n        else {\n            const typeName = types_1.typeNameFromGraphQLType(context, fieldType, null, isNullable);\n            return Object.assign({}, property, { typeName, isComposite: false, fieldType, isNullable });\n        }\n    }\n}\nexports.propertyFromField = propertyFromField;\nfunction propertyDeclarations(generator, properties, isInput) {\n    if (!properties)\n        return;\n    properties.forEach(property => {\n        if (graphql_1.isAbstractType(graphql_1.getNamedType(property.type || property.fieldType))) {\n            const propertySets = getPossibleTypeNames(generator, property)\n                .map(type => {\n                const inlineFragment = property.inlineFragments.find(inlineFragment => {\n                    return inlineFragment.typeCondition.toString() == type;\n                });\n                if (inlineFragment) {\n                    const fields = inlineFragment.fields.map(field => {\n                        if (field.fieldName === '__typename') {\n                            return Object.assign({}, field, { typeName: `\"${inlineFragment.typeCondition}\"`, type: { name: `\"${inlineFragment.typeCondition}\"` } });\n                        }\n                        else {\n                            return field;\n                        }\n                    });\n                    return propertiesFromFields(generator, fields);\n                }\n                else {\n                    const fields = property.fields.map(field => {\n                        if (field.fieldName === '__typename') {\n                            return Object.assign({}, field, { typeName: `\"${type}\"`, type: { name: `\"${type}\"` } });\n                        }\n                        else {\n                            return field;\n                        }\n                    });\n                    return propertiesFromFields(generator, fields);\n                }\n            });\n            language_1.propertySetsDeclaration(generator, property, propertySets);\n        }\n        else {\n            if (property.fields && property.fields.length > 0\n                || property.inlineFragments && property.inlineFragments.length > 0\n                || property.fragmentSpreads && property.fragmentSpreads.length > 0) {\n                language_1.propertyDeclaration(generator, property, () => {\n                    const properties = propertiesFromFields(generator.context, property.fields);\n                    propertyDeclarations(generator, properties, isInput);\n                });\n            }\n            else {\n                language_1.propertyDeclaration(generator, Object.assign({}, property, { isInput }));\n            }\n        }\n    });\n}\nexports.propertyDeclarations = propertyDeclarations;\nfunction getPossibleTypeNames(generator, property) {\n    return generator.context.schema.getPossibleTypes(graphql_1.getNamedType(property.fieldType || property.type)).map(type => type.name);\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZUdlbmVyYXRpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjb2RlR2VuZXJhdGlvbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHFDQWNnQjtBQU1oQixvREFHK0I7QUFFL0IsOERBQXVEO0FBRXZELHlDQUlvQjtBQUVwQixtQ0FFaUI7QUFFakIsd0JBQStCLE9BQU87SUFDcEMsTUFBTSxTQUFTLEdBQUcsSUFBSSx1QkFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBRTdDLFNBQVMsQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDeEMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0lBQ2pELFNBQVMsQ0FBQyxjQUFjLENBQUMscUVBQXFFLENBQUMsQ0FBQztJQUNoRyw2QkFBNkIsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUM3RCw2QkFBNkIsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQy9DLENBQUMsQ0FBQztJQUNILE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFBRTtRQUNwRCx5Q0FBeUMsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDaEUsMkJBQTJCLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ3BELENBQUMsQ0FBQyxDQUFDO0lBQ0gsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1FBQ2xELDBCQUEwQixDQUFDLFNBQVMsRUFBRSxRQUFRLENBQUMsQ0FBQTtJQUNqRCxDQUFDLENBQUMsQ0FBQztJQUVILE9BQU8sU0FBUyxDQUFDLE1BQU0sQ0FBQztBQUMxQixDQUFDO0FBbEJELHdDQWtCQztBQUVELHVDQUE4QyxTQUFTLEVBQUUsSUFBSTtJQUMzRCxJ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Q2hEO1lBQ0gsQ0FBQyxDQUFDLENBQUM7WUFFTCxrQ0FBdUIsQ0FBQyxTQUFTLEVBQUUsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO1NBQzVEO2FBQU07WUFDTCxJQUFJLFFBQVEsQ0FBQyxNQUFNLElBQUksUUFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQzttQkFDNUMsUUFBUSxDQUFDLGVBQWUsSUFBSSxRQUFRLENBQUMsZUFBZSxDQUFDLE1BQU0sR0FBRyxDQUFDO21CQUMvRCxRQUFRLENBQUMsZUFBZSxJQUFJLFFBQVEsQ0FBQyxlQUFlLENBQUMsTUFBTSxHQUFHLENBQUMsRUFDbEU7Z0JBQ0EsOEJBQW1CLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUU7b0JBQzVDLE1BQU0sVUFBVSxHQUFHLG9CQUFvQixDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUM1RSxvQkFBb0IsQ0FBQyxTQUFTLEVBQUUsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDO2dCQUN2RCxDQUFDLENBQUMsQ0FBQzthQUNKO2lCQUFNO2dCQUNMLDhCQUFtQixDQUFDLFNBQVMsb0JBQU0sUUFBUSxJQUFFLE9BQU8sSUFBRSxDQUFDO2FBQ3hEO1NBQ0Y7SUFDSCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUF4REQsb0RBd0RDO0FBT0QsOEJBQThCLFNBQVMsRUFBRSxRQUFRO0lBQy9DLE9BQU8sU0FBUyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsc0JBQVksQ0FBQyxRQUFRLENBQUMsU0FBUyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM3SCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgR3JhcGhRTEVycm9yLFxuICBnZXROYW1lZFR5cGUsXG4gIGlzQ29tcG9zaXRlVHlwZSxcbiAgaXNBYnN0cmFjdFR5cGUsXG4gIGlzRXF1YWxUeXBlLFxuICBHcmFwaFFMU2NhbGFyVHlwZSxcbiAgR3JhcGhRTEVudW1UeXBlLFxuICBHcmFwaFFMTGlzdCxcbiAgR3JhcGhRTE5vbk51bGwsXG4gIEdyYXBoUUxJRCxcbiAgR3JhcGhRTElucHV0T2JqZWN0VHlwZSxcbiAgR3JhcGhRTE9iamVjdFR5cGUsXG4gIEdyYXBoUUxVbmlvblR5cGVcbn0gZnJvbSAnZ3JhcGhxbCdcblxuaW1wb3J0ICB7IGlzVHlwZVByb3BlclN1cGVyVHlwZU9mIH0gZnJvbSAnLi4vdXRpbGl0aWVzL2dyYXBocWwnO1xuXG5pbXBvcnQgKiBhcyBJbmZsZWN0b3IgZnJvbSAnaW5mbGVjdGVkJztcblxuaW1wb3J0IHtcbiAgam9pbixcbiAgd3JhcCxcbn0gZnJvbSAnLi4vdXRpbGl0aWVzL3ByaW50aW5nJztcblxuaW1wb3J0IENvZGVHZW5lcmF0b3IgZnJvbSAnLi4vdXRpbGl0aWVzL0NvZGVHZW5lcmF0b3InO1xuXG5pbXBvcnQge1xuICB0eXBlRGVjbGFyYXRpb24sXG4gIHByb3BlcnR5RGVjbGFyYXRpb24sXG4gIHByb3BlcnR5U2V0c0RlY2xhcmF0aW9uXG59IGZyb20gJy4vbGFuZ3VhZ2UnO1xuXG5pbXBvcnQge1xuICB0eXBlTmFtZUZyb21HcmFwaFFMVHlwZSxcbn0gZnJvbSAnLi90eXBlcyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVNvdXJjZShjb250ZXh0KSB7XG4gIGNvbnN0IGdlbmVyYXRvciA9IG5ldyBDb2RlR2VuZXJhdG9yKGNvbnRleHQpO1xuXG4gIGdlbmVyYXRvci5wcmludE9uTmV3bGluZSgnLyogQGZsb3cgKi8nKTtcbiAgZ2VuZXJhdG9yLnByaW50T25OZXdsaW5lKCcvKiBlc2xpbnQtZGlzYWJsZSAqLycpO1xuICBnZW5lcmF0b3IucHJpbnRPbk5ld2xpbmUoJy8vICBUaGlzIGZpbGUgd2FzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGFuZCBzaG91bGQgbm90IGJlIGVkaXRlZC4nKTtcbiAgdHlwZURlY2xhcmF0aW9uRm9yR3JhcGhRTFR5cGUoY29udGV4dC50eXBlc1VzZWQuZm9yRWFjaCh0eXBlID0+XG4gICAgdHlwZURlY2xhcmF0aW9uRm9yR3JhcGhRTFR5cGUoZ2VuZXJhdG9yLCB0eXBlKVxuICApKTtcbiAgT2JqZWN0LnZhbHVlcyhjb250ZXh0Lm9wZXJhdGlvbnMpLmZvckVhY2gob3BlcmF0aW9uID0+IHtcbiAgICBpbnRlcmZhY2VWYXJpYWJsZXNEZWNsYXJhdGlvbkZvck9wZXJhdGlvbihnZW5lcmF0b3IsIG9wZXJhdGlvbik7XG4gICAgdHlwZURlY2xhcmF0aW9uRm9yT3BlcmF0aW9uKGdlbmVyYXRvciwgb3BlcmF0aW9uKTtcbiAgfSk7XG4gIE9iamVjdC52YWx1ZXMoY29udGV4dC5mcmFnbWVudHMpLmZvckVhY2goZnJhZ21lbnQgPT4ge1xuICAgIHR5cGVEZWNsYXJhdGlvbkZvckZyYWdtZW50KGdlbmVyYXRvciwgZnJhZ21lbnQpXG4gIH0pO1xuXG4gIHJldHVybiBnZW5lcmF0b3Iub3V0cHV0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdHlwZURlY2xhcmF0aW9uRm9yR3JhcGhRTFR5cGUoZ2VuZXJhdG9yLCB0eXBlKSB7XG4gIGlmICh0eXBlIGluc3RhbmNlb2YgR3JhcGhRTEVudW1UeXBlKSB7XG4gICAgZW51bWVyYXRpb25EZWNsYXJhdGlvbihnZW5lcmF0b3IsIHR5cGUpO1xuICB9IGVsc2UgaWYgKHR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMSW5wdXRPYmplY3RUeXBlKSB7XG4gICAgc3RydWN0RGVjbGFyYXRpb25Gb3JJbnB1dE9iamVjdFR5cGUoZ2VuZXJhdG9yLCB0eXBlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBlbnVtZXJhdGlvbkRlY2xhcmF0aW9uKGdlbmVyYXRvciwgdHlwZSkge1xuICBjb25zdCB7IG5hbWUsIGRlc2NyaXB0aW9uIH0gPSB0eXBlO1xuICBjb25zdCB2YWx1ZXMgPSB0eXBlLmdldFZhbHVlcygpO1xuXG4gIGdlbmVyYXRvci5wcmludE5ld2xpbmVJZk5lZWRlZCgpO1xuICBpZiAoZGVzY3JpcHRpb24pIHtcbiAgICBkZXNjcmlwdGlvbi5zcGxpdCgnXFxuJylcbiAgICAgIC5mb3JFYWNoKGxpbmUgPT4ge1xuICAgICAgICBnZW5lcmF0b3IucHJpbnRPbk5ld2xpbmUoYC8vICR7bGluZS50cmltKCl9YCk7XG4gICAgICB9KVxuICB9XG4gIGdlbmVyYXRvci5wcmludE9uTmV3bGluZShgZXhwb3J0IHR5cGUgJHtuYW1lfSA9YCk7XG4gIGNvbnN0IG5WYWx1ZXMgPSB2YWx1ZXMubGVuZ3RoO1xuICB2YWx1ZXMuZm9yRWFjaCgodmFsdWUsIGkpID0+IHtcbiAgICBpZiAoIXZhbHVlLmRlc2NyaXB0aW9uIHx8IHZhbHVlLmRlc2NyaXB0aW9uLmluZGV4T2YoJ1xcbicpID09PSAtMSkge1xuICAgICAgZ2VuZXJhdG9yLnByaW50T25OZXdsaW5lKGAgIFwiJHt2YWx1ZS52YWx1ZX1cIiR7aSA9PT0gblZhbHVlcyAtIDEgPyAnOycgOiAnIHwnfSR7d3JhcCgnIC8vICcsIHZhbHVlLmRlc2NyaXB0aW9uKX1gKVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodmFsdWUuZGVzY3JpcHRpb24pIHtcbiAgICAgICAgdmFsdWUuZGVzY3JpcHRpb24uc3BsaXQoJ1xcbicpXG4gICAgICAgICAgLmZvckVhY2gobGluZSA9PiB7XG4gICAgICAgICAgICBnZW5lcmF0b3IucHJpbnRPbk5ld2xpbmUoYCAgLy8gJHtsaW5lLnRyaW0oKX1gKTtcbiAgICAgICAgICB9KVxuICAgICAgfVxuICAgICAgZ2VuZXJhdG9yLnByaW50T25OZXdsaW5lKGAgIFwiJHt2YWx1ZS52YWx1ZX1cIiR7aSA9PT0gblZhbHVlcyAtIDEgPyAnOycgOiAnIHwnfWApXG4gICAgfVxuICB9KTtcbiAgZ2VuZXJhdG9yLnByaW50TmV3bGluZSgpO1xufVxuXG5mdW5jdGlvbiBzdHJ1Y3REZWNsYXJhdGlvbkZvcklucHV0T2JqZWN0VHlwZShcbiAgZ2VuZXJhdG9yLFxuICB0eXBlXG4pIHtcbiAgY29uc3QgaW50ZXJmYWNlTmFtZSA9IHR5cGUubmFtZTtcbiAgdHlwZURlY2xhcmF0aW9uKGdlbmVyYXRvciwge1xuICAgIGludGVyZmFjZU5hbWUsXG4gIH0sICgpID0+IHtcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gcHJvcGVydGllc0Zyb21GaWVsZHMoZ2VuZXJhdG9yLmNvbnRleHQsIE9iamVjdC52YWx1ZXModHlwZS5nZXRGaWVsZHMoKSkpO1xuICAgIHByb3BlcnR5RGVjbGFyYXRpb25zKGdlbmVyYXRvciwgcHJvcGVydGllcywgdHJ1ZSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBpbnRlcmZhY2VOYW1lRnJvbU9wZXJhdGlvbih7b3BlcmF0aW9uTmFtZSwgb3BlcmF0aW9uVHlwZX0pIHtcbiAgc3dpdGNoIChvcGVyYXRpb25UeXBlKSB7XG4gICAgY2FzZSAncXVlcnknOlxuICAgICAgcmV0dXJuIGAke29wZXJhdGlvbk5hbWV9UXVlcnlgO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnbXV0YXRpb24nOlxuICAgICAgcmV0dXJuIGAke29wZXJhdGlvbk5hbWV9TXV0YXRpb25gO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnc3Vic2NyaXB0aW9uJzpcbiAgICAgIHJldHVybiBgJHtvcGVyYXRpb25OYW1lfVN1YnNjcmlwdGlvbmA7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgbmV3IEdyYXBoUUxFcnJvcihgVW5zdXBwb3J0ZWQgb3BlcmF0aW9uIHR5cGUgXCIke29wZXJhdGlvblR5cGV9XCJgKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaW50ZXJmYWNlVmFyaWFibGVzRGVjbGFyYXRpb25Gb3JPcGVyYXRpb24oXG4gIGdlbmVyYXRvcixcbiAge1xuICAgIG9wZXJhdGlvbk5hbWUsXG4gICAgb3BlcmF0aW9uVHlwZSxcbiAgICB2YXJpYWJsZXMsXG4gICAgZmllbGRzLFxuICAgIGZyYWdtZW50c1JlZmVyZW5jZWQsXG4gICAgc291cmNlLFxuICB9XG4pIHtcbiAgaWYgKCF2YXJpYWJsZXMgfHwgdmFyaWFibGVzLmxlbmd0aCA8IDEpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCBpbnRlcmZhY2VOYW1lID0gYCR7aW50ZXJmYWNlTmFtZUZyb21PcGVyYXRpb24oe29wZXJhdGlvbk5hbWUsIG9wZXJhdGlvblR5cGV9KX1WYXJpYWJsZXNgO1xuXG4gIHR5cGVEZWNsYXJhdGlvbihnZW5lcmF0b3IsIHtcbiAgICBpbnRlcmZhY2VOYW1lLFxuICB9LCAoKSA9PiB7XG4gICAgY29uc3QgcHJvcGVydGllcyA9IHByb3BlcnRpZXNGcm9tRmllbGRzKGdlbmVyYXRvci5jb250ZXh0LCB2YXJpYWJsZXMpO1xuICAgIHByb3BlcnR5RGVjbGFyYXRpb25zKGdlbmVyYXRvciwgcHJvcGVydGllcywgdHJ1ZSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRPYmplY3RUeXBlTmFtZSh0eXBlKSB7XG4gIGlmICh0eXBlIGluc3RhbmNlb2YgR3JhcGhRTExpc3QpIHtcbiAgICByZXR1cm4gZ2V0T2JqZWN0VHlwZU5hbWUodHlwZS5vZlR5cGUpO1xuICB9XG4gIGlmICh0eXBlIGluc3RhbmNlb2YgR3JhcGhRTE5vbk51bGwpIHtcbiAgICByZXR1cm4gZ2V0T2JqZWN0VHlwZU5hbWUodHlwZS5vZlR5cGUpO1xuICB9XG4gIGlmICh0eXBlIGluc3RhbmNlb2YgR3JhcGhRTE9iamVjdFR5cGUpIHtcbiAgICByZXR1cm4gYFwiJHt0eXBlLm5hbWV9XCJgO1xuICB9XG4gIGlmICh0eXBlIGluc3RhbmNlb2YgR3JhcGhRTFVuaW9uVHlwZSkge1xuICAgIHJldHVybiB0eXBlLmdldFR5cGVzKCkubWFwKHR5cGUgPT4gZ2V0T2JqZWN0VHlwZU5hbWUodHlwZSkpLmpvaW4oXCIgfCBcIik7XG4gIH1cbiAgcmV0dXJuIGBcIiR7dHlwZS5uYW1lfVwiYDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHR5cGVEZWNsYXJhdGlvbkZvck9wZXJhdGlvbihcbiAgZ2VuZXJhdG9yLFxuICB7XG4gICAgb3BlcmF0aW9uTmFtZSxcbiAgICBvcGVyYXRpb25UeXBlLFxuICAgIHZhcmlhYmxlcyxcbiAgICBmaWVsZHMsXG4gICAgZnJhZ21lbnRTcHJlYWRzLFxuICAgIGZyYWdtZW50c1JlZmVyZW5jZWQsXG4gICAgc291cmNlLFxuICB9XG4pIHtcbiAgY29uc3QgaW50ZXJmYWNlTmFtZSA9IGludGVyZmFjZU5hbWVGcm9tT3BlcmF0aW9uKHtvcGVyYXRpb25OYW1lLCBvcGVyYXRpb25UeXBlfSk7XG4gIGZpZWxkcyA9IGZpZWxkcy5tYXAocm9vdEZpZWxkID0+IHtcbiAgICBjb25zdCBmaWVsZHMgPSByb290RmllbGQuZmllbGRzICYmIHJvb3RGaWVsZC5maWVsZHMubWFwKGZpZWxkID0+IHtcbiAgICAgIGlmIChmaWVsZC5maWVsZE5hbWUgPT09ICdfX3R5cGVuYW1lJykge1xuICAgICAgICBjb25zdCBvYmplY3RUeXBlTmFtZSA9IGdldE9iamVjdFR5cGVOYW1lKHJvb3RGaWVsZC50eXBlKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5maWVsZCxcbiAgICAgICAgICB0eXBlTmFtZTogb2JqZWN0VHlwZU5hbWUsXG4gICAgICAgICAgdHlwZTogeyBuYW1lOiBvYmplY3RUeXBlTmFtZSB9LFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZpZWxkO1xuICAgIH0pO1xuICAgIHJldHVybiB7XG4gICAgICAuLi5yb290RmllbGQsXG4gICAgICBmaWVsZHMsXG4gICAgfTtcbiAgfSk7XG4gIGNvbnN0IHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhnZW5lcmF0b3IuY29udGV4dCwgZmllbGRzKTtcbiAgdHlwZURlY2xhcmF0aW9uKGdlbmVyYXRvciwge1xuICAgIGludGVyZmFjZU5hbWUsXG4gIH0sICgpID0+IHtcbiAgICBwcm9wZXJ0eURlY2xhcmF0aW9ucyhnZW5lcmF0b3IsIHByb3BlcnRpZXMpO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHR5cGVEZWNsYXJhdGlvbkZvckZyYWdtZW50KFxuICBnZW5lcmF0b3IsXG4gIGZyYWdtZW50XG4pIHtcbiAgY29uc3Qge1xuICAgIGZyYWdtZW50TmFtZSxcbiAgICB0eXBlQ29uZGl0aW9uLFxuICAgIGZpZWxkcyxcbiAgICBpbmxpbmVGcmFnbWVudHMsXG4gICAgZnJhZ21lbnRTcHJlYWRzLFxuICAgIHNvdXJjZSxcbiAgfSA9IGZyYWdtZW50O1xuXG4gIGNvbnN0IGludGVyZmFjZU5hbWUgPSBgJHtmcmFnbWVudE5hbWV9RnJhZ21lbnRgO1xuXG4gIHR5cGVEZWNsYXJhdGlvbihnZW5lcmF0b3IsIHtcbiAgICBpbnRlcmZhY2VOYW1lLFxuICAgIG5vQnJhY2tldHM6IGlzQWJzdHJhY3RUeXBlKHR5cGVDb25kaXRpb24pXG4gIH0sICgpID0+IHtcbiAgICBpZiAoaXNBYnN0cmFjdFR5cGUodHlwZUNvbmRpdGlvbikpIHtcbiAgICAgIGNvbnN0IHByb3BlcnR5U2V0cyA9IGZyYWdtZW50LnBvc3NpYmxlVHlwZXNcbiAgICAgICAgLm1hcCh0eXBlID0+IHtcbiAgICAgICAgICAvLyBOT1RFOiBpbmxpbmVGcmFnbWVudCBjdXJyZW50bHkgY29uc2lzdHMgb2YgdGhlIG1lcmdlZCBmaWVsZHNcbiAgICAgICAgICAvLyBmcm9tIGJvdGggaW5saW5lIGZyYWdtZW50cyBhbmQgZnJhZ21lbnQgc3ByZWFkcy5cbiAgICAgICAgICAvLyBUT0RPOiBSZW5hbWUgaW5saW5lRnJhZ21lbnRzIGluIHRoZSBJUi5cbiAgICAgICAgICBjb25zdCBpbmxpbmVGcmFnbWVudCA9IGlubGluZUZyYWdtZW50cy5maW5kKGlubGluZUZyYWdtZW50ID0+IHtcbiAgICAgICAgICAgIHJldHVybiBpbmxpbmVGcmFnbWVudC50eXBlQ29uZGl0aW9uLnRvU3RyaW5nKCkgPT0gdHlwZVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgaWYgKGlubGluZUZyYWdtZW50KSB7XG4gICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBpbmxpbmVGcmFnbWVudC5maWVsZHMubWFwKGZpZWxkID0+IHtcbiAgICAgICAgICAgICAgaWYgKGZpZWxkLmZpZWxkTmFtZSA9PT0gJ19fdHlwZW5hbWUnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgIC4uLmZpZWxkLFxuICAgICAgICAgICAgICAgICAgdHlwZU5hbWU6IGBcIiR7aW5saW5lRnJhZ21lbnQudHlwZUNvbmRpdGlvbn1cImAsXG4gICAgICAgICAgICAgICAgICB0eXBlOiB7IG5hbWU6IGBcIiR7aW5saW5lRnJhZ21lbnQudHlwZUNvbmRpdGlvbn1cImAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gcHJvcGVydGllc0Zyb21GaWVsZHMoZ2VuZXJhdG9yLCBmaWVsZHMpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBmcmFnbWVudEZpZWxkcyA9IGZpZWxkcy5tYXAoZmllbGQgPT4ge1xuICAgICAgICAgICAgICBpZiAoZmllbGQuZmllbGROYW1lID09PSAnX190eXBlbmFtZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgLi4uZmllbGQsXG4gICAgICAgICAgICAgICAgICB0eXBlTmFtZTogYFwiJHt0eXBlfVwiYCxcbiAgICAgICAgICAgICAgICAgIHR5cGU6IHsgbmFtZTogYFwiJHt0eXBlfVwiYCB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhnZW5lcmF0b3IsIGZyYWdtZW50RmllbGRzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICBwcm9wZXJ0eVNldHNEZWNsYXJhdGlvbihnZW5lcmF0b3IsIGZyYWdtZW50LCBwcm9wZXJ0eVNldHMsIHRydWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBmcmFnbWVudEZpZWxkcyA9IGZpZWxkcy5tYXAoZmllbGQgPT4ge1xuICAgICAgICBpZiAoZmllbGQuZmllbGROYW1lID09PSAnX190eXBlbmFtZScpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uZmllbGQsXG4gICAgICAgICAgICB0eXBlTmFtZTogYFwiJHtmcmFnbWVudC50eXBlQ29uZGl0aW9ufVwiYCxcbiAgICAgICAgICAgIHR5cGU6IHsgbmFtZTogYFwiJHtmcmFnbWVudC50eXBlQ29uZGl0aW9ufVwiYCB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBjb25zdCBwcm9wZXJ0aWVzID0gcHJvcGVydGllc0Zyb21GaWVsZHMoZ2VuZXJhdG9yLmNvbnRleHQsIGZyYWdtZW50RmllbGRzKVxuICAgICAgcHJvcGVydHlEZWNsYXJhdGlvbnMoZ2VuZXJhdG9yLCBwcm9wZXJ0aWVzKTtcbiAgICB9XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJvcGVydGllc0Zyb21GaWVsZHMoY29udGV4dCwgZmllbGRzKSB7XG4gIHJldHVybiBmaWVsZHMubWFwKGZpZWxkID0+IHByb3BlcnR5RnJvbUZpZWxkKGNvbnRleHQsIGZpZWxkKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcm9wZXJ0eUZyb21GaWVsZChjb250ZXh0LCBmaWVsZCkge1xuICBsZXQgeyBuYW1lOiBmaWVsZE5hbWUsIHR5cGU6IGZpZWxkVHlwZSwgZGVzY3JpcHRpb24sIGZyYWdtZW50U3ByZWFkcywgaW5saW5lRnJhZ21lbnRzIH0gPSBmaWVsZDtcbiAgZmllbGROYW1lID0gZmllbGROYW1lIHx8IGZpZWxkLnJlc3BvbnNlTmFtZTtcblxuICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBmaWVsZE5hbWU7XG5cbiAgbGV0IHByb3BlcnR5ID0geyBmaWVsZE5hbWUsIGZpZWxkVHlwZSwgcHJvcGVydHlOYW1lLCBkZXNjcmlwdGlvbiB9O1xuXG4gIGxldCBpc051bGxhYmxlID0gdHJ1ZTtcbiAgaWYgKGZpZWxkVHlwZSBpbnN0YW5jZW9mIEdyYXBoUUxOb25OdWxsKSB7XG4gICAgaXNOdWxsYWJsZSA9IGZhbHNlO1xuICB9XG4gIGNvbnN0IG5hbWVkVHlwZSA9IGdldE5hbWVkVHlwZShmaWVsZFR5cGUpO1xuICBpZiAoaXNDb21wb3NpdGVUeXBlKG5hbWVkVHlwZSkpIHtcbiAgICBjb25zdCB0eXBlTmFtZSA9IHR5cGVOYW1lRnJvbUdyYXBoUUxUeXBlKGNvbnRleHQsIGZpZWxkVHlwZSk7XG4gICAgbGV0IGlzQXJyYXkgPSBmYWxzZTtcbiAgICBsZXQgaXNBcnJheUVsZW1lbnROdWxsYWJsZSA9IG51bGw7XG4gICAgaWYgKGZpZWxkVHlwZSBpbnN0YW5jZW9mIEdyYXBoUUxMaXN0KSB7XG4gICAgICBpc0FycmF5ID0gdHJ1ZTtcbiAgICAgIGlzQXJyYXlFbGVtZW50TnVsbGFibGUgPSAhKGZpZWxkVHlwZS5vZlR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMTm9uTnVsbCk7XG4gICAgfSBlbHNlIGlmIChmaWVsZFR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMTm9uTnVsbCAmJiBmaWVsZFR5cGUub2ZUeXBlIGluc3RhbmNlb2YgR3JhcGhRTExpc3QpIHtcbiAgICAgIGlzQXJyYXkgPSB0cnVlO1xuICAgICAgaXNBcnJheUVsZW1lbnROdWxsYWJsZSA9ICEoZmllbGRUeXBlLm9mVHlwZS5vZlR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMTm9uTnVsbCk7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAuLi5wcm9wZXJ0eSxcbiAgICAgIHR5cGVOYW1lLCBmaWVsZHM6IGZpZWxkLmZpZWxkcywgaXNDb21wb3NpdGU6IHRydWUsIGZyYWdtZW50U3ByZWFkcywgaW5saW5lRnJhZ21lbnRzLCBmaWVsZFR5cGUsXG4gICAgICBpc0FycmF5LCBpc051bGxhYmxlLCBpc0FycmF5RWxlbWVudE51bGxhYmxlLFxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgaWYgKGZpZWxkLmZpZWxkTmFtZSA9PT0gJ19fdHlwZW5hbWUnKSB7XG4gICAgICBjb25zdCB0eXBlTmFtZSA9IHR5cGVOYW1lRnJvbUdyYXBoUUxUeXBlKGNvbnRleHQsIGZpZWxkVHlwZSwgbnVsbCwgZmFsc2UpO1xuICAgICAgcmV0dXJuIHsgLi4ucHJvcGVydHksIHR5cGVOYW1lLCBpc0NvbXBvc2l0ZTogZmFsc2UsIGZpZWxkVHlwZSwgaXNOdWxsYWJsZTogZmFsc2UgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgdHlwZU5hbWUgPSB0eXBlTmFtZUZyb21HcmFwaFFMVHlwZShjb250ZXh0LCBmaWVsZFR5cGUsIG51bGwsIGlzTnVsbGFibGUpO1xuICAgICAgcmV0dXJuIHsgLi4ucHJvcGVydHksIHR5cGVOYW1lLCBpc0NvbXBvc2l0ZTogZmFsc2UsIGZpZWxkVHlwZSwgaXNOdWxsYWJsZSB9O1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJvcGVydHlEZWNsYXJhdGlvbnMoZ2VuZXJhdG9yLCBwcm9wZXJ0aWVzLCBpc0lucHV0KSB7XG4gIGlmICghcHJvcGVydGllcykgcmV0dXJuO1xuICBwcm9wZXJ0aWVzLmZvckVhY2gocHJvcGVydHkgPT4ge1xuICAgIGlmIChpc0Fic3RyYWN0VHlwZShnZXROYW1lZFR5cGUocHJvcGVydHkudHlwZSB8fCBwcm9wZXJ0eS5maWVsZFR5cGUpKSkge1xuICAgICAgY29uc3QgcHJvcGVydHlTZXRzID0gZ2V0UG9zc2libGVUeXBlTmFtZXMoZ2VuZXJhdG9yLCBwcm9wZXJ0eSlcbiAgICAgICAgLm1hcCh0eXBlID0+IHtcbiAgICAgICAgICBjb25zdCBpbmxpbmVGcmFnbWVudCA9IHByb3BlcnR5LmlubGluZUZyYWdtZW50cy5maW5kKGlubGluZUZyYWdtZW50ID0+IHtcbiAgICAgICAgICAgIHJldHVybiBpbmxpbmVGcmFnbWVudC50eXBlQ29uZGl0aW9uLnRvU3RyaW5nKCkgPT0gdHlwZVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgaWYgKGlubGluZUZyYWdtZW50KSB7XG4gICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBpbmxpbmVGcmFnbWVudC5maWVsZHMubWFwKGZpZWxkID0+IHtcbiAgICAgICAgICAgICAgaWYgKGZpZWxkLmZpZWxkTmFtZSA9PT0gJ19fdHlwZW5hbWUnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgIC4uLmZpZWxkLFxuICAgICAgICAgICAgICAgICAgdHlwZU5hbWU6IGBcIiR7aW5saW5lRnJhZ21lbnQudHlwZUNvbmRpdGlvbn1cImAsXG4gICAgICAgICAgICAgICAgICB0eXBlOiB7IG5hbWU6IGBcIiR7aW5saW5lRnJhZ21lbnQudHlwZUNvbmRpdGlvbn1cImAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gcHJvcGVydGllc0Zyb21GaWVsZHMoZ2VuZXJhdG9yLCBmaWVsZHMpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBwcm9wZXJ0eS5maWVsZHMubWFwKGZpZWxkID0+IHtcbiAgICAgICAgICAgICAgaWYgKGZpZWxkLmZpZWxkTmFtZSA9PT0gJ19fdHlwZW5hbWUnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgIC4uLmZpZWxkLFxuICAgICAgICAgICAgICAgICAgdHlwZU5hbWU6IGBcIiR7dHlwZX1cImAsXG4gICAgICAgICAgICAgICAgICB0eXBlOiB7IG5hbWU6IGBcIiR7dHlwZX1cImAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gcHJvcGVydGllc0Zyb21GaWVsZHMoZ2VuZXJhdG9yLCBmaWVsZHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgIHByb3BlcnR5U2V0c0RlY2xhcmF0aW9uKGdlbmVyYXRvciwgcHJvcGVydHksIHByb3BlcnR5U2V0cyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChwcm9wZXJ0eS5maWVsZHMgJiYgcHJvcGVydHkuZmllbGRzLmxlbmd0aCA+IDBcbiAgICAgICAgfHwgcHJvcGVydHkuaW5saW5lRnJhZ21lbnRzICYmIHByb3BlcnR5LmlubGluZUZyYWdtZW50cy5sZW5ndGggPiAwXG4gICAgICAgIHx8IHByb3BlcnR5LmZyYWdtZW50U3ByZWFkcyAmJiBwcm9wZXJ0eS5mcmFnbWVudFNwcmVhZHMubGVuZ3RoID4gMFxuICAgICAgKSB7XG4gICAgICAgIHByb3BlcnR5RGVjbGFyYXRpb24oZ2VuZXJhdG9yLCBwcm9wZXJ0eSwgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhnZW5lcmF0b3IuY29udGV4dCwgcHJvcGVydHkuZmllbGRzKTtcbiAgICAgICAgICBwcm9wZXJ0eURlY2xhcmF0aW9ucyhnZW5lcmF0b3IsIHByb3BlcnRpZXMsIGlzSW5wdXQpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHByb3BlcnR5RGVjbGFyYXRpb24oZ2VuZXJhdG9yLCB7Li4ucHJvcGVydHksIGlzSW5wdXR9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIFRoaXMgZXhpc3RzIG9ubHkgdG8gcHJvcGVybHkgZ2VuZXJhdGUgdHlwZXMgZm9yIHVuaW9uL2ludGVyZmFjZSB0eXBlZCBmaWVsZHMgdGhhdFxuICogZG8gbm90IGhhdmUgaW5saW5lIGZyYWdtZW50cy4gVGhpcyBjdXJyZW50bHkgY2FuIGhhcHBlbiBhbmQgdGhlIElSIGRvZXMgZ2l2ZSB1c1xuICogYSBzZXQgb2YgZmllbGRzIHBlciB0eXBlIGNvbmRpdGlvbiB1bmxlc3MgZnJhZ21lbnRzIGFyZSB1c2VkIHdpdGhpbiB0aGUgc2VsZWN0aW9uIHNldC5cbiAqL1xuZnVuY3Rpb24gZ2V0UG9zc2libGVUeXBlTmFtZXMoZ2VuZXJhdG9yLCBwcm9wZXJ0eSkge1xuICByZXR1cm4gZ2VuZXJhdG9yLmNvbnRleHQuc2NoZW1hLmdldFBvc3NpYmxlVHlwZXMoZ2V0TmFtZWRUeXBlKHByb3BlcnR5LmZpZWxkVHlwZSB8fCBwcm9wZXJ0eS50eXBlKSkubWFwKHR5cGUgPT4gdHlwZS5uYW1lKTtcbn1cbiJdfQ==");"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const graphql_1 = require("graphql");
const printing_1 = require("../utilities/printing");
const CodeGenerator_1 = require("../utilities/CodeGenerator");
const language_1 = require("./language");
const types_1 = require("./types");
function generateSource(context) {
    const generator = new CodeGenerator_1.default(context);
    generator.printOnNewline('/* @flow */');
    generator.printOnNewline('/* eslint-disable */');
    generator.printOnNewline('//  This file was automatically generated and should not be edited.');
    typeDeclarationForGraphQLType(context.typesUsed.forEach(type => typeDeclarationForGraphQLType(generator, type)));
    Object.values(context.operations).forEach(operation => {
        interfaceVariablesDeclarationForOperation(generator, operation);
        typeDeclarationForOperation(generator, operation);
    });
    Object.values(context.fragments).forEach(fragment => {
        typeDeclarationForFragment(generator, fragment);
    });
    return generator.output;
}
exports.generateSource = generateSource;
function typeDeclarationForGraphQLType(generator, type) {
    if (type instanceof graphql_1.GraphQLEnumType) {
        enumerationDeclaration(generator, type);
    } else
    if (type instanceof graphql_1.GraphQLInputObjectType) {
        structDeclarationForInputObjectType(generator, type);
    }
}
exports.typeDeclarationForGraphQLType = typeDeclarationForGraphQLType;
function enumerationDeclaration(generator, type) {
    const { name, description } = type;
    const values = type.getValues();
    generator.printNewlineIfNeeded();
    if (description) {
        description.split('\n').
        forEach(line => {
            generator.printOnNewline(`// ${line.trim()}`);
        });
    }
    generator.printOnNewline(`export type ${name} =`);
    const nValues = values.length;
    values.forEach((value, i) => {
        if (!value.description || value.description.indexOf('\n') === -1) {
            generator.printOnNewline(`  "${value.value}"${i === nValues - 1 ? ';' : ' |'}${printing_1.wrap(' // ', value.description)}`);
        } else
        {
            if (value.description) {
                value.description.split('\n').
                forEach(line => {
                    generator.printOnNewline(`  // ${line.trim()}`);
                });
            }
            generator.printOnNewline(`  "${value.value}"${i === nValues - 1 ? ';' : ' |'}`);
        }
    });
    generator.printNewline();
}
function structDeclarationForInputObjectType(generator, type) {
    const interfaceName = type.name;
    language_1.typeDeclaration(generator, {
        interfaceName },
    () => {
        const properties = propertiesFromFields(generator.context, Object.values(type.getFields()));
        propertyDeclarations(generator, properties, true);
    });
}
function interfaceNameFromOperation({ operationName, operationType }) {
    switch (operationType) {
        case 'query':
            return `${operationName}Query`;
            break;
        case 'mutation':
            return `${operationName}Mutation`;
            break;
        case 'subscription':
            return `${operationName}Subscription`;
            break;
        default:
            throw new graphql_1.GraphQLError(`Unsupported operation type "${operationType}"`);}

}
function interfaceVariablesDeclarationForOperation(generator, { operationName, operationType, variables, fields, fragmentsReferenced, source }) {
    if (!variables || variables.length < 1) {
        return null;
    }
    const interfaceName = `${interfaceNameFromOperation({ operationName, operationType })}Variables`;
    language_1.typeDeclaration(generator, {
        interfaceName },
    () => {
        const properties = propertiesFromFields(generator.context, variables);
        propertyDeclarations(generator, properties, true);
    });
}
exports.interfaceVariablesDeclarationForOperation = interfaceVariablesDeclarationForOperation;
function getObjectTypeName(type) {
    if (type instanceof graphql_1.GraphQLList) {
        return getObjectTypeName(type.ofType);
    }
    if (type instanceof graphql_1.GraphQLNonNull) {
        return getObjectTypeName(type.ofType);
    }
    if (type instanceof graphql_1.GraphQLObjectType) {
        return `"${type.name}"`;
    }
    if (type instanceof graphql_1.GraphQLUnionType) {
        return type.getTypes().map(type => getObjectTypeName(type)).join(" | ");
    }
    return `"${type.name}"`;
}
function typeDeclarationForOperation(generator, { operationName, operationType, variables, fields, fragmentSpreads, fragmentsReferenced, source }) {
    const interfaceName = interfaceNameFromOperation({ operationName, operationType });
    fields = fields.map(rootField => {
        const fields = rootField.fields && rootField.fields.map(field => {
            if (field.fieldName === '__typename') {
                const objectTypeName = getObjectTypeName(rootField.type);
                return Object.assign({}, field, { typeName: objectTypeName, type: { name: objectTypeName } });
            }
            return field;
        });
        return Object.assign({}, rootField, { fields });
    });
    const properties = propertiesFromFields(generator.context, fields);
    language_1.typeDeclaration(generator, {
        interfaceName },
    () => {
        propertyDeclarations(generator, properties);
    });
}
exports.typeDeclarationForOperation = typeDeclarationForOperation;
function typeDeclarationForFragment(generator, fragment) {
    const { fragmentName, typeCondition, fields, inlineFragments, fragmentSpreads, source } = fragment;
    const interfaceName = `${fragmentName}Fragment`;
    language_1.typeDeclaration(generator, {
        interfaceName,
        noBrackets: graphql_1.isAbstractType(typeCondition) },
    () => {
        if (graphql_1.isAbstractType(typeCondition)) {
            const propertySets = fragment.possibleTypes.
            map(type => {
                const inlineFragment = inlineFragments.find(inlineFragment => {
                    return inlineFragment.typeCondition.toString() == type;
                });
                if (inlineFragment) {
                    const fields = inlineFragment.fields.map(field => {
                        if (field.fieldName === '__typename') {
                            return Object.assign({}, field, { typeName: `"${inlineFragment.typeCondition}"`, type: { name: `"${inlineFragment.typeCondition}"` } });
                        } else
                        {
                            return field;
                        }
                    });
                    return propertiesFromFields(generator, fields);
                } else
                {
                    const fragmentFields = fields.map(field => {
                        if (field.fieldName === '__typename') {
                            return Object.assign({}, field, { typeName: `"${type}"`, type: { name: `"${type}"` } });
                        } else
                        {
                            return field;
                        }
                    });
                    return propertiesFromFields(generator, fragmentFields);
                }
            });
            language_1.propertySetsDeclaration(generator, fragment, propertySets, true);
        } else
        {
            const fragmentFields = fields.map(field => {
                if (field.fieldName === '__typename') {
                    return Object.assign({}, field, { typeName: `"${fragment.typeCondition}"`, type: { name: `"${fragment.typeCondition}"` } });
                } else
                {
                    return field;
                }
            });
            const properties = propertiesFromFields(generator.context, fragmentFields);
            propertyDeclarations(generator, properties);
        }
    });
}
exports.typeDeclarationForFragment = typeDeclarationForFragment;
function propertiesFromFields(context, fields) {
    return fields.map(field => propertyFromField(context, field));
}
exports.propertiesFromFields = propertiesFromFields;
function propertyFromField(context, field) {
    let { name: fieldName, type: fieldType, description, fragmentSpreads, inlineFragments } = field;
    fieldName = fieldName || field.responseName;
    const propertyName = fieldName;
    let property = { fieldName, fieldType, propertyName, description };
    let isNullable = true;
    if (fieldType instanceof graphql_1.GraphQLNonNull) {
        isNullable = false;
    }
    const namedType = graphql_1.getNamedType(fieldType);
    if (graphql_1.isCompositeType(namedType)) {
        const typeName = types_1.typeNameFromGraphQLType(context, fieldType);
        let isArray = false;
        let isArrayElementNullable = null;
        if (fieldType instanceof graphql_1.GraphQLList) {
            isArray = true;
            isArrayElementNullable = !(fieldType.ofType instanceof graphql_1.GraphQLNonNull);
        } else
        if (fieldType instanceof graphql_1.GraphQLNonNull && fieldType.ofType instanceof graphql_1.GraphQLList) {
            isArray = true;
            isArrayElementNullable = !(fieldType.ofType.ofType instanceof graphql_1.GraphQLNonNull);
        }
        return Object.assign({}, property, { typeName, fields: field.fields, isComposite: true, fragmentSpreads, inlineFragments, fieldType,
            isArray, isNullable, isArrayElementNullable });
    } else
    {
        if (field.fieldName === '__typename') {
            const typeName = types_1.typeNameFromGraphQLType(context, fieldType, null, false);
            return Object.assign({}, property, { typeName, isComposite: false, fieldType, isNullable: false });
        } else
        {
            const typeName = types_1.typeNameFromGraphQLType(context, fieldType, null, isNullable);
            return Object.assign({}, property, { typeName, isComposite: false, fieldType, isNullable });
        }
    }
}
exports.propertyFromField = propertyFromField;
function propertyDeclarations(generator, properties, isInput) {
    if (!properties)
    return;
    properties.forEach(property => {
        if (graphql_1.isAbstractType(graphql_1.getNamedType(property.type || property.fieldType))) {
            const propertySets = getPossibleTypeNames(generator, property).
            map(type => {
                const inlineFragment = property.inlineFragments.find(inlineFragment => {
                    return inlineFragment.typeCondition.toString() == type;
                });
                if (inlineFragment) {
                    const fields = inlineFragment.fields.map(field => {
                        if (field.fieldName === '__typename') {
                            return Object.assign({}, field, { typeName: `"${inlineFragment.typeCondition}"`, type: { name: `"${inlineFragment.typeCondition}"` } });
                        } else
                        {
                            return field;
                        }
                    });
                    return propertiesFromFields(generator, fields);
                } else
                {
                    const fields = property.fields.map(field => {
                        if (field.fieldName === '__typename') {
                            return Object.assign({}, field, { typeName: `"${type}"`, type: { name: `"${type}"` } });
                        } else
                        {
                            return field;
                        }
                    });
                    return propertiesFromFields(generator, fields);
                }
            });
            language_1.propertySetsDeclaration(generator, property, propertySets);
        } else
        {
            if (property.fields && property.fields.length > 0 ||
            property.inlineFragments && property.inlineFragments.length > 0 ||
            property.fragmentSpreads && property.fragmentSpreads.length > 0) {
                language_1.propertyDeclaration(generator, property, () => {
                    const properties = propertiesFromFields(generator.context, property.fields);
                    propertyDeclarations(generator, properties, isInput);
                });
            } else
            {
                language_1.propertyDeclaration(generator, Object.assign({}, property, { isInput }));
            }
        }
    });
}
exports.propertyDeclarations = propertyDeclarations;
function getPossibleTypeNames(generator, property) {
    return generator.context.schema.getPossibleTypes(graphql_1.getNamedType(property.fieldType || property.type)).map(type => type.name);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QTVDLENBQTFDLEVBQTZGLEdBQTdGLENBQWlHLFFBQVEsS0FBSyxJQUE5RyxDQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBHcmFwaFFMRXJyb3IsXG4gIGdldE5hbWVkVHlwZSxcbiAgaXNDb21wb3NpdGVUeXBlLFxuICBpc0Fic3RyYWN0VHlwZSxcbiAgaXNFcXVhbFR5cGUsXG4gIEdyYXBoUUxTY2FsYXJUeXBlLFxuICBHcmFwaFFMRW51bVR5cGUsXG4gIEdyYXBoUUxMaXN0LFxuICBHcmFwaFFMTm9uTnVsbCxcbiAgR3JhcGhRTElELFxuICBHcmFwaFFMSW5wdXRPYmplY3RUeXBlLFxuICBHcmFwaFFMT2JqZWN0VHlwZSxcbiAgR3JhcGhRTFVuaW9uVHlwZVxufSBmcm9tICdncmFwaHFsJ1xuXG5pbXBvcnQgIHsgaXNUeXBlUHJvcGVyU3VwZXJUeXBlT2YgfSBmcm9tICcuLi91dGlsaXRpZXMvZ3JhcGhxbCc7XG5cbmltcG9ydCAqIGFzIEluZmxlY3RvciBmcm9tICdpbmZsZWN0ZWQnO1xuXG5pbXBvcnQge1xuICBqb2luLFxuICB3cmFwLFxufSBmcm9tICcuLi91dGlsaXRpZXMvcHJpbnRpbmcnO1xuXG5pbXBvcnQgQ29kZUdlbmVyYXRvciBmcm9tICcuLi91dGlsaXRpZXMvQ29kZUdlbmVyYXRvcic7XG5cbmltcG9ydCB7XG4gIHR5cGVEZWNsYXJhdGlvbixcbiAgcHJvcGVydHlEZWNsYXJhdGlvbixcbiAgcHJvcGVydHlTZXRzRGVjbGFyYXRpb25cbn0gZnJvbSAnLi9sYW5ndWFnZSc7XG5cbmltcG9ydCB7XG4gIHR5cGVOYW1lRnJvbUdyYXBoUUxUeXBlLFxufSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlU291cmNlKGNvbnRleHQpIHtcbiAgY29uc3QgZ2VuZXJhdG9yID0gbmV3IENvZGVHZW5lcmF0b3IoY29udGV4dCk7XG5cbiAgZ2VuZXJhdG9yLnByaW50T25OZXdsaW5lKCcvKiBAZmxvdyAqLycpO1xuICBnZW5lcmF0b3IucHJpbnRPbk5ld2xpbmUoJy8qIGVzbGludC1kaXNhYmxlICovJyk7XG4gIGdlbmVyYXRvci5wcmludE9uTmV3bGluZSgnLy8gIFRoaXMgZmlsZSB3YXMgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgYW5kIHNob3VsZCBub3QgYmUgZWRpdGVkLicpO1xuICB0eXBlRGVjbGFyYXRpb25Gb3JHcmFwaFFMVHlwZShjb250ZXh0LnR5cGVzVXNlZC5mb3JFYWNoKHR5cGUgPT5cbiAgICB0eXBlRGVjbGFyYXRpb25Gb3JHcmFwaFFMVHlwZShnZW5lcmF0b3IsIHR5cGUpXG4gICkpO1xuICBPYmplY3QudmFsdWVzKGNvbnRleHQub3BlcmF0aW9ucykuZm9yRWFjaChvcGVyYXRpb24gPT4ge1xuICAgIGludGVyZmFjZVZhcmlhYmxlc0RlY2xhcmF0aW9uRm9yT3BlcmF0aW9uKGdlbmVyYXRvciwgb3BlcmF0aW9uKTtcbiAgICB0eXBlRGVjbGFyYXRpb25Gb3JPcGVyYXRpb24oZ2VuZXJhdG9yLCBvcGVyYXRpb24pO1xuICB9KTtcbiAgT2JqZWN0LnZhbHVlcyhjb250ZXh0LmZyYWdtZW50cykuZm9yRWFjaChmcmFnbWVudCA9PiB7XG4gICAgdHlwZURlY2xhcmF0aW9uRm9yRnJhZ21lbnQoZ2VuZXJhdG9yLCBmcmFnbWVudClcbiAgfSk7XG5cbiAgcmV0dXJuIGdlbmVyYXRvci5vdXRwdXQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0eXBlRGVjbGFyYXRpb25Gb3JHcmFwaFFMVHlwZShnZW5lcmF0b3IsIHR5cGUpIHtcbiAgaWYgKHR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMRW51bVR5cGUpIHtcbiAgICBlbnVtZXJhdGlvbkRlY2xhcmF0aW9uKGdlbmVyYXRvciwgdHlwZSk7XG4gIH0gZWxzZSBpZiAodHlwZSBpbnN0YW5jZW9mIEdyYXBoUUxJbnB1dE9iamVjdFR5cGUpIHtcbiAgICBzdHJ1Y3REZWNsYXJhdGlvbkZvcklucHV0T2JqZWN0VHlwZShnZW5lcmF0b3IsIHR5cGUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGVudW1lcmF0aW9uRGVjbGFyYXRpb24oZ2VuZXJhdG9yLCB0eXBlKSB7XG4gIGNvbnN0IHsgbmFtZSwgZGVzY3JpcHRpb24gfSA9IHR5cGU7XG4gIGNvbnN0IHZhbHVlcyA9IHR5cGUuZ2V0VmFsdWVzKCk7XG5cbiAgZ2VuZXJhdG9yLnByaW50TmV3bGluZUlmTmVlZGVkKCk7XG4gIGlmIChkZXNjcmlwdGlvbikge1xuICAgIGRlc2NyaXB0aW9uLnNwbGl0KCdcXG4nKVxuICAgICAgLmZvckVhY2gobGluZSA9PiB7XG4gICAgICAgIGdlbmVyYXRvci5wcmludE9uTmV3bGluZShgLy8gJHtsaW5lLnRyaW0oKX1gKTtcbiAgICAgIH0pXG4gIH1cbiAgZ2VuZXJhdG9yLnByaW50T25OZXdsaW5lKGBleHBvcnQgdHlwZSAke25hbWV9ID1gKTtcbiAgY29uc3QgblZhbHVlcyA9IHZhbHVlcy5sZW5ndGg7XG4gIHZhbHVlcy5mb3JFYWNoKCh2YWx1ZSwgaSkgPT4ge1xuICAgIGlmICghdmFsdWUuZGVzY3JpcHRpb24gfHwgdmFsdWUuZGVzY3JpcHRpb24uaW5kZXhPZignXFxuJykgPT09IC0xKSB7XG4gICAgICBnZW5lcmF0b3IucHJpbnRPbk5ld2xpbmUoYCAgXCIke3ZhbHVlLnZhbHVlfVwiJHtpID09PSBuVmFsdWVzIC0gMSA/ICc7JyA6ICcgfCd9JHt3cmFwKCcgLy8gJywgdmFsdWUuZGVzY3JpcHRpb24pfWApXG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh2YWx1ZS5kZXNjcmlwdGlvbikge1xuICAgICAgICB2YWx1ZS5kZXNjcmlwdGlvbi5zcGxpdCgnXFxuJylcbiAgICAgICAgICAuZm9yRWFjaChsaW5lID0+IHtcbiAgICAgICAgICAgIGdlbmVyYXRvci5wcmludE9uTmV3bGluZShgICAvLyAke2xpbmUudHJpbSgpfWApO1xuICAgICAgICAgIH0pXG4gICAgICB9XG4gICAgICBnZW5lcmF0b3IucHJpbnRPbk5ld2xpbmUoYCAgXCIke3ZhbHVlLnZhbHVlfVwiJHtpID09PSBuVmFsdWVzIC0gMSA/ICc7JyA6ICcgfCd9YClcbiAgICB9XG4gIH0pO1xuICBnZW5lcmF0b3IucHJpbnROZXdsaW5lKCk7XG59XG5cbmZ1bmN0aW9uIHN0cnVjdERlY2xhcmF0aW9uRm9ySW5wdXRPYmplY3RUeXBlKFxuICBnZW5lcmF0b3IsXG4gIHR5cGVcbikge1xuICBjb25zdCBpbnRlcmZhY2VOYW1lID0gdHlwZS5uYW1lO1xuICB0eXBlRGVjbGFyYXRpb24oZ2VuZXJhdG9yLCB7XG4gICAgaW50ZXJmYWNlTmFtZSxcbiAgfSwgKCkgPT4ge1xuICAgIGNvbnN0IHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhnZW5lcmF0b3IuY29udGV4dCwgT2JqZWN0LnZhbHVlcyh0eXBlLmdldEZpZWxkcygpKSk7XG4gICAgcHJvcGVydHlEZWNsYXJhdGlvbnMoZ2VuZXJhdG9yLCBwcm9wZXJ0aWVzLCB0cnVlKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGludGVyZmFjZU5hbWVGcm9tT3BlcmF0aW9uKHtvcGVyYXRpb25OYW1lLCBvcGVyYXRpb25UeXBlfSkge1xuICBzd2l0Y2ggKG9wZXJhdGlvblR5cGUpIHtcbiAgICBjYXNlICdxdWVyeSc6XG4gICAgICByZXR1cm4gYCR7b3BlcmF0aW9uTmFtZX1RdWVyeWA7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdtdXRhdGlvbic6XG4gICAgICByZXR1cm4gYCR7b3BlcmF0aW9uTmFtZX1NdXRhdGlvbmA7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdzdWJzY3JpcHRpb24nOlxuICAgICAgcmV0dXJuIGAke29wZXJhdGlvbk5hbWV9U3Vic2NyaXB0aW9uYDtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBuZXcgR3JhcGhRTEVycm9yKGBVbnN1cHBvcnRlZCBvcGVyYXRpb24gdHlwZSBcIiR7b3BlcmF0aW9uVHlwZX1cImApO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbnRlcmZhY2VWYXJpYWJsZXNEZWNsYXJhdGlvbkZvck9wZXJhdGlvbihcbiAgZ2VuZXJhdG9yLFxuICB7XG4gICAgb3BlcmF0aW9uTmFtZSxcbiAgICBvcGVyYXRpb25UeXBlLFxuICAgIHZhcmlhYmxlcyxcbiAgICBmaWVsZHMsXG4gICAgZnJhZ21lbnRzUmVmZXJlbmNlZCxcbiAgICBzb3VyY2UsXG4gIH1cbikge1xuICBpZiAoIXZhcmlhYmxlcyB8fCB2YXJpYWJsZXMubGVuZ3RoIDwgMSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGNvbnN0IGludGVyZmFjZU5hbWUgPSBgJHtpbnRlcmZhY2VOYW1lRnJvbU9wZXJhdGlvbih7b3BlcmF0aW9uTmFtZSwgb3BlcmF0aW9uVHlwZX0pfVZhcmlhYmxlc2A7XG5cbiAgdHlwZURlY2xhcmF0aW9uKGdlbmVyYXRvciwge1xuICAgIGludGVyZmFjZU5hbWUsXG4gIH0sICgpID0+IHtcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gcHJvcGVydGllc0Zyb21GaWVsZHMoZ2VuZXJhdG9yLmNvbnRleHQsIHZhcmlhYmxlcyk7XG4gICAgcHJvcGVydHlEZWNsYXJhdGlvbnMoZ2VuZXJhdG9yLCBwcm9wZXJ0aWVzLCB0cnVlKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldE9iamVjdFR5cGVOYW1lKHR5cGUpIHtcbiAgaWYgKHR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMTGlzdCkge1xuICAgIHJldHVybiBnZXRPYmplY3RUeXBlTmFtZSh0eXBlLm9mVHlwZSk7XG4gIH1cbiAgaWYgKHR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMTm9uTnVsbCkge1xuICAgIHJldHVybiBnZXRPYmplY3RUeXBlTmFtZSh0eXBlLm9mVHlwZSk7XG4gIH1cbiAgaWYgKHR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMT2JqZWN0VHlwZSkge1xuICAgIHJldHVybiBgXCIke3R5cGUubmFtZX1cImA7XG4gIH1cbiAgaWYgKHR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMVW5pb25UeXBlKSB7XG4gICAgcmV0dXJuIHR5cGUuZ2V0VHlwZXMoKS5tYXAodHlwZSA9PiBnZXRPYmplY3RUeXBlTmFtZSh0eXBlKSkuam9pbihcIiB8IFwiKTtcbiAgfVxuICByZXR1cm4gYFwiJHt0eXBlLm5hbWV9XCJgO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdHlwZURlY2xhcmF0aW9uRm9yT3BlcmF0aW9uKFxuICBnZW5lcmF0b3IsXG4gIHtcbiAgICBvcGVyYXRpb25OYW1lLFxuICAgIG9wZXJhdGlvblR5cGUsXG4gICAgdmFyaWFibGVzLFxuICAgIGZpZWxkcyxcbiAgICBmcmFnbWVudFNwcmVhZHMsXG4gICAgZnJhZ21lbnRzUmVmZXJlbmNlZCxcbiAgICBzb3VyY2UsXG4gIH1cbikge1xuICBjb25zdCBpbnRlcmZhY2VOYW1lID0gaW50ZXJmYWNlTmFtZUZyb21PcGVyYXRpb24oe29wZXJhdGlvbk5hbWUsIG9wZXJhdGlvblR5cGV9KTtcbiAgZmllbGRzID0gZmllbGRzLm1hcChyb290RmllbGQgPT4ge1xuICAgIGNvbnN0IGZpZWxkcyA9IHJvb3RGaWVsZC5maWVsZHMgJiYgcm9vdEZpZWxkLmZpZWxkcy5tYXAoZmllbGQgPT4ge1xuICAgICAgaWYgKGZpZWxkLmZpZWxkTmFtZSA9PT0gJ19fdHlwZW5hbWUnKSB7XG4gICAgICAgIGNvbnN0IG9iamVjdFR5cGVOYW1lID0gZ2V0T2JqZWN0VHlwZU5hbWUocm9vdEZpZWxkLnR5cGUpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLmZpZWxkLFxuICAgICAgICAgIHR5cGVOYW1lOiBvYmplY3RUeXBlTmFtZSxcbiAgICAgICAgICB0eXBlOiB7IG5hbWU6IG9iamVjdFR5cGVOYW1lIH0sXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4gZmllbGQ7XG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnJvb3RGaWVsZCxcbiAgICAgIGZpZWxkcyxcbiAgICB9O1xuICB9KTtcbiAgY29uc3QgcHJvcGVydGllcyA9IHByb3BlcnRpZXNGcm9tRmllbGRzKGdlbmVyYXRvci5jb250ZXh0LCBmaWVsZHMpO1xuICB0eXBlRGVjbGFyYXRpb24oZ2VuZXJhdG9yLCB7XG4gICAgaW50ZXJmYWNlTmFtZSxcbiAgfSwgKCkgPT4ge1xuICAgIHByb3BlcnR5RGVjbGFyYXRpb25zKGdlbmVyYXRvciwgcHJvcGVydGllcyk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdHlwZURlY2xhcmF0aW9uRm9yRnJhZ21lbnQoXG4gIGdlbmVyYXRvcixcbiAgZnJhZ21lbnRcbikge1xuICBjb25zdCB7XG4gICAgZnJhZ21lbnROYW1lLFxuICAgIHR5cGVDb25kaXRpb24sXG4gICAgZmllbGRzLFxuICAgIGlubGluZUZyYWdtZW50cyxcbiAgICBmcmFnbWVudFNwcmVhZHMsXG4gICAgc291cmNlLFxuICB9ID0gZnJhZ21lbnQ7XG5cbiAgY29uc3QgaW50ZXJmYWNlTmFtZSA9IGAke2ZyYWdtZW50TmFtZX1GcmFnbWVudGA7XG5cbiAgdHlwZURlY2xhcmF0aW9uKGdlbmVyYXRvciwge1xuICAgIGludGVyZmFjZU5hbWUsXG4gICAgbm9CcmFja2V0czogaXNBYnN0cmFjdFR5cGUodHlwZUNvbmRpdGlvbilcbiAgfSwgKCkgPT4ge1xuICAgIGlmIChpc0Fic3RyYWN0VHlwZSh0eXBlQ29uZGl0aW9uKSkge1xuICAgICAgY29uc3QgcHJvcGVydHlTZXRzID0gZnJhZ21lbnQucG9zc2libGVUeXBlc1xuICAgICAgICAubWFwKHR5cGUgPT4ge1xuICAgICAgICAgIC8vIE5PVEU6IGlubGluZUZyYWdtZW50IGN1cnJlbnRseSBjb25zaXN0cyBvZiB0aGUgbWVyZ2VkIGZpZWxkc1xuICAgICAgICAgIC8vIGZyb20gYm90aCBpbmxpbmUgZnJhZ21lbnRzIGFuZCBmcmFnbWVudCBzcHJlYWRzLlxuICAgICAgICAgIC8vIFRPRE86IFJlbmFtZSBpbmxpbmVGcmFnbWVudHMgaW4gdGhlIElSLlxuICAgICAgICAgIGNvbnN0IGlubGluZUZyYWdtZW50ID0gaW5saW5lRnJhZ21lbnRzLmZpbmQoaW5saW5lRnJhZ21lbnQgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGlubGluZUZyYWdtZW50LnR5cGVDb25kaXRpb24udG9TdHJpbmcoKSA9PSB0eXBlXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpZiAoaW5saW5lRnJhZ21lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IGlubGluZUZyYWdtZW50LmZpZWxkcy5tYXAoZmllbGQgPT4ge1xuICAgICAgICAgICAgICBpZiAoZmllbGQuZmllbGROYW1lID09PSAnX190eXBlbmFtZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgLi4uZmllbGQsXG4gICAgICAgICAgICAgICAgICB0eXBlTmFtZTogYFwiJHtpbmxpbmVGcmFnbWVudC50eXBlQ29uZGl0aW9ufVwiYCxcbiAgICAgICAgICAgICAgICAgIHR5cGU6IHsgbmFtZTogYFwiJHtpbmxpbmVGcmFnbWVudC50eXBlQ29uZGl0aW9ufVwiYCB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhnZW5lcmF0b3IsIGZpZWxkcyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGZyYWdtZW50RmllbGRzID0gZmllbGRzLm1hcChmaWVsZCA9PiB7XG4gICAgICAgICAgICAgIGlmIChmaWVsZC5maWVsZE5hbWUgPT09ICdfX3R5cGVuYW1lJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAuLi5maWVsZCxcbiAgICAgICAgICAgICAgICAgIHR5cGVOYW1lOiBgXCIke3R5cGV9XCJgLFxuICAgICAgICAgICAgICAgICAgdHlwZTogeyBuYW1lOiBgXCIke3R5cGV9XCJgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHByb3BlcnRpZXNGcm9tRmllbGRzKGdlbmVyYXRvciwgZnJhZ21lbnRGaWVsZHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgIHByb3BlcnR5U2V0c0RlY2xhcmF0aW9uKGdlbmVyYXRvciwgZnJhZ21lbnQsIHByb3BlcnR5U2V0cywgdHJ1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGZyYWdtZW50RmllbGRzID0gZmllbGRzLm1hcChmaWVsZCA9PiB7XG4gICAgICAgIGlmIChmaWVsZC5maWVsZE5hbWUgPT09ICdfX3R5cGVuYW1lJykge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5maWVsZCxcbiAgICAgICAgICAgIHR5cGVOYW1lOiBgXCIke2ZyYWdtZW50LnR5cGVDb25kaXRpb259XCJgLFxuICAgICAgICAgICAgdHlwZTogeyBuYW1lOiBgXCIke2ZyYWdtZW50LnR5cGVDb25kaXRpb259XCJgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGZpZWxkO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhnZW5lcmF0b3IuY29udGV4dCwgZnJhZ21lbnRGaWVsZHMpXG4gICAgICBwcm9wZXJ0eURlY2xhcmF0aW9ucyhnZW5lcmF0b3IsIHByb3BlcnRpZXMpO1xuICAgIH1cbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhjb250ZXh0LCBmaWVsZHMpIHtcbiAgcmV0dXJuIGZpZWxkcy5tYXAoZmllbGQgPT4gcHJvcGVydHlGcm9tRmllbGQoY29udGV4dCwgZmllbGQpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByb3BlcnR5RnJvbUZpZWxkKGNvbnRleHQsIGZpZWxkKSB7XG4gIGxldCB7IG5hbWU6IGZpZWxkTmFtZSwgdHlwZTogZmllbGRUeXBlLCBkZXNjcmlwdGlvbiwgZnJhZ21lbnRTcHJlYWRzLCBpbmxpbmVGcmFnbWVudHMgfSA9IGZpZWxkO1xuICBmaWVsZE5hbWUgPSBmaWVsZE5hbWUgfHwgZmllbGQucmVzcG9uc2VOYW1lO1xuXG4gIGNvbnN0IHByb3BlcnR5TmFtZSA9IGZpZWxkTmFtZTtcblxuICBsZXQgcHJvcGVydHkgPSB7IGZpZWxkTmFtZSwgZmllbGRUeXBlLCBwcm9wZXJ0eU5hbWUsIGRlc2NyaXB0aW9uIH07XG5cbiAgbGV0IGlzTnVsbGFibGUgPSB0cnVlO1xuICBpZiAoZmllbGRUeXBlIGluc3RhbmNlb2YgR3JhcGhRTE5vbk51bGwpIHtcbiAgICBpc051bGxhYmxlID0gZmFsc2U7XG4gIH1cbiAgY29uc3QgbmFtZWRUeXBlID0gZ2V0TmFtZWRUeXBlKGZpZWxkVHlwZSk7XG4gIGlmIChpc0NvbXBvc2l0ZVR5cGUobmFtZWRUeXBlKSkge1xuICAgIGNvbnN0IHR5cGVOYW1lID0gdHlwZU5hbWVGcm9tR3JhcGhRTFR5cGUoY29udGV4dCwgZmllbGRUeXBlKTtcbiAgICBsZXQgaXNBcnJheSA9IGZhbHNlO1xuICAgIGxldCBpc0FycmF5RWxlbWVudE51bGxhYmxlID0gbnVsbDtcbiAgICBpZiAoZmllbGRUeXBlIGluc3RhbmNlb2YgR3JhcGhRTExpc3QpIHtcbiAgICAgIGlzQXJyYXkgPSB0cnVlO1xuICAgICAgaXNBcnJheUVsZW1lbnROdWxsYWJsZSA9ICEoZmllbGRUeXBlLm9mVHlwZSBpbnN0YW5jZW9mIEdyYXBoUUxOb25OdWxsKTtcbiAgICB9IGVsc2UgaWYgKGZpZWxkVHlwZSBpbnN0YW5jZW9mIEdyYXBoUUxOb25OdWxsICYmIGZpZWxkVHlwZS5vZlR5cGUgaW5zdGFuY2VvZiBHcmFwaFFMTGlzdCkge1xuICAgICAgaXNBcnJheSA9IHRydWU7XG4gICAgICBpc0FycmF5RWxlbWVudE51bGxhYmxlID0gIShmaWVsZFR5cGUub2ZUeXBlLm9mVHlwZSBpbnN0YW5jZW9mIEdyYXBoUUxOb25OdWxsKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnByb3BlcnR5LFxuICAgICAgdHlwZU5hbWUsIGZpZWxkczogZmllbGQuZmllbGRzLCBpc0NvbXBvc2l0ZTogdHJ1ZSwgZnJhZ21lbnRTcHJlYWRzLCBpbmxpbmVGcmFnbWVudHMsIGZpZWxkVHlwZSxcbiAgICAgIGlzQXJyYXksIGlzTnVsbGFibGUsIGlzQXJyYXlFbGVtZW50TnVsbGFibGUsXG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICBpZiAoZmllbGQuZmllbGROYW1lID09PSAnX190eXBlbmFtZScpIHtcbiAgICAgIGNvbnN0IHR5cGVOYW1lID0gdHlwZU5hbWVGcm9tR3JhcGhRTFR5cGUoY29udGV4dCwgZmllbGRUeXBlLCBudWxsLCBmYWxzZSk7XG4gICAgICByZXR1cm4geyAuLi5wcm9wZXJ0eSwgdHlwZU5hbWUsIGlzQ29tcG9zaXRlOiBmYWxzZSwgZmllbGRUeXBlLCBpc051bGxhYmxlOiBmYWxzZSB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB0eXBlTmFtZSA9IHR5cGVOYW1lRnJvbUdyYXBoUUxUeXBlKGNvbnRleHQsIGZpZWxkVHlwZSwgbnVsbCwgaXNOdWxsYWJsZSk7XG4gICAgICByZXR1cm4geyAuLi5wcm9wZXJ0eSwgdHlwZU5hbWUsIGlzQ29tcG9zaXRlOiBmYWxzZSwgZmllbGRUeXBlLCBpc051bGxhYmxlIH07XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcm9wZXJ0eURlY2xhcmF0aW9ucyhnZW5lcmF0b3IsIHByb3BlcnRpZXMsIGlzSW5wdXQpIHtcbiAgaWYgKCFwcm9wZXJ0aWVzKSByZXR1cm47XG4gIHByb3BlcnRpZXMuZm9yRWFjaChwcm9wZXJ0eSA9PiB7XG4gICAgaWYgKGlzQWJzdHJhY3RUeXBlKGdldE5hbWVkVHlwZShwcm9wZXJ0eS50eXBlIHx8IHByb3BlcnR5LmZpZWxkVHlwZSkpKSB7XG4gICAgICBjb25zdCBwcm9wZXJ0eVNldHMgPSBnZXRQb3NzaWJsZVR5cGVOYW1lcyhnZW5lcmF0b3IsIHByb3BlcnR5KVxuICAgICAgICAubWFwKHR5cGUgPT4ge1xuICAgICAgICAgIGNvbnN0IGlubGluZUZyYWdtZW50ID0gcHJvcGVydHkuaW5saW5lRnJhZ21lbnRzLmZpbmQoaW5saW5lRnJhZ21lbnQgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGlubGluZUZyYWdtZW50LnR5cGVDb25kaXRpb24udG9TdHJpbmcoKSA9PSB0eXBlXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpZiAoaW5saW5lRnJhZ21lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IGlubGluZUZyYWdtZW50LmZpZWxkcy5tYXAoZmllbGQgPT4ge1xuICAgICAgICAgICAgICBpZiAoZmllbGQuZmllbGROYW1lID09PSAnX190eXBlbmFtZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgLi4uZmllbGQsXG4gICAgICAgICAgICAgICAgICB0eXBlTmFtZTogYFwiJHtpbmxpbmVGcmFnbWVudC50eXBlQ29uZGl0aW9ufVwiYCxcbiAgICAgICAgICAgICAgICAgIHR5cGU6IHsgbmFtZTogYFwiJHtpbmxpbmVGcmFnbWVudC50eXBlQ29uZGl0aW9ufVwiYCB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhnZW5lcmF0b3IsIGZpZWxkcyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IHByb3BlcnR5LmZpZWxkcy5tYXAoZmllbGQgPT4ge1xuICAgICAgICAgICAgICBpZiAoZmllbGQuZmllbGROYW1lID09PSAnX190eXBlbmFtZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgLi4uZmllbGQsXG4gICAgICAgICAgICAgICAgICB0eXBlTmFtZTogYFwiJHt0eXBlfVwiYCxcbiAgICAgICAgICAgICAgICAgIHR5cGU6IHsgbmFtZTogYFwiJHt0eXBlfVwiYCB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0aWVzRnJvbUZpZWxkcyhnZW5lcmF0b3IsIGZpZWxkcyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgcHJvcGVydHlTZXRzRGVjbGFyYXRpb24oZ2VuZXJhdG9yLCBwcm9wZXJ0eSwgcHJvcGVydHlTZXRzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHByb3BlcnR5LmZpZWxkcyAmJiBwcm9wZXJ0eS5maWVsZHMubGVuZ3RoID4gMFxuICAgICAgICB8fCBwcm9wZXJ0eS5pbmxpbmVGcmFnbWVudHMgJiYgcHJvcGVydHkuaW5saW5lRnJhZ21lbnRzLmxlbmd0aCA+IDBcbiAgICAgICAgfHwgcHJvcGVydHkuZnJhZ21lbnRTcHJlYWRzICYmIHByb3BlcnR5LmZyYWdtZW50U3ByZWFkcy5sZW5ndGggPiAwXG4gICAgICApIHtcbiAgICAgICAgcHJvcGVydHlEZWNsYXJhdGlvbihnZW5lcmF0b3IsIHByb3BlcnR5LCAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgcHJvcGVydGllcyA9IHByb3BlcnRpZXNGcm9tRmllbGRzKGdlbmVyYXRvci5jb250ZXh0LCBwcm9wZXJ0eS5maWVsZHMpO1xuICAgICAgICAgIHByb3BlcnR5RGVjbGFyYXRpb25zKGdlbmVyYXRvciwgcHJvcGVydGllcywgaXNJbnB1dCk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcHJvcGVydHlEZWNsYXJhdGlvbihnZW5lcmF0b3IsIHsuLi5wcm9wZXJ0eSwgaXNJbnB1dH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogVGhpcyBleGlzdHMgb25seSB0byBwcm9wZXJseSBnZW5lcmF0ZSB0eXBlcyBmb3IgdW5pb24vaW50ZXJmYWNlIHR5cGVkIGZpZWxkcyB0aGF0XG4gKiBkbyBub3QgaGF2ZSBpbmxpbmUgZnJhZ21lbnRzLiBUaGlzIGN1cnJlbnRseSBjYW4gaGFwcGVuIGFuZCB0aGUgSVIgZG9lcyBnaXZlIHVzXG4gKiBhIHNldCBvZiBmaWVsZHMgcGVyIHR5cGUgY29uZGl0aW9uIHVubGVzcyBmcmFnbWVudHMgYXJlIHVzZWQgd2l0aGluIHRoZSBzZWxlY3Rpb24gc2V0LlxuICovXG5mdW5jdGlvbiBnZXRQb3NzaWJsZVR5cGVOYW1lcyhnZW5lcmF0b3IsIHByb3BlcnR5KSB7XG4gIHJldHVybiBnZW5lcmF0b3IuY29udGV4dC5zY2hlbWEuZ2V0UG9zc2libGVUeXBlcyhnZXROYW1lZFR5cGUocHJvcGVydHkuZmllbGRUeXBlIHx8IHByb3BlcnR5LnR5cGUpKS5tYXAodHlwZSA9PiB0eXBlLm5hbWUpO1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==