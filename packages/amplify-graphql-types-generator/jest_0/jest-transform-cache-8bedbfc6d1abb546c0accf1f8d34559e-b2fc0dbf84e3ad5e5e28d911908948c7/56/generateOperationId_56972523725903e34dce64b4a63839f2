995b6b52fccaf77ee89179cd9007dde0
'use strict';require('ts-jest').install("/c/Users/Sandro/repo/amplify-cli/packages/amplify-graphql-types-generator/src/compiler/visitors/generateOperationId.ts", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst collectFragmentsReferenced_1 = require(\"./collectFragmentsReferenced\");\nconst crypto_1 = require(\"crypto\");\nfunction generateOperationId(operation, fragments, fragmentsReferenced) {\n    if (!fragmentsReferenced) {\n        fragmentsReferenced = collectFragmentsReferenced_1.collectFragmentsReferenced(operation.selectionSet, fragments);\n    }\n    const sourceWithFragments = [\n        operation.source,\n        ...Array.from(fragmentsReferenced).map(fragmentName => {\n            const fragment = fragments[fragmentName];\n            if (!fragment) {\n                throw new Error(`Cannot find fragment \"${fragmentName}\"`);\n            }\n            return fragment.source;\n        })\n    ].join('\\n');\n    const hash = crypto_1.createHash('sha256');\n    hash.update(sourceWithFragments);\n    const operationId = hash.digest('hex');\n    return { operationId, sourceWithFragments };\n}\nexports.generateOperationId = generateOperationId;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVPcGVyYXRpb25JZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImdlbmVyYXRlT3BlcmF0aW9uSWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSw2RUFBMEU7QUFDMUUsbUNBQW9DO0FBRXBDLDZCQUNFLFNBQW9CLEVBQ3BCLFNBQStDLEVBQy9DLG1CQUFzQztJQUV0QyxJQUFJLENBQUMsbUJBQW1CLEVBQUU7UUFDeEIsbUJBQW1CLEdBQUcsdURBQTBCLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRSxTQUFTLENBQUMsQ0FBQztLQUNyRjtJQUVELE1BQU0sbUJBQW1CLEdBQUc7UUFDMUIsU0FBUyxDQUFDLE1BQU07UUFDaEIsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxFQUFFO1lBQ3BELE1BQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUN6QyxJQUFJLENBQUMsUUFBUSxFQUFFO2dCQUNiLE1BQU0sSUFBSSxLQUFLLENBQUMseUJBQXlCLFlBQVksR0FBRyxDQUFDLENBQUM7YUFDM0Q7WUFDRCxPQUFPLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFDekIsQ0FBQyxDQUFDO0tBQ0gsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFYixNQUFNLElBQUksR0FBRyxtQkFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ2xDLElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsQ0FBQztJQUNqQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBRXZDLE9BQU8sRUFBRSxXQUFXLEVBQUUsbUJBQW1CLEVBQUUsQ0FBQztBQUM5QyxDQUFDO0FBekJELGtEQXlCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9wZXJhdGlvbiwgRnJhZ21lbnQgfSBmcm9tICcuLi8nO1xuaW1wb3J0IHsgY29sbGVjdEZyYWdtZW50c1JlZmVyZW5jZWQgfSBmcm9tICcuL2NvbGxlY3RGcmFnbWVudHNSZWZlcmVuY2VkJztcbmltcG9ydCB7IGNyZWF0ZUhhc2ggfSBmcm9tICdjcnlwdG8nO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVPcGVyYXRpb25JZChcbiAgb3BlcmF0aW9uOiBPcGVyYXRpb24sXG4gIGZyYWdtZW50czogeyBbZnJhZ21lbnROYW1lOiBzdHJpbmddOiBGcmFnbWVudCB9LFxuICBmcmFnbWVudHNSZWZlcmVuY2VkPzogSXRlcmFibGU8c3RyaW5nPlxuKSB7XG4gIGlmICghZnJhZ21lbnRzUmVmZXJlbmNlZCkge1xuICAgIGZyYWdtZW50c1JlZmVyZW5jZWQgPSBjb2xsZWN0RnJhZ21lbnRzUmVmZXJlbmNlZChvcGVyYXRpb24uc2VsZWN0aW9uU2V0LCBmcmFnbWVudHMpO1xuICB9XG5cbiAgY29uc3Qgc291cmNlV2l0aEZyYWdtZW50cyA9IFtcbiAgICBvcGVyYXRpb24uc291cmNlLFxuICAgIC4uLkFycmF5LmZyb20oZnJhZ21lbnRzUmVmZXJlbmNlZCkubWFwKGZyYWdtZW50TmFtZSA9PiB7XG4gICAgICBjb25zdCBmcmFnbWVudCA9IGZyYWdtZW50c1tmcmFnbWVudE5hbWVdO1xuICAgICAgaWYgKCFmcmFnbWVudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBmaW5kIGZyYWdtZW50IFwiJHtmcmFnbWVudE5hbWV9XCJgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmcmFnbWVudC5zb3VyY2U7XG4gICAgfSlcbiAgXS5qb2luKCdcXG4nKTtcblxuICBjb25zdCBoYXNoID0gY3JlYXRlSGFzaCgnc2hhMjU2Jyk7XG4gIGhhc2gudXBkYXRlKHNvdXJjZVdpdGhGcmFnbWVudHMpO1xuICBjb25zdCBvcGVyYXRpb25JZCA9IGhhc2guZGlnZXN0KCdoZXgnKTtcblxuICByZXR1cm4geyBvcGVyYXRpb25JZCwgc291cmNlV2l0aEZyYWdtZW50cyB9O1xufVxuIl19");"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const collectFragmentsReferenced_1 = require("./collectFragmentsReferenced");
const crypto_1 = require("crypto");
function generateOperationId(operation, fragments, fragmentsReferenced) {
    if (!fragmentsReferenced) {
        fragmentsReferenced = collectFragmentsReferenced_1.collectFragmentsReferenced(operation.selectionSet, fragments);
    }
    const sourceWithFragments = [
    operation.source,
    ...Array.from(fragmentsReferenced).map(fragmentName => {
        const fragment = fragments[fragmentName];
        if (!fragment) {
            throw new Error(`Cannot find fragment "${fragmentName}"`);
        }
        return fragment.source;
    })].
    join('\n');
    const hash = crypto_1.createHash('sha256');
    hash.update(sourceWithFragments);
    const operationId = hash.digest('hex');
    return { operationId, sourceWithFragments };
}
exports.generateOperationId = generateOperationId;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdlbmVyYXRlT3BlcmF0aW9uSWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSxNQUFBLCtCQUFBLFFBQUEsOEJBQUEsQ0FBQTtBQUNBLE1BQUEsV0FBQSxRQUFBLFFBQUEsQ0FBQTtBQUVBLFNBQUEsbUJBQUEsQ0FDRSxTQURGLEVBRUUsU0FGRixFQUdFLG1CQUhGLEVBR3dDO0FBRXRDLFFBQUksQ0FBQyxtQkFBTCxFQUEwQjtBQUN4Qiw4QkFBc0IsNkJBQUEsMEJBQUEsQ0FBMkIsVUFBVSxZQUFyQyxFQUFtRCxTQUFuRCxDQUF0QjtBQUNEO0FBRUQsVUFBTSxzQkFBc0I7QUFDMUIsY0FBVSxNQURnQjtBQUUxQixPQUFHLE1BQU0sSUFBTixDQUFXLG1CQUFYLEVBQWdDLEdBQWhDLENBQW9DLGdCQUFlO0FBQ3BELGNBQU0sV0FBVyxVQUFVLFlBQVYsQ0FBakI7QUFDQSxZQUFJLENBQUMsUUFBTCxFQUFlO0FBQ2Isa0JBQU0sSUFBSSxLQUFKLENBQVUseUJBQXlCLFlBQVksR0FBL0MsQ0FBTjtBQUNEO0FBQ0QsZUFBTyxTQUFTLE1BQWhCO0FBQ0QsS0FORSxDQUZ1QjtBQVMxQixRQVQwQixDQVNyQixJQVRxQixDQUE1QjtBQVdBLFVBQU0sT0FBTyxTQUFBLFVBQUEsQ0FBVyxRQUFYLENBQWI7QUFDQSxTQUFLLE1BQUwsQ0FBWSxtQkFBWjtBQUNBLFVBQU0sY0FBYyxLQUFLLE1BQUwsQ0FBWSxLQUFaLENBQXBCO0FBRUEsV0FBTyxFQUFFLFdBQUYsRUFBZSxtQkFBZixFQUFQO0FBQ0Q7QUF6QkQsUUFBQSxtQkFBQSxHQUFBLG1CQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT3BlcmF0aW9uLCBGcmFnbWVudCB9IGZyb20gJy4uLyc7XG5pbXBvcnQgeyBjb2xsZWN0RnJhZ21lbnRzUmVmZXJlbmNlZCB9IGZyb20gJy4vY29sbGVjdEZyYWdtZW50c1JlZmVyZW5jZWQnO1xuaW1wb3J0IHsgY3JlYXRlSGFzaCB9IGZyb20gJ2NyeXB0byc7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZU9wZXJhdGlvbklkKFxuICBvcGVyYXRpb246IE9wZXJhdGlvbixcbiAgZnJhZ21lbnRzOiB7IFtmcmFnbWVudE5hbWU6IHN0cmluZ106IEZyYWdtZW50IH0sXG4gIGZyYWdtZW50c1JlZmVyZW5jZWQ/OiBJdGVyYWJsZTxzdHJpbmc+XG4pIHtcbiAgaWYgKCFmcmFnbWVudHNSZWZlcmVuY2VkKSB7XG4gICAgZnJhZ21lbnRzUmVmZXJlbmNlZCA9IGNvbGxlY3RGcmFnbWVudHNSZWZlcmVuY2VkKG9wZXJhdGlvbi5zZWxlY3Rpb25TZXQsIGZyYWdtZW50cyk7XG4gIH1cblxuICBjb25zdCBzb3VyY2VXaXRoRnJhZ21lbnRzID0gW1xuICAgIG9wZXJhdGlvbi5zb3VyY2UsXG4gICAgLi4uQXJyYXkuZnJvbShmcmFnbWVudHNSZWZlcmVuY2VkKS5tYXAoZnJhZ21lbnROYW1lID0+IHtcbiAgICAgIGNvbnN0IGZyYWdtZW50ID0gZnJhZ21lbnRzW2ZyYWdtZW50TmFtZV07XG4gICAgICBpZiAoIWZyYWdtZW50KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGZpbmQgZnJhZ21lbnQgXCIke2ZyYWdtZW50TmFtZX1cImApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZyYWdtZW50LnNvdXJjZTtcbiAgICB9KVxuICBdLmpvaW4oJ1xcbicpO1xuXG4gIGNvbnN0IGhhc2ggPSBjcmVhdGVIYXNoKCdzaGEyNTYnKTtcbiAgaGFzaC51cGRhdGUoc291cmNlV2l0aEZyYWdtZW50cyk7XG4gIGNvbnN0IG9wZXJhdGlvbklkID0gaGFzaC5kaWdlc3QoJ2hleCcpO1xuXG4gIHJldHVybiB7IG9wZXJhdGlvbklkLCBzb3VyY2VXaXRoRnJhZ21lbnRzIH07XG59XG4iXSwic291cmNlUm9vdCI6IiJ9