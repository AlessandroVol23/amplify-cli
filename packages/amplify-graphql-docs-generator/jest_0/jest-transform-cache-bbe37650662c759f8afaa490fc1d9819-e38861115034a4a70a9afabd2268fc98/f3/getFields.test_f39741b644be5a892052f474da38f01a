dbdac7e1784bbce2ef5587c673ddca85
'use strict';require('ts-jest').install("/c/Users/Sandro/repo/amplify-cli/packages/amplify-graphql-docs-generator/__tests__/generator/getFields.test.ts", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst graphql_1 = require(\"graphql\");\nconst getFields_1 = require(\"../../src/generator/getFields\");\nconst getFragment_1 = require(\"../../src/generator/getFragment\");\njest.mock('../../src/generator/getFragment');\ndescribe('getField', () => {\n    const nestedType = new graphql_1.GraphQLObjectType({\n        name: 'NestedObject',\n        fields: () => ({\n            level: { type: graphql_1.GraphQLInt },\n            subObj: { type: nestedType },\n        }),\n    });\n    const schema = new graphql_1.GraphQLSchema({\n        query: new graphql_1.GraphQLObjectType({\n            name: 'Query',\n            fields: {\n                foo: { type: graphql_1.GraphQLInt },\n                nested: { type: nestedType },\n            },\n        }),\n    });\n    it('should support simple scalar', () => {\n        const queries = schema.getQueryType().getFields();\n        expect(getFields_1.default(queries.foo, schema, 3, { useExternalFragmentForS3Object: false })).toEqual({\n            name: 'foo',\n            fields: [],\n            fragments: [],\n            hasBody: false,\n        });\n        expect(getFragment_1.default).not.toHaveBeenCalled();\n    });\n    it('it should recursively resolve fields up to max depth', () => {\n        const queries = schema.getQueryType().getFields();\n        expect(getFields_1.default(queries.nested, schema, 2, { useExternalFragmentForS3Object: false })).toEqual({\n            name: 'nested',\n            fields: [\n                {\n                    name: 'level',\n                    fields: [],\n                    fragments: [],\n                    hasBody: false,\n                },\n                {\n                    name: 'subObj',\n                    fields: [\n                        {\n                            name: 'level',\n                            fields: [],\n                            fragments: [],\n                            hasBody: false,\n                        },\n                    ],\n                    fragments: [],\n                    hasBody: true,\n                },\n            ],\n            fragments: [],\n            hasBody: true,\n        });\n    });\n    it('should not return anything for complex type when the depth is < 1', () => {\n        const queries = schema.getQueryType().getFields();\n        expect(getFields_1.default(queries.nested, schema, 0, { useExternalFragmentForS3Object: false })).toBeUndefined();\n    });\n    describe('When type is an Interface', () => {\n        beforeEach(() => {\n            jest.resetAllMocks();\n        });\n        const shapeInterfaceType = new graphql_1.GraphQLInterfaceType({\n            name: 'Entity',\n            fields: {\n                name: { type: graphql_1.GraphQLString },\n            },\n        });\n        const rectangleType = new graphql_1.GraphQLObjectType({\n            name: 'Rectangle',\n            fields: {\n                name: { type: graphql_1.GraphQLString },\n                length: { type: graphql_1.GraphQLInt },\n                width: { type: graphql_1.GraphQLInt },\n            },\n            interfaces: () => [shapeInterfaceType],\n        });\n        const circleType = new graphql_1.GraphQLObjectType({\n            name: 'Circle',\n            fields: {\n                name: { type: graphql_1.GraphQLString },\n                radius: { type: graphql_1.GraphQLInt },\n            },\n            interfaces: () => [shapeInterfaceType],\n        });\n        const schema = new graphql_1.GraphQLSchema({\n            query: new graphql_1.GraphQLObjectType({\n                name: 'Query',\n                fields: {\n                    shapeInterface: { type: shapeInterfaceType },\n                },\n            }),\n            types: [circleType, rectangleType],\n        });\n        it('interface - should return fragments of all the implementations', () => {\n            const maxDepth = 2;\n            const getPossibleTypeSpy = jest.spyOn(schema, 'getPossibleTypes');\n            getFields_1.default(schema.getQueryType().getFields().shapeInterface, schema, maxDepth, { useExternalFragmentForS3Object: false });\n            expect(getPossibleTypeSpy).toHaveBeenCalled();\n            expect(getFragment_1.default).toHaveBeenCalled();\n            const commonField = {\n                name: 'name',\n                fragments: [],\n                hasBody: false,\n                fields: [],\n            };\n            expect(getFragment_1.default.mock.calls[0][0]).toEqual(circleType);\n            expect(getFragment_1.default.mock.calls[0][1]).toEqual(schema);\n            expect(getFragment_1.default.mock.calls[0][2]).toEqual(maxDepth);\n            expect(getFragment_1.default.mock.calls[0][3]).toEqual([commonField]);\n            expect(getFragment_1.default.mock.calls[1][0]).toEqual(rectangleType);\n            expect(getFragment_1.default.mock.calls[1][1]).toEqual(schema);\n            expect(getFragment_1.default.mock.calls[1][2]).toEqual(maxDepth);\n            expect(getFragment_1.default.mock.calls[1][3]).toEqual([commonField]);\n        });\n    });\n    describe('When type is an union', () => {\n        beforeEach(() => {\n            jest.resetAllMocks();\n        });\n        const rectangleType = new graphql_1.GraphQLObjectType({\n            name: 'Rectangle',\n            fields: {\n                length: { type: graphql_1.GraphQLInt },\n                width: { type: graphql_1.GraphQLInt },\n            },\n        });\n        const circleType = new graphql_1.GraphQLObjectType({\n            name: 'Circle',\n            fields: {\n                radius: { type: graphql_1.GraphQLInt },\n            },\n        });\n        const shapeResultUnion = new graphql_1.GraphQLUnionType({\n            name: 'ShapeResultUnion',\n            types: [circleType, rectangleType],\n        });\n        const schema = new graphql_1.GraphQLSchema({\n            query: new graphql_1.GraphQLObjectType({\n                name: 'Query',\n                fields: {\n                    shapeResult: { type: shapeResultUnion },\n                },\n            }),\n        });\n        it('union - should return fragments of all the types', () => {\n            const maxDepth = 2;\n            const getPossibleTypeSpy = jest.spyOn(schema, 'getPossibleTypes');\n            getFields_1.default(schema.getQueryType().getFields().shapeResult, schema, maxDepth, { useExternalFragmentForS3Object: false });\n            expect(getPossibleTypeSpy).toHaveBeenCalled();\n            expect(getFragment_1.default).toHaveBeenCalled();\n            const commonField = []; // unions don't have to have common field\n            expect(getFragment_1.default.mock.calls[0][0]).toEqual(circleType);\n            expect(getFragment_1.default.mock.calls[0][1]).toEqual(schema);\n            expect(getFragment_1.default.mock.calls[0][2]).toEqual(maxDepth);\n            expect(getFragment_1.default.mock.calls[0][3]).toEqual(commonField);\n            expect(getFragment_1.default.mock.calls[1][0]).toEqual(rectangleType);\n            expect(getFragment_1.default.mock.calls[1][1]).toEqual(schema);\n            expect(getFragment_1.default.mock.calls[1][2]).toEqual(maxDepth);\n            expect(getFragment_1.default.mock.calls[1][3]).toEqual(commonField);\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0RmllbGRzLnRlc3QuanMiLCJzb3VyY2VSb290IjoiL2MvVXNlcnMvU2FuZHJvL3JlcG8vYW1wbGlmeS1jbGkvcGFja2FnZXMvYW1wbGlmeS1ncmFwaHFsLWRvY3MtZ2VuZXJhdG9yL3NyYy8iLCJzb3VyY2VzIjpbImdldEZpZWxkcy50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEscUNBT2dCO0FBRWhCLDZEQUFxRDtBQUNyRCxpRUFBeUQ7QUFHekQsSUFBSSxDQUFDLElBQUksQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFBO0FBQzVDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFO0lBQ3hCLE1BQU0sVUFBVSxHQUFHLElBQUksMkJBQWlCLENBQUM7UUFDdkMsSUFBSSxFQUFFLGNBQWM7UUFDcEIsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDYixLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsb0JBQVUsRUFBRTtZQUMzQixNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFO1NBQzdCLENBQUM7S0FDSCxDQUFDLENBQUE7SUFFRixNQUFNLE1BQU0sR0FBRyxJQUFJLHVCQUFhLENBQUM7UUFDL0IsS0FBSyxFQUFFLElBQUksMkJBQWlCLENBQUM7WUFDM0IsSUFBSSxFQUFFLE9BQU87WUFDYixNQUFNLEVBQUU7Z0JBQ04sR0FBRyxFQUFFLEVBQUUsSUFBSSxFQUFFLG9CQUFVLEVBQUU7Z0JBQ3pCLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUU7YUFDN0I7U0FDRixDQUFDO0tBQ0gsQ0FBQyxDQUFBO0lBRUYsRUFBRSxDQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtRQUN0QyxNQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUMsU0FBUyxFQUFFLENBQUE7UUFDakQsTUFBTSxDQUFDLG1CQUFTLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUMs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QUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUMzRCxDQUFDLENBQUMsQ0FBQTtJQUNKLENBQUMsQ0FBQyxDQUFBO0FBQ0osQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBHcmFwaFFMU2NoZW1hLFxuICBHcmFwaFFMT2JqZWN0VHlwZSxcbiAgR3JhcGhRTFN0cmluZyxcbiAgR3JhcGhRTEludCxcbiAgR3JhcGhRTEludGVyZmFjZVR5cGUsXG4gIEdyYXBoUUxVbmlvblR5cGUsXG59IGZyb20gJ2dyYXBocWwnXG5cbmltcG9ydCBnZXRGaWVsZHMgZnJvbSAnLi4vLi4vc3JjL2dlbmVyYXRvci9nZXRGaWVsZHMnXG5pbXBvcnQgZ2V0RnJhZ21lbnQgZnJvbSAnLi4vLi4vc3JjL2dlbmVyYXRvci9nZXRGcmFnbWVudCdcbmltcG9ydCBnZXRUeXBlIGZyb20gJy4uLy4uL3NyYy9nZW5lcmF0b3IvdXRpbHMvZ2V0VHlwZSdcblxuamVzdC5tb2NrKCcuLi8uLi9zcmMvZ2VuZXJhdG9yL2dldEZyYWdtZW50JylcbmRlc2NyaWJlKCdnZXRGaWVsZCcsICgpID0+IHtcbiAgY29uc3QgbmVzdGVkVHlwZSA9IG5ldyBHcmFwaFFMT2JqZWN0VHlwZSh7XG4gICAgbmFtZTogJ05lc3RlZE9iamVjdCcsXG4gICAgZmllbGRzOiAoKSA9PiAoe1xuICAgICAgbGV2ZWw6IHsgdHlwZTogR3JhcGhRTEludCB9LFxuICAgICAgc3ViT2JqOiB7IHR5cGU6IG5lc3RlZFR5cGUgfSxcbiAgICB9KSxcbiAgfSlcblxuICBjb25zdCBzY2hlbWEgPSBuZXcgR3JhcGhRTFNjaGVtYSh7XG4gICAgcXVlcnk6IG5ldyBHcmFwaFFMT2JqZWN0VHlwZSh7XG4gICAgICBuYW1lOiAnUXVlcnknLFxuICAgICAgZmllbGRzOiB7XG4gICAgICAgIGZvbzogeyB0eXBlOiBHcmFwaFFMSW50IH0sXG4gICAgICAgIG5lc3RlZDogeyB0eXBlOiBuZXN0ZWRUeXBlIH0sXG4gICAgICB9LFxuICAgIH0pLFxuICB9KVxuXG4gIGl0KCdzaG91bGQgc3VwcG9ydCBzaW1wbGUgc2NhbGFyJywgKCkgPT4ge1xuICAgIGNvbnN0IHF1ZXJpZXMgPSBzY2hlbWEuZ2V0UXVlcnlUeXBlKCkuZ2V0RmllbGRzKClcbiAgICBleHBlY3QoZ2V0RmllbGRzKHF1ZXJpZXMuZm9vLCBzY2hlbWEsIDMsIHt1c2VFeHRlcm5hbEZyYWdtZW50Rm9yUzNPYmplY3Q6IGZhbHNlfSkpLnRvRXF1YWwoe1xuICAgICAgbmFtZTogJ2ZvbycsXG4gICAgICBmaWVsZHM6IFtdLFxuICAgICAgZnJhZ21lbnRzOiBbXSxcbiAgICAgIGhhc0JvZHk6IGZhbHNlLFxuICAgIH0pXG4gICAgZXhwZWN0KGdldEZyYWdtZW50KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpXG4gIH0pXG5cbiAgaXQoJ2l0IHNob3VsZCByZWN1cnNpdmVseSByZXNvbHZlIGZpZWxkcyB1cCB0byBtYXggZGVwdGgnLCAoKSA9PiB7XG4gICAgY29uc3QgcXVlcmllcyA9IHNjaGVtYS5nZXRRdWVyeVR5cGUoKS5nZXRGaWVsZHMoKVxuICAgIGV4cGVjdChnZXRGaWVsZHMocXVlcmllcy5uZXN0ZWQsIHNjaGVtYSwgMiwgeyB1c2VFeHRlcm5hbEZyYWdtZW50Rm9yUzNPYmplY3Q6IGZhbHNlfSkpLnRvRXF1YWwoe1xuICAgICAgbmFtZTogJ25lc3RlZCcsXG4gICAgICBmaWVsZHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdsZXZlbCcsXG4gICAgICAgICAgZmllbGRzOiBbXSxcbiAgICAgICAgICBmcmFnbWVudHM6IFtdLFxuICAgICAgICAgIGhhc0JvZHk6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ3N1Yk9iaicsXG4gICAgICAgICAgZmllbGRzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG5hbWU6ICdsZXZlbCcsXG4gICAgICAgICAgICAgIGZpZWxkczogW10sXG4gICAgICAgICAgICAgIGZyYWdtZW50czogW10sXG4gICAgICAgICAgICAgIGhhc0JvZHk6IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIGZyYWdtZW50czogW10sXG4gICAgICAgICAgaGFzQm9keTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBmcmFnbWVudHM6IFtdLFxuICAgICAgaGFzQm9keTogdHJ1ZSxcbiAgICB9KVxuICB9KVxuXG4gIGl0KCdzaG91bGQgbm90IHJldHVybiBhbnl0aGluZyBmb3IgY29tcGxleCB0eXBlIHdoZW4gdGhlIGRlcHRoIGlzIDwgMScsICgpID0+IHtcbiAgICBjb25zdCBxdWVyaWVzID0gc2NoZW1hLmdldFF1ZXJ5VHlwZSgpLmdldEZpZWxkcygpXG4gICAgZXhwZWN0KGdldEZpZWxkcyhxdWVyaWVzLm5lc3RlZCwgc2NoZW1hLCAwLCB7IHVzZUV4dGVybmFsRnJhZ21lbnRGb3JTM09iamVjdDogZmFsc2V9KSkudG9CZVVuZGVmaW5lZCgpXG4gIH0pXG4gIGRlc2NyaWJlKCdXaGVuIHR5cGUgaXMgYW4gSW50ZXJmYWNlJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgamVzdC5yZXNldEFsbE1vY2tzKClcbiAgICB9KVxuICAgIGNvbnN0IHNoYXBlSW50ZXJmYWNlVHlwZSA9IG5ldyBHcmFwaFFMSW50ZXJmYWNlVHlwZSh7XG4gICAgICBuYW1lOiAnRW50aXR5JyxcbiAgICAgIGZpZWxkczoge1xuICAgICAgICBuYW1lOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICAgIH0sXG4gICAgfSlcbiAgICBjb25zdCByZWN0YW5nbGVUeXBlID0gbmV3IEdyYXBoUUxPYmplY3RUeXBlKHtcbiAgICAgIG5hbWU6ICdSZWN0YW5nbGUnLFxuICAgICAgZmllbGRzOiB7XG4gICAgICAgIG5hbWU6IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgICAgICBsZW5ndGg6IHsgdHlwZTogR3JhcGhRTEludCB9LFxuICAgICAgICB3aWR0aDogeyB0eXBlOiBHcmFwaFFMSW50IH0sXG4gICAgICB9LFxuICAgICAgaW50ZXJmYWNlczogKCkgPT4gW3NoYXBlSW50ZXJmYWNlVHlwZV0sXG4gICAgfSlcblxuICAgIGNvbnN0IGNpcmNsZVR5cGUgPSBuZXcgR3JhcGhRTE9iamVjdFR5cGUoe1xuICAgICAgbmFtZTogJ0NpcmNsZScsXG4gICAgICBmaWVsZHM6IHtcbiAgICAgICAgbmFtZTogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgICAgIHJhZGl1czogeyB0eXBlOiBHcmFwaFFMSW50IH0sXG4gICAgICB9LFxuICAgICAgaW50ZXJmYWNlczogKCkgPT4gW3NoYXBlSW50ZXJmYWNlVHlwZV0sXG4gICAgfSlcblxuICAgIGNvbnN0IHNjaGVtYSA9IG5ldyBHcmFwaFFMU2NoZW1hKHtcbiAgICAgIHF1ZXJ5OiBuZXcgR3JhcGhRTE9iamVjdFR5cGUoe1xuICAgICAgICBuYW1lOiAnUXVlcnknLFxuICAgICAgICBmaWVsZHM6IHtcbiAgICAgICAgICBzaGFwZUludGVyZmFjZTogeyB0eXBlOiBzaGFwZUludGVyZmFjZVR5cGUgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgICAgdHlwZXM6IFtjaXJjbGVUeXBlLCByZWN0YW5nbGVUeXBlXSxcbiAgICB9KVxuXG4gICAgaXQoJ2ludGVyZmFjZSAtIHNob3VsZCByZXR1cm4gZnJhZ21lbnRzIG9mIGFsbCB0aGUgaW1wbGVtZW50YXRpb25zJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWF4RGVwdGggPSAyXG4gICAgICBjb25zdCBnZXRQb3NzaWJsZVR5cGVTcHkgPSBqZXN0LnNweU9uKHNjaGVtYSwgJ2dldFBvc3NpYmxlVHlwZXMnKVxuICAgICAgZ2V0RmllbGRzKHNjaGVtYS5nZXRRdWVyeVR5cGUoKS5nZXRGaWVsZHMoKS5zaGFwZUludGVyZmFjZSwgc2NoZW1hLCBtYXhEZXB0aCwgeyB1c2VFeHRlcm5hbEZyYWdtZW50Rm9yUzNPYmplY3Q6IGZhbHNlfSlcbiAgICAgIGV4cGVjdChnZXRQb3NzaWJsZVR5cGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWQoKVxuICAgICAgZXhwZWN0KGdldEZyYWdtZW50KS50b0hhdmVCZWVuQ2FsbGVkKClcblxuICAgICAgY29uc3QgY29tbW9uRmllbGQgPSB7XG4gICAgICAgIG5hbWU6ICduYW1lJyxcbiAgICAgICAgZnJhZ21lbnRzOiBbXSxcbiAgICAgICAgaGFzQm9keTogZmFsc2UsXG4gICAgICAgIGZpZWxkczogW10sXG4gICAgICB9XG5cbiAgICAgIGV4cGVjdChnZXRGcmFnbWVudC5tb2NrLmNhbGxzWzBdWzBdKS50b0VxdWFsKGNpcmNsZVR5cGUpXG4gICAgICBleHBlY3QoZ2V0RnJhZ21lbnQubW9jay5jYWxsc1swXVsxXSkudG9FcXVhbChzY2hlbWEpXG4gICAgICBleHBlY3QoZ2V0RnJhZ21lbnQubW9jay5jYWxsc1swXVsyXSkudG9FcXVhbChtYXhEZXB0aClcbiAgICAgIGV4cGVjdChnZXRGcmFnbWVudC5tb2NrLmNhbGxzWzBdWzNdKS50b0VxdWFsKFtjb21tb25GaWVsZF0pXG5cbiAgICAgIGV4cGVjdChnZXRGcmFnbWVudC5tb2NrLmNhbGxzWzFdWzBdKS50b0VxdWFsKHJlY3RhbmdsZVR5cGUpXG4gICAgICBleHBlY3QoZ2V0RnJhZ21lbnQubW9jay5jYWxsc1sxXVsxXSkudG9FcXVhbChzY2hlbWEpXG4gICAgICBleHBlY3QoZ2V0RnJhZ21lbnQubW9jay5jYWxsc1sxXVsyXSkudG9FcXVhbChtYXhEZXB0aClcbiAgICAgIGV4cGVjdChnZXRGcmFnbWVudC5tb2NrLmNhbGxzWzFdWzNdKS50b0VxdWFsKFtjb21tb25GaWVsZF0pXG4gICAgfSlcbiAgfSlcbiAgZGVzY3JpYmUoJ1doZW4gdHlwZSBpcyBhbiB1bmlvbicsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGplc3QucmVzZXRBbGxNb2NrcygpXG4gICAgfSlcbiAgICBjb25zdCByZWN0YW5nbGVUeXBlID0gbmV3IEdyYXBoUUxPYmplY3RUeXBlKHtcbiAgICAgIG5hbWU6ICdSZWN0YW5nbGUnLFxuICAgICAgZmllbGRzOiB7XG4gICAgICAgIGxlbmd0aDogeyB0eXBlOiBHcmFwaFFMSW50IH0sXG4gICAgICAgIHdpZHRoOiB7IHR5cGU6IEdyYXBoUUxJbnQgfSxcbiAgICAgIH0sXG4gICAgfSlcblxuICAgIGNvbnN0IGNpcmNsZVR5cGUgPSBuZXcgR3JhcGhRTE9iamVjdFR5cGUoe1xuICAgICAgbmFtZTogJ0NpcmNsZScsXG4gICAgICBmaWVsZHM6IHtcbiAgICAgICAgcmFkaXVzOiB7IHR5cGU6IEdyYXBoUUxJbnQgfSxcbiAgICAgIH0sXG4gICAgfSlcbiAgICBjb25zdCBzaGFwZVJlc3VsdFVuaW9uID0gbmV3IEdyYXBoUUxVbmlvblR5cGUoe1xuICAgICAgbmFtZTogJ1NoYXBlUmVzdWx0VW5pb24nLFxuICAgICAgdHlwZXM6IFtjaXJjbGVUeXBlLCByZWN0YW5nbGVUeXBlXSxcbiAgICB9KVxuXG4gICAgY29uc3Qgc2NoZW1hID0gbmV3IEdyYXBoUUxTY2hlbWEoe1xuICAgICAgcXVlcnk6IG5ldyBHcmFwaFFMT2JqZWN0VHlwZSh7XG4gICAgICAgIG5hbWU6ICdRdWVyeScsXG4gICAgICAgIGZpZWxkczoge1xuICAgICAgICAgIHNoYXBlUmVzdWx0OiB7IHR5cGU6IHNoYXBlUmVzdWx0VW5pb24gfSxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgIH0pXG5cbiAgICBpdCgndW5pb24gLSBzaG91bGQgcmV0dXJuIGZyYWdtZW50cyBvZiBhbGwgdGhlIHR5cGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWF4RGVwdGggPSAyXG4gICAgICBjb25zdCBnZXRQb3NzaWJsZVR5cGVTcHkgPSBqZXN0LnNweU9uKHNjaGVtYSwgJ2dldFBvc3NpYmxlVHlwZXMnKVxuICAgICAgZ2V0RmllbGRzKHNjaGVtYS5nZXRRdWVyeVR5cGUoKS5nZXRGaWVsZHMoKS5zaGFwZVJlc3VsdCwgc2NoZW1hLCBtYXhEZXB0aCwgeyB1c2VFeHRlcm5hbEZyYWdtZW50Rm9yUzNPYmplY3Q6IGZhbHNlfSlcbiAgICAgIGV4cGVjdChnZXRQb3NzaWJsZVR5cGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWQoKVxuICAgICAgZXhwZWN0KGdldEZyYWdtZW50KS50b0hhdmVCZWVuQ2FsbGVkKClcblxuICAgICAgY29uc3QgY29tbW9uRmllbGQgPSBbXSAvLyB1bmlvbnMgZG9uJ3QgaGF2ZSB0byBoYXZlIGNvbW1vbiBmaWVsZFxuXG4gICAgICBleHBlY3QoZ2V0RnJhZ21lbnQubW9jay5jYWxsc1swXVswXSkudG9FcXVhbChjaXJjbGVUeXBlKVxuICAgICAgZXhwZWN0KGdldEZyYWdtZW50Lm1vY2suY2FsbHNbMF1bMV0pLnRvRXF1YWwoc2NoZW1hKVxuICAgICAgZXhwZWN0KGdldEZyYWdtZW50Lm1vY2suY2FsbHNbMF1bMl0pLnRvRXF1YWwobWF4RGVwdGgpXG4gICAgICBleHBlY3QoZ2V0RnJhZ21lbnQubW9jay5jYWxsc1swXVszXSkudG9FcXVhbChjb21tb25GaWVsZClcblxuICAgICAgZXhwZWN0KGdldEZyYWdtZW50Lm1vY2suY2FsbHNbMV1bMF0pLnRvRXF1YWwocmVjdGFuZ2xlVHlwZSlcbiAgICAgIGV4cGVjdChnZXRGcmFnbWVudC5tb2NrLmNhbGxzWzFdWzFdKS50b0VxdWFsKHNjaGVtYSlcbiAgICAgIGV4cGVjdChnZXRGcmFnbWVudC5tb2NrLmNhbGxzWzFdWzJdKS50b0VxdWFsKG1heERlcHRoKVxuICAgICAgZXhwZWN0KGdldEZyYWdtZW50Lm1vY2suY2FsbHNbMV1bM10pLnRvRXF1YWwoY29tbW9uRmllbGQpXG4gICAgfSlcbiAgfSlcbn0pXG4iXX0=");"use strict";




jest.mock('../../src/generator/getFragment');Object.defineProperty(exports, "__esModule", { value: true });const graphql_1 = require("graphql");const getFields_1 = require("../../src/generator/getFields");const getFragment_1 = require("../../src/generator/getFragment");
describe('getField', () => {
    const nestedType = new graphql_1.GraphQLObjectType({
        name: 'NestedObject',
        fields: () => ({
            level: { type: graphql_1.GraphQLInt },
            subObj: { type: nestedType } }) });


    const schema = new graphql_1.GraphQLSchema({
        query: new graphql_1.GraphQLObjectType({
            name: 'Query',
            fields: {
                foo: { type: graphql_1.GraphQLInt },
                nested: { type: nestedType } } }) });



    it('should support simple scalar', () => {
        const queries = schema.getQueryType().getFields();
        expect(getFields_1.default(queries.foo, schema, 3, { useExternalFragmentForS3Object: false })).toEqual({
            name: 'foo',
            fields: [],
            fragments: [],
            hasBody: false });

        expect(getFragment_1.default).not.toHaveBeenCalled();
    });
    it('it should recursively resolve fields up to max depth', () => {
        const queries = schema.getQueryType().getFields();
        expect(getFields_1.default(queries.nested, schema, 2, { useExternalFragmentForS3Object: false })).toEqual({
            name: 'nested',
            fields: [
            {
                name: 'level',
                fields: [],
                fragments: [],
                hasBody: false },

            {
                name: 'subObj',
                fields: [
                {
                    name: 'level',
                    fields: [],
                    fragments: [],
                    hasBody: false }],


                fragments: [],
                hasBody: true }],


            fragments: [],
            hasBody: true });

    });
    it('should not return anything for complex type when the depth is < 1', () => {
        const queries = schema.getQueryType().getFields();
        expect(getFields_1.default(queries.nested, schema, 0, { useExternalFragmentForS3Object: false })).toBeUndefined();
    });
    describe('When type is an Interface', () => {
        beforeEach(() => {
            jest.resetAllMocks();
        });
        const shapeInterfaceType = new graphql_1.GraphQLInterfaceType({
            name: 'Entity',
            fields: {
                name: { type: graphql_1.GraphQLString } } });


        const rectangleType = new graphql_1.GraphQLObjectType({
            name: 'Rectangle',
            fields: {
                name: { type: graphql_1.GraphQLString },
                length: { type: graphql_1.GraphQLInt },
                width: { type: graphql_1.GraphQLInt } },

            interfaces: () => [shapeInterfaceType] });

        const circleType = new graphql_1.GraphQLObjectType({
            name: 'Circle',
            fields: {
                name: { type: graphql_1.GraphQLString },
                radius: { type: graphql_1.GraphQLInt } },

            interfaces: () => [shapeInterfaceType] });

        const schema = new graphql_1.GraphQLSchema({
            query: new graphql_1.GraphQLObjectType({
                name: 'Query',
                fields: {
                    shapeInterface: { type: shapeInterfaceType } } }),


            types: [circleType, rectangleType] });

        it('interface - should return fragments of all the implementations', () => {
            const maxDepth = 2;
            const getPossibleTypeSpy = jest.spyOn(schema, 'getPossibleTypes');
            getFields_1.default(schema.getQueryType().getFields().shapeInterface, schema, maxDepth, { useExternalFragmentForS3Object: false });
            expect(getPossibleTypeSpy).toHaveBeenCalled();
            expect(getFragment_1.default).toHaveBeenCalled();
            const commonField = {
                name: 'name',
                fragments: [],
                hasBody: false,
                fields: [] };

            expect(getFragment_1.default.mock.calls[0][0]).toEqual(circleType);
            expect(getFragment_1.default.mock.calls[0][1]).toEqual(schema);
            expect(getFragment_1.default.mock.calls[0][2]).toEqual(maxDepth);
            expect(getFragment_1.default.mock.calls[0][3]).toEqual([commonField]);
            expect(getFragment_1.default.mock.calls[1][0]).toEqual(rectangleType);
            expect(getFragment_1.default.mock.calls[1][1]).toEqual(schema);
            expect(getFragment_1.default.mock.calls[1][2]).toEqual(maxDepth);
            expect(getFragment_1.default.mock.calls[1][3]).toEqual([commonField]);
        });
    });
    describe('When type is an union', () => {
        beforeEach(() => {
            jest.resetAllMocks();
        });
        const rectangleType = new graphql_1.GraphQLObjectType({
            name: 'Rectangle',
            fields: {
                length: { type: graphql_1.GraphQLInt },
                width: { type: graphql_1.GraphQLInt } } });


        const circleType = new graphql_1.GraphQLObjectType({
            name: 'Circle',
            fields: {
                radius: { type: graphql_1.GraphQLInt } } });


        const shapeResultUnion = new graphql_1.GraphQLUnionType({
            name: 'ShapeResultUnion',
            types: [circleType, rectangleType] });

        const schema = new graphql_1.GraphQLSchema({
            query: new graphql_1.GraphQLObjectType({
                name: 'Query',
                fields: {
                    shapeResult: { type: shapeResultUnion } } }) });



        it('union - should return fragments of all the types', () => {
            const maxDepth = 2;
            const getPossibleTypeSpy = jest.spyOn(schema, 'getPossibleTypes');
            getFields_1.default(schema.getQueryType().getFields().shapeResult, schema, maxDepth, { useExternalFragmentForS3Object: false });
            expect(getPossibleTypeSpy).toHaveBeenCalled();
            expect(getFragment_1.default).toHaveBeenCalled();
            const commonField = []; // unions don't have to have common field
            expect(getFragment_1.default.mock.calls[0][0]).toEqual(circleType);
            expect(getFragment_1.default.mock.calls[0][1]).toEqual(schema);
            expect(getFragment_1.default.mock.calls[0][2]).toEqual(maxDepth);
            expect(getFragment_1.default.mock.calls[0][3]).toEqual(commonField);
            expect(getFragment_1.default.mock.calls[1][0]).toEqual(rectangleType);
            expect(getFragment_1.default.mock.calls[1][1]).toEqual(schema);
            expect(getFragment_1.default.mock.calls[1][2]).toEqual(maxDepth);
            expect(getFragment_1.default.mock.calls[1][3]).toEqual(commonField);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aFFMT2JqZWN0VHlwZSxcbiAgR3JhcGhRTFN0cmluZyxcbiAgR3JhcGhRTEludCxcbiAgR3JhcGhRTEludGVyZmFjZVR5cGUsXG4gIEdyYXBoUUxVbmlvblR5cGUsXG59IGZyb20gJ2dyYXBocWwnXG5cbmltcG9ydCBnZXRGaWVsZHMgZnJvbSAnLi4vLi4vc3JjL2dlbmVyYXRvci9nZXRGaWVsZHMnXG5pbXBvcnQgZ2V0RnJhZ21lbnQgZnJvbSAnLi4vLi4vc3JjL2dlbmVyYXRvci9nZXRGcmFnbWVudCdcbmltcG9ydCBnZXRUeXBlIGZyb20gJy4uLy4uL3NyYy9nZW5lcmF0b3IvdXRpbHMvZ2V0VHlwZSdcblxuamVzdC5tb2NrKCcuLi8uLi9zcmMvZ2VuZXJhdG9yL2dldEZyYWdtZW50JylcbmRlc2NyaWJlKCdnZXRGaWVsZCcsICgpID0+IHtcbiAgY29uc3QgbmVzdGVkVHlwZSA9IG5ldyBHcmFwaFFMT2JqZWN0VHlwZSh7XG4gICAgbmFtZTogJ05lc3RlZE9iamVjdCcsXG4gICAgZmllbGRzOiAoKSA9PiAoe1xuICAgICAgbGV2ZWw6IHsgdHlwZTogR3JhcGhRTEludCB9LFxuICAgICAgc3ViT2JqOiB7IHR5cGU6IG5lc3RlZFR5cGUgfSxcbiAgICB9KSxcbiAgfSlcblxuICBjb25zdCBzY2hlbWEgPSBuZXcgR3JhcGhRTFNjaGVtYSh7XG4gICAgcXVlcnk6IG5ldyBHcmFwaFFMT2JqZWN0VHlwZSh7XG4gICAgICBuYW1lOiAnUXVlcnknLFxuICAgICAgZmllbGRzOiB7XG4gICAgICAgIGZvbzogeyB0eXBlOiBHcmFwaFFMSW50IH0sXG4gICAgICAgIG5lc3RlZDogeyB0eXBlOiBuZXN0ZWRUeXBlIH0sXG4gICAgICB9LFxuICAgIH0pLFxuICB9KVxuXG4gIGl0KCdzaG91bGQgc3VwcG9ydCBzaW1wbGUgc2NhbGFyJywgKCkgPT4ge1xuICAgIGNvbnN0IHF1ZXJpZXMgPSBzY2hlbWEuZ2V0UXVlcnlUeXBlKCkuZ2V0RmllbGRzKClcbiAgICBleHBlY3QoZ2V0RmllbGRzKHF1ZXJpZXMuZm9vLCBzY2hlbWEsIDMsIHt1c2VFeHRlcm5hbEZyYWdtZW50Rm9yUzNPYmplY3Q6IGZhbHNlfSkpLnRvRXF1YWwoe1xuICAgICAgbmFtZTogJ2ZvbycsXG4gICAgICBmaWVsZHM6IFtdLFxuICAgICAgZnJhZ21lbnRzOiBbXSxcbiAgICAgIGhhc0JvZHk6IGZhbHNlLFxuICAgIH0pXG4gICAgZXhwZWN0KGdldEZyYWdtZW50KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpXG4gIH0pXG5cbiAgaXQoJ2l0IHNob3VsZCByZWN1cnNpdmVseSByZXNvbHZlIGZpZWxkcyB1cCB0byBtYXggZGVwdGgnLCAoKSA9PiB7XG4gICAgY29uc3QgcXVlcmllcyA9IHNjaGVtYS5nZXRRdWVyeVR5cGUoKS5nZXRGaWVsZHMoKVxuICAgIGV4cGVjdChnZXRGaWVsZHMocXVlcmllcy5uZXN0ZWQsIHNjaGVtYSwgMiwgeyB1c2VFeHRlcm5hbEZyYWdtZW50Rm9yUzNPYmplY3Q6IGZhbHNlfSkpLnRvRXF1YWwoe1xuICAgICAgbmFtZTogJ25lc3RlZCcsXG4gICAgICBmaWVsZHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdsZXZlbCcsXG4gICAgICAgICAgZmllbGRzOiBbXSxcbiAgICAgICAgICBmcmFnbWVudHM6IFtdLFxuICAgICAgICAgIGhhc0JvZHk6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ3N1Yk9iaicsXG4gICAgICAgICAgZmllbGRzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG5hbWU6ICdsZXZlbCcsXG4gICAgICAgICAgICAgIGZpZWxkczogW10sXG4gICAgICAgICAgICAgIGZyYWdtZW50czogW10sXG4gICAgICAgICAgICAgIGhhc0JvZHk6IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIGZyYWdtZW50czogW10sXG4gICAgICAgICAgaGFzQm9keTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBmcmFnbWVudHM6IFtdLFxuICAgICAgaGFzQm9keTogdHJ1ZSxcbiAgICB9KVxuICB9KVxuXG4gIGl0KCdzaG91bGQgbm90IHJldHVybiBhbnl0aGluZyBmb3IgY29tcGxleCB0eXBlIHdoZW4gdGhlIGRlcHRoIGlzIDwgMScsICgpID0+IHtcbiAgICBjb25zdCBxdWVyaWVzID0gc2NoZW1hLmdldFF1ZXJ5VHlwZSgpLmdldEZpZWxkcygpXG4gICAgZXhwZWN0KGdldEZpZWxkcyhxdWVyaWVzLm5lc3RlZCwgc2NoZW1hLCAwLCB7IHVzZUV4dGVybmFsRnJhZ21lbnRGb3JTM09iamVjdDogZmFsc2V9KSkudG9CZVVuZGVmaW5lZCgpXG4gIH0pXG4gIGRlc2NyaWJlKCdXaGVuIHR5cGUgaXMgYW4gSW50ZXJmYWNlJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgamVzdC5yZXNldEFsbE1vY2tzKClcbiAgICB9KVxuICAgIGNvbnN0IHNoYXBlSW50ZXJmYWNlVHlwZSA9IG5ldyBHcmFwaFFMSW50ZXJmYWNlVHlwZSh7XG4gICAgICBuYW1lOiAnRW50aXR5JyxcbiAgICAgIGZpZWxkczoge1xuICAgICAgICBuYW1lOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICAgIH0sXG4gICAgfSlcbiAgICBjb25zdCByZWN0YW5nbGVUeXBlID0gbmV3IEdyYXBoUUxPYmplY3RUeXBlKHtcbiAgICAgIG5hbWU6ICdSZWN0YW5nbGUnLFxuICAgICAgZmllbGRzOiB7XG4gICAgICAgIG5hbWU6IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgICAgICBsZW5ndGg6IHsgdHlwZTogR3JhcGhRTEludCB9LFxuICAgICAgICB3aWR0aDogeyB0eXBlOiBHcmFwaFFMSW50IH0sXG4gICAgICB9LFxuICAgICAgaW50ZXJmYWNlczogKCkgPT4gW3NoYXBlSW50ZXJmYWNlVHlwZV0sXG4gICAgfSlcblxuICAgIGNvbnN0IGNpcmNsZVR5cGUgPSBuZXcgR3JhcGhRTE9iamVjdFR5cGUoe1xuICAgICAgbmFtZTogJ0NpcmNsZScsXG4gICAgICBmaWVsZHM6IHtcbiAgICAgICAgbmFtZTogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgICAgIHJhZGl1czogeyB0eXBlOiBHcmFwaFFMSW50IH0sXG4gICAgICB9LFxuICAgICAgaW50ZXJmYWNlczogKCkgPT4gW3NoYXBlSW50ZXJmYWNlVHlwZV0sXG4gICAgfSlcblxuICAgIGNvbnN0IHNjaGVtYSA9IG5ldyBHcmFwaFFMU2NoZW1hKHtcbiAgICAgIHF1ZXJ5OiBuZXcgR3JhcGhRTE9iamVjdFR5cGUoe1xuICAgICAgICBuYW1lOiAnUXVlcnknLFxuICAgICAgICBmaWVsZHM6IHtcbiAgICAgICAgICBzaGFwZUludGVyZmFjZTogeyB0eXBlOiBzaGFwZUludGVyZmFjZVR5cGUgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgICAgdHlwZXM6IFtjaXJjbGVUeXBlLCByZWN0YW5nbGVUeXBlXSxcbiAgICB9KVxuXG4gICAgaXQoJ2ludGVyZmFjZSAtIHNob3VsZCByZXR1cm4gZnJhZ21lbnRzIG9mIGFsbCB0aGUgaW1wbGVtZW50YXRpb25zJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWF4RGVwdGggPSAyXG4gICAgICBjb25zdCBnZXRQb3NzaWJsZVR5cGVTcHkgPSBqZXN0LnNweU9uKHNjaGVtYSwgJ2dldFBvc3NpYmxlVHlwZXMnKVxuICAgICAgZ2V0RmllbGRzKHNjaGVtYS5nZXRRdWVyeVR5cGUoKS5nZXRGaWVsZHMoKS5zaGFwZUludGVyZmFjZSwgc2NoZW1hLCBtYXhEZXB0aCwgeyB1c2VFeHRlcm5hbEZyYWdtZW50Rm9yUzNPYmplY3Q6IGZhbHNlfSlcbiAgICAgIGV4cGVjdChnZXRQb3NzaWJsZVR5cGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWQoKVxuICAgICAgZXhwZWN0KGdldEZyYWdtZW50KS50b0hhdmVCZWVuQ2FsbGVkKClcblxuICAgICAgY29uc3QgY29tbW9uRmllbGQgPSB7XG4gICAgICAgIG5hbWU6ICduYW1lJyxcbiAgICAgICAgZnJhZ21lbnRzOiBbXSxcbiAgICAgICAgaGFzQm9keTogZmFsc2UsXG4gICAgICAgIGZpZWxkczogW10sXG4gICAgICB9XG5cbiAgICAgIGV4cGVjdChnZXRGcmFnbWVudC5tb2NrLmNhbGxzWzBdWzBdKS50b0VxdWFsKGNpcmNsZVR5cGUpXG4gICAgICBleHBlY3QoZ2V0RnJhZ21lbnQubW9jay5jYWxsc1swXVsxXSkudG9FcXVhbChzY2hlbWEpXG4gICAgICBleHBlY3QoZ2V0RnJhZ21lbnQubW9jay5jYWxsc1swXVsyXSkudG9FcXVhbChtYXhEZXB0aClcbiAgICAgIGV4cGVjdChnZXRGcmFnbWVudC5tb2NrLmNhbGxzWzBdWzNdKS50b0VxdWFsKFtjb21tb25GaWVsZF0pXG5cbiAgICAgIGV4cGVjdChnZXRGcmFnbWVudC5tb2NrLmNhbGxzWzFdWzBdKS50b0VxdWFsKHJlY3RhbmdsZVR5cGUpXG4gICAgICBleHBlY3QoZ2V0RnJhZ21lbnQubW9jay5jYWxsc1sxXVsxXSkudG9FcXVhbChzY2hlbWEpXG4gICAgICBleHBlY3QoZ2V0RnJhZ21lbnQubW9jay5jYWxsc1sxXVsyXSkudG9FcXVhbChtYXhEZXB0aClcbiAgICAgIGV4cGVjdChnZXRGcmFnbWVudC5tb2NrLmNhbGxzWzFdWzNdKS50b0VxdWFsKFtjb21tb25GaWVsZF0pXG4gICAgfSlcbiAgfSlcbiAgZGVzY3JpYmUoJ1doZW4gdHlwZSBpcyBhbiB1bmlvbicsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGplc3QucmVzZXRBbGxNb2NrcygpXG4gICAgfSlcbiAgICBjb25zdCByZWN0YW5nbGVUeXBlID0gbmV3IEdyYXBoUUxPYmplY3RUeXBlKHtcbiAgICAgIG5hbWU6ICdSZWN0YW5nbGUnLFxuICAgICAgZmllbGRzOiB7XG4gICAgICAgIGxlbmd0aDogeyB0eXBlOiBHcmFwaFFMSW50IH0sXG4gICAgICAgIHdpZHRoOiB7IHR5cGU6IEdyYXBoUUxJbnQgfSxcbiAgICAgIH0sXG4gICAgfSlcblxuICAgIGNvbnN0IGNpcmNsZVR5cGUgPSBuZXcgR3JhcGhRTE9iamVjdFR5cGUoe1xuICAgICAgbmFtZTogJ0NpcmNsZScsXG4gICAgICBmaWVsZHM6IHtcbiAgICAgICAgcmFkaXVzOiB7IHR5cGU6IEdyYXBoUUxJbnQgfSxcbiAgICAgIH0sXG4gICAgfSlcbiAgICBjb25zdCBzaGFwZVJlc3VsdFVuaW9uID0gbmV3IEdyYXBoUUxVbmlvblR5cGUoe1xuICAgICAgbmFtZTogJ1NoYXBlUmVzdWx0VW5pb24nLFxuICAgICAgdHlwZXM6IFtjaXJjbGVUeXBlLCByZWN0YW5nbGVUeXBlXSxcbiAgICB9KVxuXG4gICAgY29uc3Qgc2NoZW1hID0gbmV3IEdyYXBoUUxTY2hlbWEoe1xuICAgICAgcXVlcnk6IG5ldyBHcmFwaFFMT2JqZWN0VHlwZSh7XG4gICAgICAgIG5hbWU6ICdRdWVyeScsXG4gICAgICAgIGZpZWxkczoge1xuICAgICAgICAgIHNoYXBlUmVzdWx0OiB7IHR5cGU6IHNoYXBlUmVzdWx0VW5pb24gfSxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgIH0pXG5cbiAgICBpdCgndW5pb24gLSBzaG91bGQgcmV0dXJuIGZyYWdtZW50cyBvZiBhbGwgdGhlIHR5cGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWF4RGVwdGggPSAyXG4gICAgICBjb25zdCBnZXRQb3NzaWJsZVR5cGVTcHkgPSBqZXN0LnNweU9uKHNjaGVtYSwgJ2dldFBvc3NpYmxlVHlwZXMnKVxuICAgICAgZ2V0RmllbGRzKHNjaGVtYS5nZXRRdWVyeVR5cGUoKS5nZXRGaWVsZHMoKS5zaGFwZVJlc3VsdCwgc2NoZW1hLCBtYXhEZXB0aCwgeyB1c2VFeHRlcm5hbEZyYWdtZW50Rm9yUzNPYmplY3Q6IGZhbHNlfSlcbiAgICAgIGV4cGVjdChnZXRQb3NzaWJsZVR5cGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWQoKVxuICAgICAgZXhwZWN0KGdldEZyYWdtZW50KS50b0hhdmVCZWVuQ2FsbGVkKClcblxuICAgICAgY29uc3QgY29tbW9uRmllbGQgPSBbXSAvLyB1bmlvbnMgZG9uJ3QgaGF2ZSB0byBoYXZlIGNvbW1vbiBmaWVsZFxuXG4gICAgICBleHBlY3QoZ2V0RnJhZ21lbnQubW9jay5jYWxsc1swXVswXSkudG9FcXVhbChjaXJjbGVUeXBlKVxuICAgICAgZXhwZWN0KGdldEZyYWdtZW50Lm1vY2suY2FsbHNbMF1bMV0pLnRvRXF1YWwoc2NoZW1hKVxuICAgICAgZXhwZWN0KGdldEZyYWdtZW50Lm1vY2suY2FsbHNbMF1bMl0pLnRvRXF1YWwobWF4RGVwdGgpXG4gICAgICBleHBlY3QoZ2V0RnJhZ21lbnQubW9jay5jYWxsc1swXVszXSkudG9FcXVhbChjb21tb25GaWVsZClcblxuICAgICAgZXhwZWN0KGdldEZyYWdtZW50Lm1vY2suY2FsbHNbMV1bMF0pLnRvRXF1YWwocmVjdGFuZ2xlVHlwZSlcbiAgICAgIGV4cGVjdChnZXRGcmFnbWVudC5tb2NrLmNhbGxzWzFdWzFdKS50b0VxdWFsKHNjaGVtYSlcbiAgICAgIGV4cGVjdChnZXRGcmFnbWVudC5tb2NrLmNhbGxzWzFdWzJdKS50b0VxdWFsKG1heERlcHRoKVxuICAgICAgZXhwZWN0KGdldEZyYWdtZW50Lm1vY2suY2FsbHNbMV1bM10pLnRvRXF1YWwoY29tbW9uRmllbGQpXG4gICAgfSlcbiAgfSlcbn0pXG4iXSwic291cmNlUm9vdCI6Ii9jL1VzZXJzL1NhbmRyby9yZXBvL2FtcGxpZnktY2xpL3BhY2thZ2VzL2FtcGxpZnktZ3JhcGhxbC1kb2NzLWdlbmVyYXRvci9zcmMvIn0=