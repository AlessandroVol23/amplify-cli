5e40cd242eab92f12943881b3366aab9
'use strict';require('ts-jest').install("/c/Users/Sandro/repo/amplify-cli/packages/graphql-mapping-template/src/dynamodb.ts", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ast_1 = require(\"./ast\");\nvar DynamoDBMappingTemplate = /** @class */ (function () {\n    function DynamoDBMappingTemplate() {\n    }\n    /**\n     * Create a put item resolver template.\n     * @param keys A list of strings pointing to the key value locations. E.G. ctx.args.x (note no $)\n     */\n    DynamoDBMappingTemplate.putItem = function (_a) {\n        var key = _a.key, attributeValues = _a.attributeValues, condition = _a.condition;\n        return ast_1.obj({\n            version: ast_1.str('2017-02-28'),\n            operation: ast_1.str('PutItem'),\n            key: key,\n            attributeValues: attributeValues,\n            condition: condition\n        });\n    };\n    /**\n     * Create a get item resolver template.\n     * @param key A list of strings pointing to the key value locations. E.G. ctx.args.x (note no $)\n     */\n    DynamoDBMappingTemplate.getItem = function (_a) {\n        var key = _a.key;\n        return ast_1.obj({\n            version: ast_1.str('2017-02-28'),\n            operation: ast_1.str('GetItem'),\n            key: key\n        });\n    };\n    /**\n     * Create a query resolver template.\n     * @param key A list of strings pointing to the key value locations. E.G. ctx.args.x (note no $)\n     */\n    DynamoDBMappingTemplate.query = function (_a) {\n        var query = _a.query, filter = _a.filter, scanIndexForward = _a.scanIndexForward, limit = _a.limit, nextToken = _a.nextToken, index = _a.index;\n        return ast_1.obj({\n            version: ast_1.str('2017-02-28'),\n            operation: ast_1.str('Query'),\n            query: query,\n            scanIndexForward: scanIndexForward,\n            filter: filter,\n            limit: limit,\n            nextToken: nextToken,\n            index: index\n        });\n    };\n    /**\n     * Create a list item resolver template.\n     * @param key A list of strings pointing to the key value locations. E.G. ctx.args.x (note no $)\n     */\n    DynamoDBMappingTemplate.listItem = function (_a) {\n        var filter = _a.filter, limit = _a.limit, nextToken = _a.nextToken;\n        return ast_1.obj({\n            version: ast_1.str('2017-02-28'),\n            operation: ast_1.str('Scan'),\n            filter: filter,\n            limit: limit,\n            nextToken: nextToken\n        });\n    };\n    /**\n     * Create a delete item resolver template.\n     * @param key A list of strings pointing to the key value locations. E.G. ctx.args.x (note no $)\n     */\n    DynamoDBMappingTemplate.deleteItem = function (_a) {\n        var key = _a.key, condition = _a.condition;\n        return ast_1.obj({\n            version: ast_1.str('2017-02-28'),\n            operation: ast_1.str('DeleteItem'),\n            key: key,\n            condition: condition,\n        });\n    };\n    /**\n     * Create an update item resolver template.\n     * @param key\n     */\n    DynamoDBMappingTemplate.updateItem = function (_a) {\n        var key = _a.key, condition = _a.condition;\n        var keyNames = key.attributes.map(function (attr) { return attr[0]; });\n        // Auto timestamp\n        // qref('$input.put(\"updatedAt\", \"$util.time.nowISO8601()\")'),\n        return ast_1.compoundExpression([\n            ast_1.set(ast_1.ref('expNames'), ast_1.obj({})),\n            ast_1.set(ast_1.ref('expValues'), ast_1.obj({})),\n            ast_1.set(ast_1.ref('expSet'), ast_1.obj({})),\n            ast_1.set(ast_1.ref('expAdd'), ast_1.obj({})),\n            ast_1.set(ast_1.ref('expRemove'), ast_1.list([])),\n            ast_1.forEach(ast_1.ref('entry'), ast_1.ref(\"util.map.copyAndRemoveAllKeys($context.args.input, [\" + keyNames.map(function (k) { return \"\\\"\" + k + \"\\\"\"; }).join(', ') + \"]).entrySet()\"), [\n                ast_1.ifElse(ast_1.ref('util.isNull($entry.value)'), ast_1.compoundExpression([\n                    ast_1.set(ast_1.ref('discard'), ast_1.ref('expRemove.add(\"#$entry.key\")')),\n                    ast_1.qref('$expNames.put(\"#$entry.key\", \"$entry.key\")')\n                ]), ast_1.compoundExpression([\n                    ast_1.qref('$expSet.put(\"#$entry.key\", \":$entry.key\")'),\n                    ast_1.qref('$expNames.put(\"#$entry.key\", \"$entry.key\")'),\n                    ast_1.qref('$expValues.put(\":$entry.key\", $util.dynamodb.toDynamoDB($entry.value))')\n                ]))\n            ]),\n            ast_1.set(ast_1.ref('expression'), ast_1.str('')),\n            ast_1.iff(ast_1.raw('!$expSet.isEmpty()'), ast_1.compoundExpression([\n                ast_1.set(ast_1.ref('expression'), ast_1.str('SET')),\n                ast_1.forEach(ast_1.ref('entry'), ast_1.ref('expSet.entrySet()'), [\n                    ast_1.set(ast_1.ref('expression'), ast_1.str('$expression $entry.key = $entry.value')),\n                    ast_1.iff(ast_1.ref('foreach.hasNext()'), ast_1.set(ast_1.ref('expression'), ast_1.str('$expression,')))\n                ])\n            ])),\n            ast_1.iff(ast_1.raw('!$expAdd.isEmpty()'), ast_1.compoundExpression([\n                ast_1.set(ast_1.ref('expression'), ast_1.str('$expression ADD')),\n                ast_1.forEach(ast_1.ref('entry'), ast_1.ref('expAdd.entrySet()'), [\n                    ast_1.set(ast_1.ref('expression'), ast_1.str('$expression $entry.key $entry.value')),\n                    ast_1.iff(ast_1.ref('foreach.hasNext()'), ast_1.set(ast_1.ref('expression'), ast_1.str('$expression,')))\n                ])\n            ])),\n            ast_1.iff(ast_1.raw('!$expRemove.isEmpty()'), ast_1.compoundExpression([\n                ast_1.set(ast_1.ref('expression'), ast_1.str('$expression REMOVE')),\n                ast_1.forEach(ast_1.ref('entry'), ast_1.ref('expRemove'), [\n                    ast_1.set(ast_1.ref('expression'), ast_1.str('$expression $entry')),\n                    ast_1.iff(ast_1.ref('foreach.hasNext()'), ast_1.set(ast_1.ref('expression'), ast_1.str('$expression,')))\n                ])\n            ])),\n            ast_1.set(ast_1.ref('update'), ast_1.obj({})),\n            ast_1.qref('$update.put(\"expression\", \"$expression\")'),\n            ast_1.iff(ast_1.raw('!$expNames.isEmpty()'), ast_1.qref('$update.put(\"expressionNames\", $expNames)')),\n            ast_1.iff(ast_1.raw('!$expValues.isEmpty()'), ast_1.qref('$update.put(\"expressionValues\", $expValues)')),\n            ast_1.obj({\n                version: ast_1.str('2017-02-28'),\n                operation: ast_1.str('UpdateItem'),\n                key: key,\n                update: ast_1.ref('util.toJson($update)'),\n                condition: condition\n            })\n        ]);\n    };\n    DynamoDBMappingTemplate.stringAttributeValue = function (value) {\n        return {\n            kind: 'Object', attributes: [\n                ['S', { kind: 'Quotes', expr: value }]\n            ]\n        };\n    };\n    DynamoDBMappingTemplate.numericAttributeValue = function (value) {\n        return {\n            kind: 'Object', attributes: [\n                ['N', { kind: 'Quotes', expr: value }]\n            ]\n        };\n    };\n    DynamoDBMappingTemplate.binaryAttributeValue = function (value) {\n        return {\n            kind: 'Object', attributes: [\n                ['B', { kind: 'Quotes', expr: value }]\n            ]\n        };\n    };\n    DynamoDBMappingTemplate.paginatedResponse = function () {\n        return ast_1.obj({\n            items: ast_1.ref('util.toJson($ctx.result.items)'),\n            nextToken: ast_1.ref('util.toJson($util.defaultIfNullOrBlank($context.result.nextToken, null))')\n        });\n    };\n    return DynamoDBMappingTemplate;\n}());\nexports.DynamoDBMappingTemplate = DynamoDBMappingTemplate;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1vZGIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJkeW5hbW9kYi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDZCQUtlO0FBRWY7SUFBQTtJQXNNQSxDQUFDO0lBck1HOzs7T0FHRztJQUNXLCtCQUFPLEdBQXJCLFVBQXNCLEVBSXJCO1lBSnVCLFlBQUcsRUFBRSxvQ0FBZSxFQUFFLHdCQUFTO1FBS25ELE9BQU8sU0FBRyxDQUFDO1lBQ1AsT0FBTyxFQUFFLFNBQUcsQ0FBQyxZQUFZLENBQUM7WUFDMUIsU0FBUyxFQUFFLFNBQUcsQ0FBQyxTQUFTLENBQUM7WUFDekIsR0FBRyxLQUFBO1lBQ0gsZUFBZSxpQkFBQTtZQUNmLFNBQVMsV0FBQTtTQUNaLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFFRDs7O09BR0c7SUFDVywrQkFBTyxHQUFyQixVQUFzQixFQUVyQjtZQUZ1QixZQUFHO1FBR3ZCLE9BQU8sU0FBRyxDQUFDO1lBQ1AsT0FBTyxFQUFFLFNBQUcsQ0FBQyxZQUFZLENBQUM7WUFDMUIsU0FBUyxFQUFFLFNBQUcsQ0FBQyxTQUFTLENBQUM7WUFDekIsR0FBRyxLQUFBO1NBQ04sQ0FBQyxDQUFBO0lBQ04sQ0FBQztJQUVEOzs7T0FHRztJQUNXLDZCQUFLLEdBQW5CLFVBQW9CLEVBT25CO1lBUHFCLGdCQUFLLEVBQUUsa0JBQU0sRUFBRSxzQ0FBZ0IsRUFBRSxnQkFBSyxFQUFFLHdCQUFTLEVBQUUsZ0JBQUs7UUFRMUUsT0FBTyxTQUFHLENBQUM7WUFDUCxPQUFPLEVBQUUsU0FBRyxDQUFDLFlBQVksQ0FBQztZQUMxQixTQUFTLEVBQUUsU0FBRyxDQUFDLE9BQU8sQ0FBQztZQUN2QixLQUFLLE9BQUE7WUFDTCxnQkFBZ0Isa0JBQUE7WUFDaEIsTUFBTSxRQUFBO1lBQ04sS0FBSyxPQUFBO1lBQ0wsU0FBUyxXQUFBO1lBQ1QsS0FBSyxPQUFBO1NBQ1IsQ0FBQyxDQUFBO0lBQ04sQ0FBQztJQUVEOzs7T0FHRztJQUNXLGdDQUFR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LElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQzthQUN6QztTQUNKLENBQUM7SUFDTixDQUFDO0lBRWEseUNBQWlCLEdBQS9CO1FBQ0ksT0FBTyxTQUFHLENBQUM7WUFDUCxLQUFLLEVBQUUsU0FBRyxDQUFDLGdDQUFnQyxDQUFDO1lBQzVDLFNBQVMsRUFBRSxTQUFHLENBQUMsMEVBQTBFLENBQUM7U0FDN0YsQ0FBQyxDQUFBO0lBQ04sQ0FBQztJQUNMLDhCQUFDO0FBQUQsQ0FBQyxBQXRNRCxJQXNNQztBQXRNWSwwREFBdUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIG9iaiwgcmVmLCBFeHByZXNzaW9uLCBSZWZlcmVuY2VOb2RlLCBTdHJpbmdOb2RlLFxuICAgIEludE5vZGUsIEZsb2F0Tm9kZSwgc3RyLCBPYmplY3ROb2RlLCBjb21wb3VuZEV4cHJlc3Npb24sXG4gICAgc2V0LCBsaXN0LCBmb3JFYWNoLCBpZkVsc2UsIHFyZWYsIGlmZiwgcmF3LFxuICAgIENvbXBvdW5kRXhwcmVzc2lvbk5vZGVcbn0gZnJvbSAnLi9hc3QnO1xuXG5leHBvcnQgY2xhc3MgRHluYW1vREJNYXBwaW5nVGVtcGxhdGUge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIHB1dCBpdGVtIHJlc29sdmVyIHRlbXBsYXRlLlxuICAgICAqIEBwYXJhbSBrZXlzIEEgbGlzdCBvZiBzdHJpbmdzIHBvaW50aW5nIHRvIHRoZSBrZXkgdmFsdWUgbG9jYXRpb25zLiBFLkcuIGN0eC5hcmdzLnggKG5vdGUgbm8gJClcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHB1dEl0ZW0oeyBrZXksIGF0dHJpYnV0ZVZhbHVlcywgY29uZGl0aW9uIH06IHtcbiAgICAgICAga2V5OiBPYmplY3ROb2RlLFxuICAgICAgICBhdHRyaWJ1dGVWYWx1ZXM6IEV4cHJlc3Npb24sXG4gICAgICAgIGNvbmRpdGlvbj86IE9iamVjdE5vZGVcbiAgICB9KTogT2JqZWN0Tm9kZSB7XG4gICAgICAgIHJldHVybiBvYmooe1xuICAgICAgICAgICAgdmVyc2lvbjogc3RyKCcyMDE3LTAyLTI4JyksXG4gICAgICAgICAgICBvcGVyYXRpb246IHN0cignUHV0SXRlbScpLFxuICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgYXR0cmlidXRlVmFsdWVzLFxuICAgICAgICAgICAgY29uZGl0aW9uXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgZ2V0IGl0ZW0gcmVzb2x2ZXIgdGVtcGxhdGUuXG4gICAgICogQHBhcmFtIGtleSBBIGxpc3Qgb2Ygc3RyaW5ncyBwb2ludGluZyB0byB0aGUga2V5IHZhbHVlIGxvY2F0aW9ucy4gRS5HLiBjdHguYXJncy54IChub3RlIG5vICQpXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBnZXRJdGVtKHsga2V5IH06IHtcbiAgICAgICAga2V5OiBPYmplY3ROb2RlXG4gICAgfSk6IE9iamVjdE5vZGUge1xuICAgICAgICByZXR1cm4gb2JqKHtcbiAgICAgICAgICAgIHZlcnNpb246IHN0cignMjAxNy0wMi0yOCcpLFxuICAgICAgICAgICAgb3BlcmF0aW9uOiBzdHIoJ0dldEl0ZW0nKSxcbiAgICAgICAgICAgIGtleVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIHF1ZXJ5IHJlc29sdmVyIHRlbXBsYXRlLlxuICAgICAqIEBwYXJhbSBrZXkgQSBsaXN0IG9mIHN0cmluZ3MgcG9pbnRpbmcgdG8gdGhlIGtleSB2YWx1ZSBsb2NhdGlvbnMuIEUuRy4gY3R4LmFyZ3MueCAobm90ZSBubyAkKVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcXVlcnkoeyBxdWVyeSwgZmlsdGVyLCBzY2FuSW5kZXhGb3J3YXJkLCBsaW1pdCwgbmV4dFRva2VuLCBpbmRleCB9OiB7XG4gICAgICAgIHF1ZXJ5OiBPYmplY3ROb2RlO1xuICAgICAgICBzY2FuSW5kZXhGb3J3YXJkOiBFeHByZXNzaW9uO1xuICAgICAgICBmaWx0ZXI6IE9iamVjdE5vZGUgfCBFeHByZXNzaW9uO1xuICAgICAgICBsaW1pdDogRXhwcmVzc2lvbjtcbiAgICAgICAgbmV4dFRva2VuPzogRXhwcmVzc2lvbjtcbiAgICAgICAgaW5kZXg/OiBTdHJpbmdOb2RlO1xuICAgIH0pOiBPYmplY3ROb2RlIHtcbiAgICAgICAgcmV0dXJuIG9iaih7XG4gICAgICAgICAgICB2ZXJzaW9uOiBzdHIoJzIwMTctMDItMjgnKSxcbiAgICAgICAgICAgIG9wZXJhdGlvbjogc3RyKCdRdWVyeScpLFxuICAgICAgICAgICAgcXVlcnksXG4gICAgICAgICAgICBzY2FuSW5kZXhGb3J3YXJkLFxuICAgICAgICAgICAgZmlsdGVyLFxuICAgICAgICAgICAgbGltaXQsXG4gICAgICAgICAgICBuZXh0VG9rZW4sXG4gICAgICAgICAgICBpbmRleFxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIGxpc3QgaXRlbSByZXNvbHZlciB0ZW1wbGF0ZS5cbiAgICAgKiBAcGFyYW0ga2V5IEEgbGlzdCBvZiBzdHJpbmdzIHBvaW50aW5nIHRvIHRoZSBrZXkgdmFsdWUgbG9jYXRpb25zLiBFLkcuIGN0eC5hcmdzLnggKG5vdGUgbm8gJClcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGxpc3RJdGVtKHsgZmlsdGVyLCBsaW1pdCwgbmV4dFRva2VuIH06IHtcbiAgICAgICAgZmlsdGVyOiBPYmplY3ROb2RlIHwgRXhwcmVzc2lvbixcbiAgICAgICAgbGltaXQ6IEV4cHJlc3Npb24sXG4gICAgICAgIG5leHRUb2tlbj86IEV4cHJlc3Npb25cbiAgICB9KTogT2JqZWN0Tm9kZSB7XG4gICAgICAgIHJldHVybiBvYmooe1xuICAgICAgICAgICAgdmVyc2lvbjogc3RyKCcyMDE3LTAyLTI4JyksXG4gICAgICAgICAgICBvcGVyYXRpb246IHN0cignU2NhbicpLFxuICAgICAgICAgICAgZmlsdGVyLFxuICAgICAgICAgICAgbGltaXQsXG4gICAgICAgICAgICBuZXh0VG9rZW5cbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBkZWxldGUgaXRlbSByZXNvbHZlciB0ZW1wbGF0ZS5cbiAgICAgKiBAcGFyYW0ga2V5IEEgbGlzdCBvZiBzdHJpbmdzIHBvaW50aW5nIHRvIHRoZSBrZXkgdmFsdWUgbG9jYXRpb25zLiBFLkcuIGN0eC5hcmdzLnggKG5vdGUgbm8gJClcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGRlbGV0ZUl0ZW0oeyBrZXksIGNvbmRpdGlvbiB9OiB7XG4gICAgICAgIGtleTogT2JqZWN0Tm9kZSxcbiAgICAgICAgY29uZGl0aW9uOiBPYmplY3ROb2RlIHwgUmVmZXJlbmNlTm9kZVxuICAgIH0pOiBPYmplY3ROb2RlIHtcbiAgICAgICAgcmV0dXJuIG9iaih7XG4gICAgICAgICAgICB2ZXJzaW9uOiBzdHIoJzIwMTctMDItMjgnKSxcbiAgICAgICAgICAgIG9wZXJhdGlvbjogc3RyKCdEZWxldGVJdGVtJyksXG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICBjb25kaXRpb24sXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGFuIHVwZGF0ZSBpdGVtIHJlc29sdmVyIHRlbXBsYXRlLlxuICAgICAqIEBwYXJhbSBrZXlcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHVwZGF0ZUl0ZW0oeyBrZXksIGNvbmRpdGlvbiB9OiB7XG4gICAgICAgIGtleTogT2JqZWN0Tm9kZSxcbiAgICAgICAgY29uZGl0aW9uOiBPYmplY3ROb2RlIHwgUmVmZXJlbmNlTm9kZVxuICAgIH0pOiBDb21wb3VuZEV4cHJlc3Npb25Ob2RlIHtcbiAgICAgICAgY29uc3Qga2V5TmFtZXMgPSBrZXkuYXR0cmlidXRlcy5tYXAoKGF0dHI6IFtzdHJpbmcsIEV4cHJlc3Npb25dKSA9PiBhdHRyWzBdKVxuICAgICAgICAvLyBBdXRvIHRpbWVzdGFtcFxuICAgICAgICAvLyBxcmVmKCckaW5wdXQucHV0KFwidXBkYXRlZEF0XCIsIFwiJHV0aWwudGltZS5ub3dJU084NjAxKClcIiknKSxcbiAgICAgICAgcmV0dXJuIGNvbXBvdW5kRXhwcmVzc2lvbihbXG4gICAgICAgICAgICBzZXQocmVmKCdleHBOYW1lcycpLCBvYmooe30pKSxcbiAgICAgICAgICAgIHNldChyZWYoJ2V4cFZhbHVlcycpLCBvYmooe30pKSxcbiAgICAgICAgICAgIHNldChyZWYoJ2V4cFNldCcpLCBvYmooe30pKSxcbiAgICAgICAgICAgIHNldChyZWYoJ2V4cEFkZCcpLCBvYmooe30pKSxcbiAgICAgICAgICAgIHNldChyZWYoJ2V4cFJlbW92ZScpLCBsaXN0KFtdKSksXG4gICAgICAgICAgICBmb3JFYWNoKFxuICAgICAgICAgICAgICAgIHJlZignZW50cnknKSxcbiAgICAgICAgICAgICAgICByZWYoYHV0aWwubWFwLmNvcHlBbmRSZW1vdmVBbGxLZXlzKCRjb250ZXh0LmFyZ3MuaW5wdXQsIFske2tleU5hbWVzLm1hcChrID0+IGBcIiR7a31cImApLmpvaW4oJywgJyl9XSkuZW50cnlTZXQoKWApLFxuICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgaWZFbHNlKFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVmKCd1dGlsLmlzTnVsbCgkZW50cnkudmFsdWUpJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wb3VuZEV4cHJlc3Npb24oW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldChyZWYoJ2Rpc2NhcmQnKSwgcmVmKCdleHBSZW1vdmUuYWRkKFwiIyRlbnRyeS5rZXlcIiknKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXJlZignJGV4cE5hbWVzLnB1dChcIiMkZW50cnkua2V5XCIsIFwiJGVudHJ5LmtleVwiKScpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvdW5kRXhwcmVzc2lvbihbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXJlZignJGV4cFNldC5wdXQoXCIjJGVudHJ5LmtleVwiLCBcIjokZW50cnkua2V5XCIpJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXJlZignJGV4cE5hbWVzLnB1dChcIiMkZW50cnkua2V5XCIsIFwiJGVudHJ5LmtleVwiKScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFyZWYoJyRleHBWYWx1ZXMucHV0KFwiOiRlbnRyeS5rZXlcIiwgJHV0aWwuZHluYW1vZGIudG9EeW5hbW9EQigkZW50cnkudmFsdWUpKScpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHNldChyZWYoJ2V4cHJlc3Npb24nKSwgc3RyKCcnKSksXG4gICAgICAgICAgICBpZmYocmF3KCchJGV4cFNldC5pc0VtcHR5KCknKSwgY29tcG91bmRFeHByZXNzaW9uKFtcbiAgICAgICAgICAgICAgICBzZXQocmVmKCdleHByZXNzaW9uJyksIHN0cignU0VUJykpLFxuICAgICAgICAgICAgICAgIGZvckVhY2gocmVmKCdlbnRyeScpLCByZWYoJ2V4cFNldC5lbnRyeVNldCgpJyksIFtcbiAgICAgICAgICAgICAgICAgICAgc2V0KHJlZignZXhwcmVzc2lvbicpLCBzdHIoJyRleHByZXNzaW9uICRlbnRyeS5rZXkgPSAkZW50cnkudmFsdWUnKSksXG4gICAgICAgICAgICAgICAgICAgIGlmZihyZWYoJ2ZvcmVhY2guaGFzTmV4dCgpJyksIHNldChyZWYoJ2V4cHJlc3Npb24nKSwgc3RyKCckZXhwcmVzc2lvbiwnKSkpXG4gICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIF0pKSxcbiAgICAgICAgICAgIGlmZihyYXcoJyEkZXhwQWRkLmlzRW1wdHkoKScpLCBjb21wb3VuZEV4cHJlc3Npb24oW1xuICAgICAgICAgICAgICAgIHNldChyZWYoJ2V4cHJlc3Npb24nKSwgc3RyKCckZXhwcmVzc2lvbiBBREQnKSksXG4gICAgICAgICAgICAgICAgZm9yRWFjaChyZWYoJ2VudHJ5JyksIHJlZignZXhwQWRkLmVudHJ5U2V0KCknKSwgW1xuICAgICAgICAgICAgICAgICAgICBzZXQocmVmKCdleHByZXNzaW9uJyksIHN0cignJGV4cHJlc3Npb24gJGVudHJ5LmtleSAkZW50cnkudmFsdWUnKSksXG4gICAgICAgICAgICAgICAgICAgIGlmZihyZWYoJ2ZvcmVhY2guaGFzTmV4dCgpJyksIHNldChyZWYoJ2V4cHJlc3Npb24nKSwgc3RyKCckZXhwcmVzc2lvbiwnKSkpXG4gICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIF0pKSxcbiAgICAgICAgICAgIGlmZihyYXcoJyEkZXhwUmVtb3ZlLmlzRW1wdHkoKScpLCBjb21wb3VuZEV4cHJlc3Npb24oW1xuICAgICAgICAgICAgICAgIHNldChyZWYoJ2V4cHJlc3Npb24nKSwgc3RyKCckZXhwcmVzc2lvbiBSRU1PVkUnKSksXG4gICAgICAgICAgICAgICAgZm9yRWFjaChyZWYoJ2VudHJ5JyksIHJlZignZXhwUmVtb3ZlJyksIFtcbiAgICAgICAgICAgICAgICAgICAgc2V0KHJlZignZXhwcmVzc2lvbicpLCBzdHIoJyRleHByZXNzaW9uICRlbnRyeScpKSxcbiAgICAgICAgICAgICAgICAgICAgaWZmKHJlZignZm9yZWFjaC5oYXNOZXh0KCknKSwgc2V0KHJlZignZXhwcmVzc2lvbicpLCBzdHIoJyRleHByZXNzaW9uLCcpKSlcbiAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgXSkpLFxuICAgICAgICAgICAgc2V0KHJlZigndXBkYXRlJyksIG9iaih7fSkpLFxuICAgICAgICAgICAgcXJlZignJHVwZGF0ZS5wdXQoXCJleHByZXNzaW9uXCIsIFwiJGV4cHJlc3Npb25cIiknKSxcbiAgICAgICAgICAgIGlmZihcbiAgICAgICAgICAgICAgICByYXcoJyEkZXhwTmFtZXMuaXNFbXB0eSgpJyksXG4gICAgICAgICAgICAgICAgcXJlZignJHVwZGF0ZS5wdXQoXCJleHByZXNzaW9uTmFtZXNcIiwgJGV4cE5hbWVzKScpXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgaWZmKFxuICAgICAgICAgICAgICAgIHJhdygnISRleHBWYWx1ZXMuaXNFbXB0eSgpJyksXG4gICAgICAgICAgICAgICAgcXJlZignJHVwZGF0ZS5wdXQoXCJleHByZXNzaW9uVmFsdWVzXCIsICRleHBWYWx1ZXMpJylcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBvYmooe1xuICAgICAgICAgICAgICAgIHZlcnNpb246IHN0cignMjAxNy0wMi0yOCcpLFxuICAgICAgICAgICAgICAgIG9wZXJhdGlvbjogc3RyKCdVcGRhdGVJdGVtJyksXG4gICAgICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgICAgIHVwZGF0ZTogcmVmKCd1dGlsLnRvSnNvbigkdXBkYXRlKScpLFxuICAgICAgICAgICAgICAgIGNvbmRpdGlvblxuICAgICAgICAgICAgfSlcbiAgICAgICAgXSlcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIHN0cmluZ0F0dHJpYnV0ZVZhbHVlKHZhbHVlOiBFeHByZXNzaW9uKTogT2JqZWN0Tm9kZSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBraW5kOiAnT2JqZWN0JywgYXR0cmlidXRlczogW1xuICAgICAgICAgICAgICAgIFsnUycsIHsga2luZDogJ1F1b3RlcycsIGV4cHI6IHZhbHVlIH1dXG4gICAgICAgICAgICBdXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBudW1lcmljQXR0cmlidXRlVmFsdWUodmFsdWU6IEV4cHJlc3Npb24pOiBPYmplY3ROb2RlIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGtpbmQ6ICdPYmplY3QnLCBhdHRyaWJ1dGVzOiBbXG4gICAgICAgICAgICAgICAgWydOJywgeyBraW5kOiAnUXVvdGVzJywgZXhwcjogdmFsdWUgfV1cbiAgICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGJpbmFyeUF0dHJpYnV0ZVZhbHVlKHZhbHVlOiBFeHByZXNzaW9uKTogT2JqZWN0Tm9kZSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBraW5kOiAnT2JqZWN0JywgYXR0cmlidXRlczogW1xuICAgICAgICAgICAgICAgIFsnQicsIHsga2luZDogJ1F1b3RlcycsIGV4cHI6IHZhbHVlIH1dXG4gICAgICAgICAgICBdXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBwYWdpbmF0ZWRSZXNwb25zZSgpOiBPYmplY3ROb2RlIHtcbiAgICAgICAgcmV0dXJuIG9iaih7XG4gICAgICAgICAgICBpdGVtczogcmVmKCd1dGlsLnRvSnNvbigkY3R4LnJlc3VsdC5pdGVtcyknKSxcbiAgICAgICAgICAgIG5leHRUb2tlbjogcmVmKCd1dGlsLnRvSnNvbigkdXRpbC5kZWZhdWx0SWZOdWxsT3JCbGFuaygkY29udGV4dC5yZXN1bHQubmV4dFRva2VuLCBudWxsKSknKVxuICAgICAgICB9KVxuICAgIH1cbn1cbiJdfQ==");"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var ast_1 = require("./ast");
var DynamoDBMappingTemplate = /** @class */function () {
    function DynamoDBMappingTemplate() {
    }
    /**
       * Create a put item resolver template.
       * @param keys A list of strings pointing to the key value locations. E.G. ctx.args.x (note no $)
       */
    DynamoDBMappingTemplate.putItem = function (_a) {
        var key = _a.key,attributeValues = _a.attributeValues,condition = _a.condition;
        return ast_1.obj({
            version: ast_1.str('2017-02-28'),
            operation: ast_1.str('PutItem'),
            key: key,
            attributeValues: attributeValues,
            condition: condition });

    };
    /**
        * Create a get item resolver template.
        * @param key A list of strings pointing to the key value locations. E.G. ctx.args.x (note no $)
        */
    DynamoDBMappingTemplate.getItem = function (_a) {
        var key = _a.key;
        return ast_1.obj({
            version: ast_1.str('2017-02-28'),
            operation: ast_1.str('GetItem'),
            key: key });

    };
    /**
        * Create a query resolver template.
        * @param key A list of strings pointing to the key value locations. E.G. ctx.args.x (note no $)
        */
    DynamoDBMappingTemplate.query = function (_a) {
        var query = _a.query,filter = _a.filter,scanIndexForward = _a.scanIndexForward,limit = _a.limit,nextToken = _a.nextToken,index = _a.index;
        return ast_1.obj({
            version: ast_1.str('2017-02-28'),
            operation: ast_1.str('Query'),
            query: query,
            scanIndexForward: scanIndexForward,
            filter: filter,
            limit: limit,
            nextToken: nextToken,
            index: index });

    };
    /**
        * Create a list item resolver template.
        * @param key A list of strings pointing to the key value locations. E.G. ctx.args.x (note no $)
        */
    DynamoDBMappingTemplate.listItem = function (_a) {
        var filter = _a.filter,limit = _a.limit,nextToken = _a.nextToken;
        return ast_1.obj({
            version: ast_1.str('2017-02-28'),
            operation: ast_1.str('Scan'),
            filter: filter,
            limit: limit,
            nextToken: nextToken });

    };
    /**
        * Create a delete item resolver template.
        * @param key A list of strings pointing to the key value locations. E.G. ctx.args.x (note no $)
        */
    DynamoDBMappingTemplate.deleteItem = function (_a) {
        var key = _a.key,condition = _a.condition;
        return ast_1.obj({
            version: ast_1.str('2017-02-28'),
            operation: ast_1.str('DeleteItem'),
            key: key,
            condition: condition });

    };
    /**
        * Create an update item resolver template.
        * @param key
        */
    DynamoDBMappingTemplate.updateItem = function (_a) {
        var key = _a.key,condition = _a.condition;
        var keyNames = key.attributes.map(function (attr) {return attr[0];});
        // Auto timestamp
        // qref('$input.put("updatedAt", "$util.time.nowISO8601()")'),
        return ast_1.compoundExpression([
        ast_1.set(ast_1.ref('expNames'), ast_1.obj({})),
        ast_1.set(ast_1.ref('expValues'), ast_1.obj({})),
        ast_1.set(ast_1.ref('expSet'), ast_1.obj({})),
        ast_1.set(ast_1.ref('expAdd'), ast_1.obj({})),
        ast_1.set(ast_1.ref('expRemove'), ast_1.list([])),
        ast_1.forEach(ast_1.ref('entry'), ast_1.ref("util.map.copyAndRemoveAllKeys($context.args.input, [" + keyNames.map(function (k) {return "\"" + k + "\"";}).join(', ') + "]).entrySet()"), [
        ast_1.ifElse(ast_1.ref('util.isNull($entry.value)'), ast_1.compoundExpression([
        ast_1.set(ast_1.ref('discard'), ast_1.ref('expRemove.add("#$entry.key")')),
        ast_1.qref('$expNames.put("#$entry.key", "$entry.key")')]),
        ast_1.compoundExpression([
        ast_1.qref('$expSet.put("#$entry.key", ":$entry.key")'),
        ast_1.qref('$expNames.put("#$entry.key", "$entry.key")'),
        ast_1.qref('$expValues.put(":$entry.key", $util.dynamodb.toDynamoDB($entry.value))')]))]),


        ast_1.set(ast_1.ref('expression'), ast_1.str('')),
        ast_1.iff(ast_1.raw('!$expSet.isEmpty()'), ast_1.compoundExpression([
        ast_1.set(ast_1.ref('expression'), ast_1.str('SET')),
        ast_1.forEach(ast_1.ref('entry'), ast_1.ref('expSet.entrySet()'), [
        ast_1.set(ast_1.ref('expression'), ast_1.str('$expression $entry.key = $entry.value')),
        ast_1.iff(ast_1.ref('foreach.hasNext()'), ast_1.set(ast_1.ref('expression'), ast_1.str('$expression,')))])])),


        ast_1.iff(ast_1.raw('!$expAdd.isEmpty()'), ast_1.compoundExpression([
        ast_1.set(ast_1.ref('expression'), ast_1.str('$expression ADD')),
        ast_1.forEach(ast_1.ref('entry'), ast_1.ref('expAdd.entrySet()'), [
        ast_1.set(ast_1.ref('expression'), ast_1.str('$expression $entry.key $entry.value')),
        ast_1.iff(ast_1.ref('foreach.hasNext()'), ast_1.set(ast_1.ref('expression'), ast_1.str('$expression,')))])])),


        ast_1.iff(ast_1.raw('!$expRemove.isEmpty()'), ast_1.compoundExpression([
        ast_1.set(ast_1.ref('expression'), ast_1.str('$expression REMOVE')),
        ast_1.forEach(ast_1.ref('entry'), ast_1.ref('expRemove'), [
        ast_1.set(ast_1.ref('expression'), ast_1.str('$expression $entry')),
        ast_1.iff(ast_1.ref('foreach.hasNext()'), ast_1.set(ast_1.ref('expression'), ast_1.str('$expression,')))])])),


        ast_1.set(ast_1.ref('update'), ast_1.obj({})),
        ast_1.qref('$update.put("expression", "$expression")'),
        ast_1.iff(ast_1.raw('!$expNames.isEmpty()'), ast_1.qref('$update.put("expressionNames", $expNames)')),
        ast_1.iff(ast_1.raw('!$expValues.isEmpty()'), ast_1.qref('$update.put("expressionValues", $expValues)')),
        ast_1.obj({
            version: ast_1.str('2017-02-28'),
            operation: ast_1.str('UpdateItem'),
            key: key,
            update: ast_1.ref('util.toJson($update)'),
            condition: condition })]);


    };
    DynamoDBMappingTemplate.stringAttributeValue = function (value) {
        return {
            kind: 'Object', attributes: [
            ['S', { kind: 'Quotes', expr: value }]] };


    };
    DynamoDBMappingTemplate.numericAttributeValue = function (value) {
        return {
            kind: 'Object', attributes: [
            ['N', { kind: 'Quotes', expr: value }]] };


    };
    DynamoDBMappingTemplate.binaryAttributeValue = function (value) {
        return {
            kind: 'Object', attributes: [
            ['B', { kind: 'Quotes', expr: value }]] };


    };
    DynamoDBMappingTemplate.paginatedResponse = function () {
        return ast_1.obj({
            items: ast_1.ref('util.toJson($ctx.result.items)'),
            nextToken: ast_1.ref('util.toJson($util.defaultIfNullOrBlank($context.result.nextToken, null))') });

    };
    return DynamoDBMappingTemplate;
}();
exports.DynamoDBMappingTemplate = DynamoDBMappingTemplate;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LHVCQUFBLEdBQUEsdUJBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIG9iaiwgcmVmLCBFeHByZXNzaW9uLCBSZWZlcmVuY2VOb2RlLCBTdHJpbmdOb2RlLFxuICAgIEludE5vZGUsIEZsb2F0Tm9kZSwgc3RyLCBPYmplY3ROb2RlLCBjb21wb3VuZEV4cHJlc3Npb24sXG4gICAgc2V0LCBsaXN0LCBmb3JFYWNoLCBpZkVsc2UsIHFyZWYsIGlmZiwgcmF3LFxuICAgIENvbXBvdW5kRXhwcmVzc2lvbk5vZGVcbn0gZnJvbSAnLi9hc3QnO1xuXG5leHBvcnQgY2xhc3MgRHluYW1vREJNYXBwaW5nVGVtcGxhdGUge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIHB1dCBpdGVtIHJlc29sdmVyIHRlbXBsYXRlLlxuICAgICAqIEBwYXJhbSBrZXlzIEEgbGlzdCBvZiBzdHJpbmdzIHBvaW50aW5nIHRvIHRoZSBrZXkgdmFsdWUgbG9jYXRpb25zLiBFLkcuIGN0eC5hcmdzLnggKG5vdGUgbm8gJClcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHB1dEl0ZW0oeyBrZXksIGF0dHJpYnV0ZVZhbHVlcywgY29uZGl0aW9uIH06IHtcbiAgICAgICAga2V5OiBPYmplY3ROb2RlLFxuICAgICAgICBhdHRyaWJ1dGVWYWx1ZXM6IEV4cHJlc3Npb24sXG4gICAgICAgIGNvbmRpdGlvbj86IE9iamVjdE5vZGVcbiAgICB9KTogT2JqZWN0Tm9kZSB7XG4gICAgICAgIHJldHVybiBvYmooe1xuICAgICAgICAgICAgdmVyc2lvbjogc3RyKCcyMDE3LTAyLTI4JyksXG4gICAgICAgICAgICBvcGVyYXRpb246IHN0cignUHV0SXRlbScpLFxuICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgYXR0cmlidXRlVmFsdWVzLFxuICAgICAgICAgICAgY29uZGl0aW9uXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgZ2V0IGl0ZW0gcmVzb2x2ZXIgdGVtcGxhdGUuXG4gICAgICogQHBhcmFtIGtleSBBIGxpc3Qgb2Ygc3RyaW5ncyBwb2ludGluZyB0byB0aGUga2V5IHZhbHVlIGxvY2F0aW9ucy4gRS5HLiBjdHguYXJncy54IChub3RlIG5vICQpXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBnZXRJdGVtKHsga2V5IH06IHtcbiAgICAgICAga2V5OiBPYmplY3ROb2RlXG4gICAgfSk6IE9iamVjdE5vZGUge1xuICAgICAgICByZXR1cm4gb2JqKHtcbiAgICAgICAgICAgIHZlcnNpb246IHN0cignMjAxNy0wMi0yOCcpLFxuICAgICAgICAgICAgb3BlcmF0aW9uOiBzdHIoJ0dldEl0ZW0nKSxcbiAgICAgICAgICAgIGtleVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIHF1ZXJ5IHJlc29sdmVyIHRlbXBsYXRlLlxuICAgICAqIEBwYXJhbSBrZXkgQSBsaXN0IG9mIHN0cmluZ3MgcG9pbnRpbmcgdG8gdGhlIGtleSB2YWx1ZSBsb2NhdGlvbnMuIEUuRy4gY3R4LmFyZ3MueCAobm90ZSBubyAkKVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcXVlcnkoeyBxdWVyeSwgZmlsdGVyLCBzY2FuSW5kZXhGb3J3YXJkLCBsaW1pdCwgbmV4dFRva2VuLCBpbmRleCB9OiB7XG4gICAgICAgIHF1ZXJ5OiBPYmplY3ROb2RlO1xuICAgICAgICBzY2FuSW5kZXhGb3J3YXJkOiBFeHByZXNzaW9uO1xuICAgICAgICBmaWx0ZXI6IE9iamVjdE5vZGUgfCBFeHByZXNzaW9uO1xuICAgICAgICBsaW1pdDogRXhwcmVzc2lvbjtcbiAgICAgICAgbmV4dFRva2VuPzogRXhwcmVzc2lvbjtcbiAgICAgICAgaW5kZXg/OiBTdHJpbmdOb2RlO1xuICAgIH0pOiBPYmplY3ROb2RlIHtcbiAgICAgICAgcmV0dXJuIG9iaih7XG4gICAgICAgICAgICB2ZXJzaW9uOiBzdHIoJzIwMTctMDItMjgnKSxcbiAgICAgICAgICAgIG9wZXJhdGlvbjogc3RyKCdRdWVyeScpLFxuICAgICAgICAgICAgcXVlcnksXG4gICAgICAgICAgICBzY2FuSW5kZXhGb3J3YXJkLFxuICAgICAgICAgICAgZmlsdGVyLFxuICAgICAgICAgICAgbGltaXQsXG4gICAgICAgICAgICBuZXh0VG9rZW4sXG4gICAgICAgICAgICBpbmRleFxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIGxpc3QgaXRlbSByZXNvbHZlciB0ZW1wbGF0ZS5cbiAgICAgKiBAcGFyYW0ga2V5IEEgbGlzdCBvZiBzdHJpbmdzIHBvaW50aW5nIHRvIHRoZSBrZXkgdmFsdWUgbG9jYXRpb25zLiBFLkcuIGN0eC5hcmdzLnggKG5vdGUgbm8gJClcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGxpc3RJdGVtKHsgZmlsdGVyLCBsaW1pdCwgbmV4dFRva2VuIH06IHtcbiAgICAgICAgZmlsdGVyOiBPYmplY3ROb2RlIHwgRXhwcmVzc2lvbixcbiAgICAgICAgbGltaXQ6IEV4cHJlc3Npb24sXG4gICAgICAgIG5leHRUb2tlbj86IEV4cHJlc3Npb25cbiAgICB9KTogT2JqZWN0Tm9kZSB7XG4gICAgICAgIHJldHVybiBvYmooe1xuICAgICAgICAgICAgdmVyc2lvbjogc3RyKCcyMDE3LTAyLTI4JyksXG4gICAgICAgICAgICBvcGVyYXRpb246IHN0cignU2NhbicpLFxuICAgICAgICAgICAgZmlsdGVyLFxuICAgICAgICAgICAgbGltaXQsXG4gICAgICAgICAgICBuZXh0VG9rZW5cbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBkZWxldGUgaXRlbSByZXNvbHZlciB0ZW1wbGF0ZS5cbiAgICAgKiBAcGFyYW0ga2V5IEEgbGlzdCBvZiBzdHJpbmdzIHBvaW50aW5nIHRvIHRoZSBrZXkgdmFsdWUgbG9jYXRpb25zLiBFLkcuIGN0eC5hcmdzLnggKG5vdGUgbm8gJClcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGRlbGV0ZUl0ZW0oeyBrZXksIGNvbmRpdGlvbiB9OiB7XG4gICAgICAgIGtleTogT2JqZWN0Tm9kZSxcbiAgICAgICAgY29uZGl0aW9uOiBPYmplY3ROb2RlIHwgUmVmZXJlbmNlTm9kZVxuICAgIH0pOiBPYmplY3ROb2RlIHtcbiAgICAgICAgcmV0dXJuIG9iaih7XG4gICAgICAgICAgICB2ZXJzaW9uOiBzdHIoJzIwMTctMDItMjgnKSxcbiAgICAgICAgICAgIG9wZXJhdGlvbjogc3RyKCdEZWxldGVJdGVtJyksXG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICBjb25kaXRpb24sXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGFuIHVwZGF0ZSBpdGVtIHJlc29sdmVyIHRlbXBsYXRlLlxuICAgICAqIEBwYXJhbSBrZXlcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHVwZGF0ZUl0ZW0oeyBrZXksIGNvbmRpdGlvbiB9OiB7XG4gICAgICAgIGtleTogT2JqZWN0Tm9kZSxcbiAgICAgICAgY29uZGl0aW9uOiBPYmplY3ROb2RlIHwgUmVmZXJlbmNlTm9kZVxuICAgIH0pOiBDb21wb3VuZEV4cHJlc3Npb25Ob2RlIHtcbiAgICAgICAgY29uc3Qga2V5TmFtZXMgPSBrZXkuYXR0cmlidXRlcy5tYXAoKGF0dHI6IFtzdHJpbmcsIEV4cHJlc3Npb25dKSA9PiBhdHRyWzBdKVxuICAgICAgICAvLyBBdXRvIHRpbWVzdGFtcFxuICAgICAgICAvLyBxcmVmKCckaW5wdXQucHV0KFwidXBkYXRlZEF0XCIsIFwiJHV0aWwudGltZS5ub3dJU084NjAxKClcIiknKSxcbiAgICAgICAgcmV0dXJuIGNvbXBvdW5kRXhwcmVzc2lvbihbXG4gICAgICAgICAgICBzZXQocmVmKCdleHBOYW1lcycpLCBvYmooe30pKSxcbiAgICAgICAgICAgIHNldChyZWYoJ2V4cFZhbHVlcycpLCBvYmooe30pKSxcbiAgICAgICAgICAgIHNldChyZWYoJ2V4cFNldCcpLCBvYmooe30pKSxcbiAgICAgICAgICAgIHNldChyZWYoJ2V4cEFkZCcpLCBvYmooe30pKSxcbiAgICAgICAgICAgIHNldChyZWYoJ2V4cFJlbW92ZScpLCBsaXN0KFtdKSksXG4gICAgICAgICAgICBmb3JFYWNoKFxuICAgICAgICAgICAgICAgIHJlZignZW50cnknKSxcbiAgICAgICAgICAgICAgICByZWYoYHV0aWwubWFwLmNvcHlBbmRSZW1vdmVBbGxLZXlzKCRjb250ZXh0LmFyZ3MuaW5wdXQsIFske2tleU5hbWVzLm1hcChrID0+IGBcIiR7a31cImApLmpvaW4oJywgJyl9XSkuZW50cnlTZXQoKWApLFxuICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgaWZFbHNlKFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVmKCd1dGlsLmlzTnVsbCgkZW50cnkudmFsdWUpJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wb3VuZEV4cHJlc3Npb24oW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldChyZWYoJ2Rpc2NhcmQnKSwgcmVmKCdleHBSZW1vdmUuYWRkKFwiIyRlbnRyeS5rZXlcIiknKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXJlZignJGV4cE5hbWVzLnB1dChcIiMkZW50cnkua2V5XCIsIFwiJGVudHJ5LmtleVwiKScpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvdW5kRXhwcmVzc2lvbihbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXJlZignJGV4cFNldC5wdXQoXCIjJGVudHJ5LmtleVwiLCBcIjokZW50cnkua2V5XCIpJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXJlZignJGV4cE5hbWVzLnB1dChcIiMkZW50cnkua2V5XCIsIFwiJGVudHJ5LmtleVwiKScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFyZWYoJyRleHBWYWx1ZXMucHV0KFwiOiRlbnRyeS5rZXlcIiwgJHV0aWwuZHluYW1vZGIudG9EeW5hbW9EQigkZW50cnkudmFsdWUpKScpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHNldChyZWYoJ2V4cHJlc3Npb24nKSwgc3RyKCcnKSksXG4gICAgICAgICAgICBpZmYocmF3KCchJGV4cFNldC5pc0VtcHR5KCknKSwgY29tcG91bmRFeHByZXNzaW9uKFtcbiAgICAgICAgICAgICAgICBzZXQocmVmKCdleHByZXNzaW9uJyksIHN0cignU0VUJykpLFxuICAgICAgICAgICAgICAgIGZvckVhY2gocmVmKCdlbnRyeScpLCByZWYoJ2V4cFNldC5lbnRyeVNldCgpJyksIFtcbiAgICAgICAgICAgICAgICAgICAgc2V0KHJlZignZXhwcmVzc2lvbicpLCBzdHIoJyRleHByZXNzaW9uICRlbnRyeS5rZXkgPSAkZW50cnkudmFsdWUnKSksXG4gICAgICAgICAgICAgICAgICAgIGlmZihyZWYoJ2ZvcmVhY2guaGFzTmV4dCgpJyksIHNldChyZWYoJ2V4cHJlc3Npb24nKSwgc3RyKCckZXhwcmVzc2lvbiwnKSkpXG4gICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIF0pKSxcbiAgICAgICAgICAgIGlmZihyYXcoJyEkZXhwQWRkLmlzRW1wdHkoKScpLCBjb21wb3VuZEV4cHJlc3Npb24oW1xuICAgICAgICAgICAgICAgIHNldChyZWYoJ2V4cHJlc3Npb24nKSwgc3RyKCckZXhwcmVzc2lvbiBBREQnKSksXG4gICAgICAgICAgICAgICAgZm9yRWFjaChyZWYoJ2VudHJ5JyksIHJlZignZXhwQWRkLmVudHJ5U2V0KCknKSwgW1xuICAgICAgICAgICAgICAgICAgICBzZXQocmVmKCdleHByZXNzaW9uJyksIHN0cignJGV4cHJlc3Npb24gJGVudHJ5LmtleSAkZW50cnkudmFsdWUnKSksXG4gICAgICAgICAgICAgICAgICAgIGlmZihyZWYoJ2ZvcmVhY2guaGFzTmV4dCgpJyksIHNldChyZWYoJ2V4cHJlc3Npb24nKSwgc3RyKCckZXhwcmVzc2lvbiwnKSkpXG4gICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIF0pKSxcbiAgICAgICAgICAgIGlmZihyYXcoJyEkZXhwUmVtb3ZlLmlzRW1wdHkoKScpLCBjb21wb3VuZEV4cHJlc3Npb24oW1xuICAgICAgICAgICAgICAgIHNldChyZWYoJ2V4cHJlc3Npb24nKSwgc3RyKCckZXhwcmVzc2lvbiBSRU1PVkUnKSksXG4gICAgICAgICAgICAgICAgZm9yRWFjaChyZWYoJ2VudHJ5JyksIHJlZignZXhwUmVtb3ZlJyksIFtcbiAgICAgICAgICAgICAgICAgICAgc2V0KHJlZignZXhwcmVzc2lvbicpLCBzdHIoJyRleHByZXNzaW9uICRlbnRyeScpKSxcbiAgICAgICAgICAgICAgICAgICAgaWZmKHJlZignZm9yZWFjaC5oYXNOZXh0KCknKSwgc2V0KHJlZignZXhwcmVzc2lvbicpLCBzdHIoJyRleHByZXNzaW9uLCcpKSlcbiAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgXSkpLFxuICAgICAgICAgICAgc2V0KHJlZigndXBkYXRlJyksIG9iaih7fSkpLFxuICAgICAgICAgICAgcXJlZignJHVwZGF0ZS5wdXQoXCJleHByZXNzaW9uXCIsIFwiJGV4cHJlc3Npb25cIiknKSxcbiAgICAgICAgICAgIGlmZihcbiAgICAgICAgICAgICAgICByYXcoJyEkZXhwTmFtZXMuaXNFbXB0eSgpJyksXG4gICAgICAgICAgICAgICAgcXJlZignJHVwZGF0ZS5wdXQoXCJleHByZXNzaW9uTmFtZXNcIiwgJGV4cE5hbWVzKScpXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgaWZmKFxuICAgICAgICAgICAgICAgIHJhdygnISRleHBWYWx1ZXMuaXNFbXB0eSgpJyksXG4gICAgICAgICAgICAgICAgcXJlZignJHVwZGF0ZS5wdXQoXCJleHByZXNzaW9uVmFsdWVzXCIsICRleHBWYWx1ZXMpJylcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBvYmooe1xuICAgICAgICAgICAgICAgIHZlcnNpb246IHN0cignMjAxNy0wMi0yOCcpLFxuICAgICAgICAgICAgICAgIG9wZXJhdGlvbjogc3RyKCdVcGRhdGVJdGVtJyksXG4gICAgICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgICAgIHVwZGF0ZTogcmVmKCd1dGlsLnRvSnNvbigkdXBkYXRlKScpLFxuICAgICAgICAgICAgICAgIGNvbmRpdGlvblxuICAgICAgICAgICAgfSlcbiAgICAgICAgXSlcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIHN0cmluZ0F0dHJpYnV0ZVZhbHVlKHZhbHVlOiBFeHByZXNzaW9uKTogT2JqZWN0Tm9kZSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBraW5kOiAnT2JqZWN0JywgYXR0cmlidXRlczogW1xuICAgICAgICAgICAgICAgIFsnUycsIHsga2luZDogJ1F1b3RlcycsIGV4cHI6IHZhbHVlIH1dXG4gICAgICAgICAgICBdXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBudW1lcmljQXR0cmlidXRlVmFsdWUodmFsdWU6IEV4cHJlc3Npb24pOiBPYmplY3ROb2RlIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGtpbmQ6ICdPYmplY3QnLCBhdHRyaWJ1dGVzOiBbXG4gICAgICAgICAgICAgICAgWydOJywgeyBraW5kOiAnUXVvdGVzJywgZXhwcjogdmFsdWUgfV1cbiAgICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGJpbmFyeUF0dHJpYnV0ZVZhbHVlKHZhbHVlOiBFeHByZXNzaW9uKTogT2JqZWN0Tm9kZSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBraW5kOiAnT2JqZWN0JywgYXR0cmlidXRlczogW1xuICAgICAgICAgICAgICAgIFsnQicsIHsga2luZDogJ1F1b3RlcycsIGV4cHI6IHZhbHVlIH1dXG4gICAgICAgICAgICBdXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBwYWdpbmF0ZWRSZXNwb25zZSgpOiBPYmplY3ROb2RlIHtcbiAgICAgICAgcmV0dXJuIG9iaih7XG4gICAgICAgICAgICBpdGVtczogcmVmKCd1dGlsLnRvSnNvbigkY3R4LnJlc3VsdC5pdGVtcyknKSxcbiAgICAgICAgICAgIG5leHRUb2tlbjogcmVmKCd1dGlsLnRvSnNvbigkdXRpbC5kZWZhdWx0SWZOdWxsT3JCbGFuaygkY29udGV4dC5yZXN1bHQubmV4dFRva2VuLCBudWxsKSknKVxuICAgICAgICB9KVxuICAgIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=